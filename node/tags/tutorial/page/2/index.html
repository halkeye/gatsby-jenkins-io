<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/gatsby-jenkins-io/styles.7c3b8f7f67d9c5da9f51.css" data-identity="gatsby-global-css">@import url(https://www.jenkins.io/assets/bower/bootstrap/css/bootstrap.min.css);@import url(https://www.jenkins.io/assets/bower/tether/css/tether.min.css);@import url(https://www.jenkins.io/css/jenkins.css);@import url(https://www.jenkins.io/assets/bower/ionicons/css/ionicons.min.css);@import url(https://www.jenkins.io/css/footer.css);@import url(https://www.jenkins.io/css/font-awesome.min.css);.artifact-list li:before,dt[id]:before,h1[id]:before,h2[id]:before,h3[id]:before,h4[id]:before,h5[id]:before,h6[id]:before{content:" ";display:block;height:55px;margin-top:-55px;visibility:hidden}:hover>.anchorjs-link{opacity:0}img{max-width:100%}.anchorjs-link:hover{opacity:1}.anchorjs-link{padding:.4em .3em .4em .5em!important}.container.page{position:relative}body .no-margin{margin:0;padding:0}#ji-hover-layer{position:relative;z-index:999}#download-menu>.dropdown-menu{padding:2rem;width:50rem}.download-popup-menu .popover-arrow{display:none}#download-menu>.dropdown-menu .btn-group:active>.dropdown-menu{display:block}body .popover.download-options{box-shadow:0 3px 15px rgba(0,0,0,.25);max-width:90%!important;min-width:500px!important;width:620px}.betanotice{background-color:#f7f1da;color:#d24939;font-weight:700;text-align:center;top:0;width:100%;z-index:100}body h1.page-title{font:700 4rem georgia;margin-top:-.2rem}body h1.page-title .in-tag{display:none}.sub-heading{margin:-.5rem 0 1rem}.fixed.top{position:fixed;top:0;width:100%;z-index:10}.carousel-item{background:#fff;min-height:27rem}.carousel-item>.carousel-caption{bottom:auto;top:1.5rem}#ji-download .carousel-caption{display:block;margin-top:1rem;padding:1rem;position:static}.carousel-item video{bottom:0;left:0;opacity:.67;position:absolute;right:0;top:0;width:100%}.carousel-item .mask{background:hsla(0,0%,100%,.5);bottom:0;box-shadow:0 0 100px 10px #fff;left:20%;position:absolute;right:20%;top:0}.carousel{z-index:9}.dropdown-menu p{font-size:.875rem!important}@media screen and (-webkit-min-device-pixel-ratio:0) and (min-resolution:.001dpcm){.chromeOnly{height:36px}}.carousel-inner{z-index:8}#ji-download{left:0;min-width:620px;position:absolute;right:0;text-align:center;top:18rem;z-index:9}.authors,.authors>.auth{display:inline-block;margin:0;padding-bottom:5px}.authors>.auth>a{border:1px solid;cursor:pointer;display:block;font-size:50px;padding:5px;text-decoration:none}.authors>.auth>a:hover{background:#def}div .authors{display:block;margin-bottom:3rem;padding:0}.row.body{padding-top:3rem}.no-margin .row{margin:0}.container.center{text-align:center}.center>.center{display:inline;display:inline-block;float:none}body .jumbotron{margin:0}body .card-block{display:block}.jumbotron.featured{background-color:#168bb9}.jumbotron.featured a{color:#fff;text-decoration:none!important}.jumbotron.featured .row>div{position:relative}.jumbotron.featured .icon-docker.big{font-size:300px;position:absolute;right:0;text-decoration:none;top:-4rem}.tint{box-shadow:inset 0 0 100px rgba(0,0,0,.25)}img.desaturate{filter:grayscale(100%);filter:gray;filter:url("data:image/svg+xml;utf8,<svg version='1.1' xmlns='http://www.w3.org/2000/svg' height='0'><filter id='greyscale'><feColorMatrix type='matrix' values='0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0' /></filter></svg>#greyscale")}.img-box{background:#fff;border:1px solid #ccc;box-sizing:content-box;display:block;float:left;height:132px;line-height:132px;margin:2px;overflow:hidden;padding:0 10px;width:112px}.img-box>img{position:relative;top:-5px;vertical-align:middle;width:100%}.media-row,.step-by-step{border-bottom:.1rem solid #ccc;overflow-x:auto;overflow:visible;padding:2rem 1rem 3rem;position:relative;text-align:center;white-space:nowrap}.media-row{background-color:#fff;display:flex;flex-wrap:wrap}.media-row>.header,.step-by-step>.container>.header{margin-bottom:1.75rem}.media-row>.media,.step-by-step>.container.step{cursor:pointer;font-size:.9rem;vertical-align:top}.date-time,.step-by-step>.container .step .card-title{background:#168bb9;border-radius:50%;color:#fff;display:inline-block;font-size:1rem;height:4.75em;overflow:hidden;padding:.5em;position:relative;text-align:center;width:4.75em}.date-time>.date,.step-by-step>.container .step .card-title>.tag{background:rgba(180,40,40,.85);border-top-left-radius:.5em;border-top-right-radius:.5em;box-shadow:0 1px 5px rgba(0,0,0,.15);font-size:.75em;font-weight:400;left:0;padding:.5em 0 .25em;position:absolute;right:0;top:0}.date-time>.date .small{font-size:.5em}body .date-time{border-radius:.5em;height:5.3em;width:5.3em}.date-time>.date>*{display:inline}.date-time>.date>.dow{bottom:-1.1em;color:rgba(0,0,0,.15);display:block;font-family:arial narrow;font-size:6em;font-weight:bolder;left:-1em;position:absolute;right:-1.15em;text-align:center}.date-time>.time{font-size:1.1em;line-height:.67em;margin:2em -1em 0;position:relative}.step-by-step>.container .step .card-title>.num{font-size:2em;line-height:1em;margin-top:.67em}.step-by-step>.container .step .title{font-size:1.1rem;white-space:nowrap}.step-by-step>.container .step .short{display:block;font-size:.75rem;line-height:1.5em;margin:0 .5rem .5rem;overflow:hidden}.card-block{padding-bottom:0}.media-row>.media{font-size:85%;height:auto;margin:.25rem;min-height:16rem;text-align:left;width:14rem}.media-row>.media>img{width:100%}.media-row>.media>.card-block{padding:.75rem;white-space:normal;width:100%}.media-row>.media>.card-block p{line-height:1.2em}.media-row>.media .media-title{font-size:1.25rem;margin-bottom:.125rem}.quote-row{background:#f9f9f9;border-radius:0;box-shadow:inset 0 10px 100px rgba(0,0,0,.25);white-space:normal}.quote-row .card.important{background:#fff;box-shadow:0 1px 5px rgba(0,0,0,.25);font-size:1rem;margin-top:-1rem;white-space:normal}.quote-row .card.important p{font-size:1rem}#directory td>a{display:block;margin-bottom:.5rem;padding-bottom:.5rem;padding-right:1rem}#directory td>a>img{height:40px;width:40px}#directory tr{vertical-align:top}#directory tr td .title{font-weight:700}#directory tr td .description{font-size:75%}#welcome,body #sidebar ul.resources{border-top:1px solid #ccc;margin-bottom:2rem;margin-top:.75rem;padding-bottom:3rem;padding-top:1.5rem;position:relative}#welcome>div{bottom:0;height:3rem;left:0;position:absolute}#welcome>div>a{display:block;font-weight:700;margin-left:1rem;padding-left:40px;position:absolute;top:0}#sidebar #welcome>div>img{height:32px;left:4px;position:absolute;top:0;width:32px}#sidebar #welcome>.content{height:auto;position:relative}#sidebar ul.resources,#sidebar ul.resources>li,#sidebar ul.resources>li>a{display:block;list-style:none;margin:0;padding:0}body #sidebar ul.resources>li>a{font-weight:700;margin-left:1rem;padding:0 0 .5rem 40px}body .ji-dated-list>.post{border-top:.1rem solid #ccc;margin-bottom:.5rem}.ji-blog-list,.ji-dated-list,.ji-item-list,.ji-item-list>.post>.body,.ji-item-list>post,.ji-item-list>post>.body{display:block;font-size:1rem;list-style:none;margin:0;padding:0;position:relative}.events .ji-item-list{border-bottom:1px solid #ccc;overflow:visible;overflow-x:auto;overflow-y:visible;text-align:center;vertical-align:top;white-space:nowrap}.events .ji-item-list>.event{display:inline-block;margin:0;vertical-align:top}.events .ji-item-list>.event>a{margin:1rem .25rem .25rem;padding:.75rem;text-decoration:none;white-space:normal;width:16rem}.events .ji-item-list>.event>a .title{height:1.1rem;margin:.75rem 0 .25rem;overflow:hidden;position:relative}.events .ji-item-list>.event>a .title:after{bottom:0;box-shadow:inset -3rem 0 2rem -2rem #fff;content:" ";display:block;height:1.1rem;position:absolute;right:0;width:10%}.events .ji-item-list>.event>a .teaser{color:#4a5568;font-size:.85rem;height:3.3rem;overflow:hidden;position:relative}.events .ji-item-list>.event>a .teaser:after{bottom:0;box-shadow:inset -6rem 0 3rem -3rem #fff;content:" ";display:block;height:1.1rem;position:absolute;right:0;width:25%}.ji-dated-list>.post>.attrs,.ji-dated-list>.post>.body{padding:1.25rem 1rem 1rem 5rem;text-decoration:none}.ji-blog-list>.post>.more{color:#79b1be;position:absolute;right:0}.ji-blog-list>.post>.more:before{border:1px solid;content:"+";display:block;float:right;margin-left:.5rem}.ji-blog-list>.post>.body>.teaser,.ji-dated-list>.post>.body>.teaser{color:#555;margin:0 0 .5rem;max-height:6rem;overflow:hidden;position:relative;text-decoration:none}.ji-blog-list>.event>.body>.teaser{max-height:3.3rem!important}.fff.section{background:#fff;box-shadow:0 2px 3px rgba(0,0,0,.15);position:relative;z-index:2}.ji-blog-list>.post>.body>.teaser:after,.ji-dated-list>.post>.body>.teaser:after{bottom:0;box-shadow:inset -25rem 0 15rem -15rem #fff;content:"";display:block;height:1.5rem;position:absolute;right:0;width:30rem}.f9f9f9.section{background:#f9f9f9}.ji-dated-list>.post>.body>.teaser:after,z.f9f9f9.section .ji-blog-list>.post>.body>.teaser:after{box-shadow:inset -25rem 0 15rem -15rem #f9f9f9}.ji-blog-list>.post>.body:hover,.ji-dated-list>.post>.body:hover{text-decoration:none}.ji-blog-list>.post>.body:hover>.header>.title,.ji-dated-list>.post>.body:hover>.title{text-decoration:underline}.ji-dated-list>.post>.body>.teaser{color:#333;text-decoration:none}.ji-dated-list>.post>.body>.card{left:0;position:absolute;top:1.25rem}.ji-dated-list>.post>.attrs{padding-top:0;text-align:left}.ji-dated-list>.post>.attrs .author{display:inline-block;font-size:125%;margin:0 0 .25rem}.ji-blog-list>.post>.attrs>.tags,.ji-dated-list>.post>.attrs>.tags{font-size:75%;opacity:.75}.ji-blog-list>.post>.attrs>.tags>li,.ji-dated-list>.post>.attrs>.tags>li{display:inline-block;padding:0}.ji-blog-list>.post>.attrs>.tags>li>a{padding-right:.25rem}.ji-dated-list>.post>.attrs>.tags>li>a{border:.1rem solid;display:block;padding:0 .25rem}.ji-item-list .card{border:.1rem solid;text-align:center;width:4rem}.date.card>.month{background:#999;color:#fff}.date.card>.day{font-size:150%;font-weight:600;line-height:3rem}.ji-blog-list .date{border:1px solid;display:inline-block;font-size:.75rem;line-height:1.2em;margin:-.25rem .25rem 0 -2.75rem;position:relative;text-align:center;vertical-align:middle}.ji-blog-list .header{padding-left:2.75rem}.ji-blog-list .title{display:inline-block;vertical-align:middle}.ji-blog-list .date>.month{background:#168bb9;border-bottom:1px solid;color:#fff;padding:0 .2rem}.ji-blog-list .post,.ji-item-list .post{margin:.5rem 0 1.5rem}.blog-posts .ji-blog-list .post{background:#fff;margin:.5rem -1.5rem 1rem;padding:1.5rem}.ji-blog-list .attrs{color:#d55}.ji-blog-list .attrs>a{color:#d53730}.ji-blog-list .header.time{padding:0 0 .33rem 2.15rem;position:relative}.ji-blog-list .header.time .date{left:0;margin:0;position:absolute;top:0}.ji-blog-list .date-time .time{color:#d53730;font-size:.85rem;margin-bottom:-.5rem;position:relative;top:-.33rem}.blog-posts>h4,.events>h5{border-bottom:1px solid #ccc;margin:0 0 1rem;min-height:2rem}.events .event .title{display:block;font-size:1rem;margin:0}.events .event .teaser{font-size:.85rem;line-height:1.1rem}.event .teaser{overflow:hidden;position:relative;text-align:justify}.event .teaser.collapsed{max-height:4rem}.event .teaser:not(.collapsed){max-height:unset}.event .teaser.collapsed:before{background-image:linear-gradient(180deg,transparent,#fff);bottom:0;content:"";left:0;padding:3em 0;position:absolute;width:100%}.events .ji-blog-list>.event>.body>.teaser:after{height:1.1rem}.docker-plugins-list{margin-top:3rem}.ji-item-list.plugins>.post .body{padding:.75rem 0 0 2.5rem}.ji-item-list.plugins>.post .body p{margin:0}.ji-item-list.plugins>.post .body>.title{margin-top:0}.ji-item-list.plugins>.post>.attrs{font-size:80%;text-align:right}.ji-item-list.plugins>.post>.body>.card{top:.75rem}.card.icon{line-height:2rem;padding:0 .25rem;vertical-align:middle}.card.icon,.card.icon div{display:inline}.ji-dated-list>.post>.article{text-decoration:none}.ji-dated-list>.post>.article>.title{margin:.5rem 0 .125rem}.ji-dated-list>.post>.article>.url{color:#999;font-size:75%}.doc-block{margin:2rem 0 6rem}.sub-block{margin:3rem 0}.active-section{margin-bottom:1rem}.toc li a{display:block;line-height:1.2em;padding:.5rem 0}.toc .active-section li a{padding:.125rem 0}.cal{border:1px solid #999;margin-bottom:2rem}.cal>.row{border-bottom:1px solid rgba(0,0,0,.2);margin:0}.cal>.days{background:rgba(0,0,0,.15);border-bottom:1px solid #999;box-shadow:inset 0 3px 3px -3px rgba(0,0,0,.3);text-align:center}.cal>.days>.col-md-2{height:auto;line-height:2em;position:relative}.cal>.row>.col-md-2.weekend{background:rgba(0,0,0,.1);border:none;box-shadow:inset 3px 0 3px -3px rgba(0,0,0,.2)}.cal .col-md-2{border-right:1px solid rgba(0,0,0,.1);height:5.5rem}.cal a.apt{background:rgba(100,255,255,.5);box-shadow:inset 0 0 0 1px rgba(0,100,100,.5);display:block;font-size:75%;left:0;line-height:1.2em;padding:.125rem .5rem;position:absolute}.cal a.apt.span-4{margin:1px;width:400%}.cal a.apt.span-1{width:100%}.segment{padding-top:3rem}.cols-3{-moz-columns:3;column-count:3}.chunks{list-style:none;margin:0;padding:0}.features.uniform-height>div{padding-left:0}.uniform-height .box{border-radius:5px;min-height:10rem;padding:.67rem .75rem 0 4rem;position:relative}.uniform-height .box:before,.uniform-height .box i{background:#168bb9;border-radius:50%;color:#fff;content:" ";display:block;font-size:1.75rem;height:3.25rem;left:0;line-height:3.25rem;position:absolute;text-align:center;top:.75rem;width:3.25rem}.uniform-height .box>p{font-size:.8rem;line-height:1.5em;overflow:hidden}.uniform-height .box>h5{font-size:1.1rem;line-height:1.3em;margin-bottom:.33rem}@media (max-width:768px){.segment{padding-top:1rem}.uniform-height .box{margin-bottom:.5rem;min-height:4rem;padding-bottom:.5rem}}@media (min-width:992px) and (max-width:1200px){.uniform-height .box{min-height:12rem}}#ji-download .btn{border-radius:3px;box-shadow:0 3px 3px -1px rgba(0,0,0,.25);position:relative}#ji-download .btn .brick-tops{background:repeating-linear-gradient(90deg,transparent,transparent 12px,#358 0,#07d 22px,#358 32px);display:none;left:0;position:absolute;right:0;top:0}.brick-tops.footer{background:repeating-linear-gradient(90deg,transparent,transparent 12px,#234 0,#357 22px,#234 32px);border-bottom:2px solid rgba(255,255,255,.1)}#ji-download .btn:hover .brick-tops{background:repeating-linear-gradient(90deg,transparent,transparent 12px,#136 0,#05a 22px,#136 32px)}#ji-download .btn:hover{box-shadow:none}body{background-color:#fff;color:#4a5568;font-family:lato,Roboto,Open Sans,sans-serif;font-size:1rem;line-height:1.5;margin:0}.jumbotron.plugins{background:#81b0c4;background:linear-gradient(90deg,#81b0c4,#335061);border-radius:0;color:#fff;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr="#81b0c4",endColorstr="#335061",GradientType=1)}.overview{padding-top:1.5rem}.overview p{font-size:1.1rem}.btn-primary{background:#d24939;border:0}.btn-primary:active,.btn-primary:focus,.btn-primary:hover{background:#335061;border:0}nav .nav-item{cursor:pointer}nav .nav-item.active{box-shadow:inset 0 -2px #d33833}a{color:#069}#toc-blog{margin-left:-1rem}.section.blogs .content{padding-top:.5rem}.container.blog-post{min-height:65rem}.container.blog-post h1{font-size:2.25rem;margin-bottom:1rem}.container.blog-post .submitted{display:block}.section.blogs h4.blog-title{font-size:1.25rem;padding-bottom:.25rem}.container.blog-post .main-content{margin-bottom:60px}.quoteblock{padding-bottom:1rem}blockquote{border-left:5px solid #ddd;font-style:italic;margin:1rem 0 2rem;padding:1rem 1rem 1rem 2rem}.quoteblock blockquote{background:#fff;margin:1rem 0 0;padding:1rem 1rem 1rem 3rem;position:relative}.quoteblock .attribution{font-style:italic;margin-left:1.5rem}.quoteblock blockquote:before{color:#ddd;content:"\201C";display:block;font-size:4rem;left:0;line-height:1em;position:absolute;text-align:center;top:.5rem;width:3rem}.toc{background-color:#f9f9f9;border-left:1px solid #c9c9c9;clear:right;float:right;margin-bottom:1rem;margin-left:15px;padding:10px;width:20rem}.toc li li{padding-left:1rem}.toc li,.toc li>a,.toc ul{display:block;font-size:.9rem;line-height:1.35rem;list-style:none;margin:0;padding:0}.toc ul.root>li>a{color:#911;font-size:.85rem}.container.blog-post #sidebar{background:#f9f9f9;border-left:1px solid #ccc;bottom:0;box-shadow:inset 10px 0 10px -15px;overflow-y:auto;padding-top:5rem;position:fixed;right:0;top:0}.vertical.events .ji-item-list>.event{display:block}.container.blog-post .events .ji-item-list{border:none;white-space:normal}.container.blog-post .time .date-time{font-size:.75rem;left:1rem;position:absolute}.container.blog-post .events .ji-item-list>.event>a{background:#fff;border:1px solid #ccc;border-radius:3px;box-shadow:0 2px 2px rgba(0,0,0,.15);margin:.25rem 1rem .25rem .25rem;padding:.25rem 0 .25rem 5.5rem;text-align:left;width:auto}.carousel-caption{text-shadow:none}.admonitionblock td.content>.title,.audioblock>.title,.dlist>.title,.exampleblock>.title,.hdlist>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.olist>.title,.openblock>.title,.paragraph>.title,.qlist>.title,.quoteblock>.title,.stemblock>.title,.ulist>.title,.verseblock>.title,.videoblock>.title,table.tableblock>.title{text-rendering:optimizeLegibility;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic;text-align:left}table.tableblock>caption.title{max-width:0;overflow:visible;white-space:nowrap}#preamble>.sectionbody>.paragraph:first-of-type p,.paragraph.lead>p{color:rgba(0,0,0,.85)}table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}.admonitionblock>table{background:none;border:0;border-collapse:separate;margin:10px;width:100%}.admonitionblock>table td.icon{text-align:center;width:80px}.admonitionblock>table td.icon img{max-width:none}.admonitionblock>table td.icon .title{font-family:Open Sans,DejaVu Sans,sans-serif;font-weight:700;text-transform:uppercase}.admonitionblock>table td.content{border-left:1px solid #ddddd8;color:rgba(0,0,0,.6);padding-left:1.125em;padding-right:1.25em}.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}span.icon>.fa{cursor:default}.admonitionblock td.icon [class^="fa icon-"]{cursor:default;font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5)}.admonitionblock td.icon .icon-note:before{color:#19407c;content:"\f05a"}.admonitionblock td.icon .icon-tip:before{color:#111;content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8)}.admonitionblock td.icon .icon-warning:before{color:#bf6900;content:"\f071"}.admonitionblock td.icon .icon-caution:before{color:#bf3400;content:"\f06d"}.admonitionblock td.icon .icon-important:before{color:#bf0000;content:"\f06a"}.fa{text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-family:FontAwesome!important;font-size:inherit}p.details{margin-top:1rem}.imageblock,.listingblock{background:#fafafa;margin:20px 0;padding:15px}.image.right,.imageblock.right{float:right}.image.left,.imageblock.left{float:left}.image.center,.imageblock.center{margin-left:auto;margin-right:auto;text-align:center}.imageblock.boxshadow img,.paragraph.boxshadow img{box-shadow:0 0 15px 0 rgba(0,0,0,.5);margin:5px}#sponsorsblock{padding:1rem 2rem}#sponsorsblock p,#sponsorsblock ul{list-style-type:none;padding:0;text-align:center}#sponsorsblock li{display:inline;padding:1rem}.sponsors a:hover{text-decoration:none}.supporters{padding-top:1.5rem}.supporters a{font-weight:700}.div-mar{border-top:2px solid #fff;margin-right:2rem}.area,.div-mar{padding:1rem 0}.links{padding:0}.footer-left{padding-left:0}@media screen and (max-width:991px){.footer-left{margin-top:1rem}}li>p{margin:0;padding:0}.image.center>img{max-height:100%;max-width:100%}.current-page,.next-link,.previous-link,.skip{background-color:#fff;border:1px solid #ddd;color:#0275d8;float:left;line-height:1.5;margin-left:-1px;padding:.5rem .75rem;position:relative;text-decoration:none}.next-link:focus,.next-link:hover,.previous-link:focus,.previous-link:hover{background-color:#eceeef;border-color:#ddd;color:#014c8c;text-decoration:underline}.current-page{background-color:#eceeef;border-color:#ddd;color:#014c8c}li.card.step{background:none;border:none}.card.step>.card-block>p{white-space:normal}.conum[data-value]{background-color:rgba(0,0,0,.8);border-radius:100px;display:inline-block;font-family:Open Sans,DejaVu Sans,sans-serif;font-size:.75em;font-style:normal;font-weight:700;height:1.67em;line-height:1.67em;text-align:center;width:1.67em}.conum[data-value],.conum[data-value] *{color:#fff!important}.conum[data-value]+b{display:none}.conum[data-value]:after{content:attr(data-value)}pre .conum[data-value]{position:relative;top:-.125em}b.conum *{color:inherit!important}.conum:not([data-value]):empty{display:none}.colist>table tr>td:first-of-type{line-height:1;padding:0 .75em}.colist>table tr>td:last-of-type{padding:.25em 0}table{margin-bottom:1.25rem}.sidebar-nav h4{margin-bottom:1.5rem}.doc-page-link{margin-left:auto;margin-right:auto}.pipeline-block{margin-bottom:1rem}.pipeline-script-expand{font-size:.7rem}.scripted-pipeline{border-left:2px solid #ddd;border-top:1px solid #ddd;padding:5px}.syntax h2{border-bottom:3px solid #ddd}.syntax h3{border-bottom:2px solid #ddd}.syntax h4{border-bottom:1px solid #ddd}table.syntax{border:1px solid #fafafa;font-size:.8rem;margin:1rem}table.syntax p{margin:0;padding:5px}table.syntax>tbody>tr>td{border:1px solid #fafafa}table.syntax>tbody>tr>th{background-color:#fafafa;border:1px solid #fafafa;font-weight:700}.tour .active{font-weight:700}.navbar.navbar-expand-lg{font-size:.875rem}.navbar.navbar-expand-lg.bg-dark{background-color:#212529!important}.navbar.navbar-expand-lg .navbar-brand{font-family:Georgia,Times,Times New Roman,serif;font-size:20px;font-weight:600;padding:2px 0}.navbar.navbar-expand-lg .btn{font-size:.875rem;margin-left:8px;margin-top:1px}.navbar.navbar-expand-lg .btn.dropdown-toggle:after{margin:0 0 0 8px}.navbar.navbar-expand-lg .btn.btn-outline-secondary.active,.navbar.navbar-expand-lg .btn .btn-outline-secondary.active,.navbar.navbar-expand-lg .btn.btn-outline-secondary.focus,.navbar.navbar-expand-lg .btn.btn-outline-secondary:active,.navbar.navbar-expand-lg .btn .btn-outline-secondary:active,.navbar.navbar-expand-lg .btn.btn-outline-secondary:focus{background-color:hsla(0,0%,100%,.15)}.navbar.navbar-expand-lg .btn.btn-outline-secondary:hover,.navbar.navbar-expand-lg .navbar-toggler:hover{background-color:hsla(0,0%,100%,.1)}.navbar.navbar-expand-lg .show>.btn-outline-secondary.dropdown-toggle{background-color:hsla(0,0%,100%,.15)}.navbar.navbar-expand-lg .nav-link.btn{color:hsla(0,0%,100%,.75)}.navbar.navbar-expand-lg .dropdown-menu{font-size:.875rem}.navbar-toggler-icon{font-size:.8em}.nav-link.dropdown-toggle{background-color:transparent;border:0;font-family:inherit;font-size:inherit;line-height:inherit}.navbar .nav-link:focus,.navbar .navbar-brand:focus{outline-color:rgba(255,255,255,.5);outline-style:auto;outline-width:1px}.no-outline .navbar .nav-link:focus,.no-outline .navbar .navbar-brand:focus{outline-width:0}.banner-container .skew:before{-webkit-backface-visibility:hidden;backface-visibility:visible;-webkit-backface-visibility:initial;backface-visibility:initial;background:#f8f9fb;content:"";height:600px;left:0;overflow:visible;position:absolute;top:-100px;transform:skewY(-14deg);width:100%;z-index:-1}@media (min-width:767px){.header .skew:before{height:900px;top:-350px}}@media (min-width:992px){.header .skew:before{height:1020px;top:-350px}}.jumbotron{background-color:#f8f9fb}.post-attrs>.tags>li{display:inline-block;font-size:.7rem}.post-attrs>.tags>li>a{background-color:#069;border:.1rem solid;color:#fff;display:inline-block;padding:0 .25rem}.author.box td{max-width:600px;padding:5px;vertical-align:top}.author.box p{margin-bottom:3px}.author.about-header{font:1.5em Georgia,Times New Roman;margin-bottom:3px}.author.name{font:1.3em Georgia,Times New Roman}.author.logo{border-radius:6px;height:128px;max-width:none}.author.social-media-buttons{float:left;list-style:none;margin-top:0;padding:0;width:100%}.author.social-media-buttons li{display:block;float:left;margin-right:10px}.author-list{display:flex;flex-wrap:wrap}.author-card{background:#fff;border:.1rem solid #ccc;border-radius:3px;box-sizing:border-box;color:#666;cursor:pointer;font-size:.85rem;height:16.5rem;margin:.25rem;padding:.67rem;text-align:center;text-decoration:none!important;width:13rem}.author-card,.author-card .author.logo{display:block}.author-card .author.logo{margin:16px auto}.author-card .social-media-buttons{display:flex;margin-top:16px;width:100%}.author-card .social-media-buttons li{flex-grow:1;text-align:center}.author-card .social-media-buttons li a{margin:auto}.group-description p{margin-bottom:0}.group-links{margin-bottom:1rem}.logo-thumb{max-height:256px}.btn.btn-xs{border-radius:.2rem;height:1rem;line-height:.5rem;margin:.2rem;padding:.15rem;width:1rem}.grid-container{grid-gap:20px;display:grid;grid-template-columns:repeat(auto-fill,minmax(256px,1fr));margin-bottom:1rem}.grid-container .card{border:1px solid #d3d3d3;border-radius:.25rem}.grid-container .card .content{padding:15px}.grid-all,.grid-all td,.grid-all th{border:1px solid #dee2e6;padding:.75rem}.grid-all thead th{border-bottom-width:2px}.nav-item.searchbox{margin:auto auto auto .75em}.twitter-share-button{background-color:#1b95e0;background-image:url(/images/twitter-logo.svg);background-position:4px;background-repeat:no-repeat;background-size:14px 14px;border-radius:3px;box-sizing:border-box;color:#fff;cursor:pointer;display:inline-block;font-size:.7rem;font-weight:500;height:20px;line-height:20px;padding:1px 8px 1px 24px;position:relative}.twitter-share-button:hover{color:#fff;text-decoration:none}</style><meta name="generator" content="Gatsby 3.14.1"/><title data-react-helmet="true">Jenkins</title><link data-react-helmet="true" href="https://www.jenkins.io/favicon.ico" rel="shortcut icon" type="image/x-icon"/><link data-react-helmet="true" href="https://www.jenkins.io/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"/><link data-react-helmet="true" href="https://www.jenkins.io/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/><link data-react-helmet="true" href="https://www.jenkins.io/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/><link data-react-helmet="true" href="/site.webmanifest" rel="manifest"/><link data-react-helmet="true" color="#5bbad5" href="https://www.jenkins.io/safari-pinned-tab.svg" rel="mask-icon"/><meta data-react-helmet="true" content="text/html; charset=UTF-8" http-equiv="Content-Type"/><meta data-react-helmet="true" charSet="utf-8"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1" name="viewport"/><meta data-react-helmet="true" content="ie=edge" http-equiv="x-ua-compatible"/><meta data-react-helmet="true" content="#2b5797" name="msapplication-TileColor"/><meta data-react-helmet="true" content="#ffffff" name="theme-color"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="@JenkinsCI" name="twitter:site"/><meta data-react-helmet="true" content="@JenkinsCI" name="twitter:creator"/><meta data-react-helmet="true" content="article" property="og:type"/><meta data-react-helmet="true" content="https:/www.jenkins.io/template/" property="og:url"/><style data-react-helmet="true">#grid-box { position: relative } </style><style data-react-helmet="true">html { min-height:100%; position: relative; }</style><link rel="sitemap" type="application/xml" href="/gatsby-jenkins-io/sitemap-index.xml"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="icon" href="/gatsby-jenkins-io/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a" type="image/png"/><link rel="manifest" href="/gatsby-jenkins-io/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/gatsby-jenkins-io/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/gatsby-jenkins-io/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/gatsby-jenkins-io/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/gatsby-jenkins-io/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/gatsby-jenkins-io/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/gatsby-jenkins-io/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/gatsby-jenkins-io/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/gatsby-jenkins-io/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link as="script" rel="preload" href="/gatsby-jenkins-io/webpack-runtime-a27851d3e55b75342059.js"/><link as="script" rel="preload" href="/gatsby-jenkins-io/framework-094b0089736b8f621f0d.js"/><link as="script" rel="preload" href="/gatsby-jenkins-io/app-43188d140ca63afb8771.js"/><link as="script" rel="preload" href="/gatsby-jenkins-io/commons-12cbe55ce4f6cbfe1e93.js"/><link as="script" rel="preload" href="/gatsby-jenkins-io/component---src-templates-tag-blog-list-template-js-381f7f48e804ae2ed26a.js"/><link as="fetch" rel="preload" href="/gatsby-jenkins-io/page-data/node/tags/tutorial/page/2/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/gatsby-jenkins-io/page-data/sq/d/3649515864.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/gatsby-jenkins-io/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><script src="https://www.jenkins.io/assets/bower/jquery/jquery.min.js"></script><nav class="navbar navbar-expand-lg navbar-dark top bg-dark fixed-top" id="ji-toolbar"><a class="navbar-brand" href="https://www.jenkins.io/">Jenkins</a><button class="navbar-toggler" data-target="#CollapsingNavbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="CollapsingNavbar"><ul class="nav navbar-nav mr-auto"><li class="nav-item dropdown"><button type="button" aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown"><svg width="36" height="18" xmlns="http://www.w3.org/2000/svg" role="img" xlink="http://www.w3.org/1999/xlink" viewBox="-3.23 44.77 362.70 271.95"><defs><linearGradient id="a" x1="359.765" x2="104.082" y1="134.295" y2="124.577" gradientTransform="matrix(1 0 0 -1 0 439.068)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ed1c24"></stop><stop offset="1" stop-color="#f7941d"></stop></linearGradient><linearGradient id="b" x1="355.202" x2="99.519" y1="254.467" y2="244.749" href="#a"></linearGradient><linearGradient id="c" x1="183.903" x2="10.612" y1="227.598" y2="221.023" href="#a"></linearGradient><linearGradient id="d" x1="367.119" x2="157.995" y1="265.311" y2="257.091" href="#a"></linearGradient></defs><path fill="#c49a6c" d="M231.52 309.278c2.483-.332 4.895-.77 7.255-1.329s4.649-1.206 6.991-1.957c13.494-4.58 25.187-12.952 36.374-24.593l-.14-.175c-14.944 15.486-30.693 25.344-50.48 28.054z"></path><path fill="url(#a)" d="M224.232 309.96h.332c1.084 0 2.15-.14 3.216-.228a93.844 93.844 0 0 1-3.233.227z"></path><path fill="url(#b)" d="M284.692 187.187l-.122.192.122-.192z"></path><path fill="url(#c)" d="M146.145 231.847a150.844 150.844 0 0 1-12.97 15.862c-7.582 7.889-15.507 13.563-24.652 16.667a47.832 47.832 0 0 1-4.738 1.326 56.959 56.959 0 0 1-4.916.9 38.32 38.32 0 0 1-1.682.214l-.912.083c-.723.059-1.445.118-2.18.154h-3.068a42.325 42.325 0 0 1-9.192-1.043 49.977 49.977 0 0 1-6.764-2.002 43.097 43.097 0 0 1-4.525-1.954c-1.493-.77-2.961-1.516-4.407-2.37a59.5 59.5 0 0 1-17.105-15.399 59.714 59.714 0 0 1-2.914-4.311 53.09 53.09 0 0 1-1.291-2.263 51.985 51.985 0 0 1-2.263-4.738 46.72 46.72 0 0 1 0-36.426 51.986 51.986 0 0 1 2.263-4.738 54.14 54.14 0 0 1 1.291-2.263 59.742 59.742 0 0 1 2.914-4.311 59.714 59.714 0 0 1 17.105-15.4 60.828 60.828 0 0 1 4.407-2.369q2.217-1 4.525-1.777a49.976 49.976 0 0 1 6.906-2.073 42.325 42.325 0 0 1 9.192-1.042h3.128c.722 0 1.445.094 2.155.154l1.043.106 1.019.119c1.8.237 3.553.557 5.271.96.853.2 1.694.426 2.523.663a51.186 51.186 0 0 1 11.846 5.176 59.645 59.645 0 0 1 4.395 2.89 74.485 74.485 0 0 1 8.386 7.108q2.038 1.99 4.063 4.193l.083-.13a159.395 159.395 0 0 1 11.064 13.942c5.437-8.576 13.658-21.464 16.584-25.74 1.185-1.718 2.37-3.46 3.66-5.212-13.54-16.513-29.827-30.23-51.587-36.082h-.154a89.397 89.397 0 0 0-3.187-.794l-.45-.107a92.565 92.565 0 0 0-3.151-.627l-.628-.119a80.578 80.578 0 0 0-3.743-.569h-.142a58.29 58.29 0 0 0-2.073-.236h-.391l-1.872-.166h-.568l-1.754-.119h-.675l-1.777-.07h-3.115c-46.447-.25-87.125 40.476-87.125 86.911s40.725 87.173 87.172 87.173h3.14l1.729-.071h.734l1.67-.095h.676l1.706-.154h.568l1.813-.213.414-.06 1.967-.272h.213a125.91 125.91 0 0 0 3.553-.628l.652-.142c.96-.201 1.907-.415 2.855-.64l.58-.142a86.66 86.66 0 0 0 3.009-.817l.237-.071c20.73-6.077 36.425-19.392 49.55-35.277-2.037-3.068-3.4-5.366-4.039-6.48z"></path><path fill="url(#d)" d="M318.05 51.733v94.66a85.514 85.514 0 0 0-52.595-18.729h-3.115l-1.777.072-.7.047-1.752.118h-.569l-1.871.166h-.391c-.7.071-1.386.142-2.073.237h-.154c-1.256.154-2.5.355-3.732.569l-.628.118c-1.066.19-2.108.403-3.15.628l-.45.107c-30.35 6.858-50.333 28.808-66.822 52.82-.7 1.018-1.35 2.049-2.038 3.068-2.25 3.423-5.46 8.422-8.635 13.397-4.17 6.527-8.292 13.03-9.939 15.66l20.624 32.137s21.997 40.465 61.68 51.482l.237.07c.995.297 2.002.558 3.009.818l.58.142c.936.237 1.896.439 2.855.64l.652.142c1.184.225 2.369.439 3.553.628h.214l1.966.273.415.059 1.812.213h.569l1.705.154h.676l1.67.095h.734l1.73.07h3.139c54.703 0 86.355-30.964 87.149-85.063V51.733zm-52.595 215.403h-3.068c-.734 0-1.457-.095-2.18-.154l-.912-.083c-.568-.06-1.125-.13-1.682-.213a49.077 49.077 0 0 1-9.571-2.275 49.612 49.612 0 0 1-6.634-2.83 55.792 55.792 0 0 1-6.254-3.768 63.068 63.068 0 0 1-3.009-2.215 82.399 82.399 0 0 1-8.683-7.925l-.095.119c-1.255-1.303-2.487-2.69-3.731-4.11-.154-.167-.296-.356-.45-.534-.628-.722-1.256-1.445-1.884-2.215s-1.125-1.398-1.682-2.097-.888-1.101-1.338-1.682a184.467 184.467 0 0 1-6.053-8.292c-.7-.995-1.398-2.025-2.109-3.056-.379-.569-.77-1.184-1.185-1.73-.675-1.018-1.362-2.013-2.049-3.056l-.355-.545c-1.185-1.812-2.37-3.684-3.649-5.603q2.95-4.608 5.817-8.86c1.907-2.831 3.79-5.556 5.662-8.138s3.72-5.046 5.591-7.38 3.72-4.525 5.603-6.586q2.026-2.203 4.063-4.194c1.374-1.338 2.748-2.594 4.158-3.778s2.807-2.287 4.252-3.329a57.594 57.594 0 0 1 7.748-4.62c.331-.166.663-.367 1.006-.533l.226-.118c1.41-.652 2.843-1.185 4.3-1.73l.485-.201c.273-.083.557-.142.83-.237a44.943 44.943 0 0 1 3.34-.948l1.374-.343a60.798 60.798 0 0 1 4.738-.841l1.019-.119 1.042-.106c.711 0 1.434-.119 2.156-.154h3.128a42.431 42.431 0 0 1 4.572.26 48.011 48.011 0 0 1 6.93 1.35c1.54.427 3.08.925 4.596 1.505a48.724 48.724 0 0 1 4.525 1.955c1.493.722 2.961 1.516 4.407 2.369s2.866 1.8 4.24 2.784 2.725 2.049 4.028 3.174a58.459 58.459 0 0 1 8.837 9.477 59.73 59.73 0 0 1 2.914 4.312 51.067 51.067 0 0 1 5.318 11.916 47.38 47.38 0 0 1 1.185 5.165 45.567 45.567 0 0 1 .71 8.09c.072 35.964-16.062 52.122-52.227 52.122z"></path></svg></button><div class="dropdown-menu"><a class="dropdown-item feature" href="https://cd.foundation/">What is CDF?</a><a class="dropdown-item feature" href="https://jenkins-x.io/">Jenkins X</a><a class="dropdown-item feature" href="https://cloud.google.com/tekton/">Tekton</a><a class="dropdown-item feature" href="https://www.spinnaker.io/">Spinnaker</a></div></li></ul><ul class="nav navbar-nav ml-auto"><li class="nav-item"><a class="nav-link" href="/gatsby-jenkins-io/blog/">Blog</a></li><li class="nav-item dropdown"><button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">Documentation</button><div class="dropdown-menu"><a class="dropdown-item feature" href="/gatsby-jenkins-io/doc/book/"><strong>User Guide</strong></a><a class="dropdown-item" href="/gatsby-jenkins-io/doc/book/installing/"> - Installing Jenkins</a><a class="dropdown-item" href="https://www.jenkins.io/doc/book/pipeline/"> - Jenkins Pipeline</a><a class="dropdown-item" href="https://www.jenkins.io/doc/book/managing/"> - Managing Jenkins</a><a class="dropdown-item" href="https://www.jenkins.io/doc/book/security/"> - Securing Jenkins</a><a class="dropdown-item" href="https://www.jenkins.io/doc/book/system-administration/"> - System Administration</a><a class="dropdown-item" href="https://www.jenkins.io/doc/book/glossary/"> - Terms and Definitions</a><a class="dropdown-item" href="https://www.jenkins.io/solutions/"><strong>Solution Pages</strong></a><a class="dropdown-item" href="https://www.jenkins.io/doc/tutorials/"><strong>Tutorials</strong></a><a class="dropdown-item" href="https://www.jenkins.io/doc/pipeline/tour/getting-started/"> - Guided Tour</a><a class="dropdown-item" href="https://www.jenkins.io/doc/tutorials/"> - More Tutorials</a><a class="dropdown-item feature" href="https://www.jenkins.io/doc/developer/"><strong>Developer Guide</strong></a><a class="dropdown-item" href="https://www.jenkins.io/participate/"><strong>Contributor Guide</strong></a></div></li><li class="nav-item"><a class="nav-link" href="https://plugins.jenkins.io">Plugins</a></li><li class="nav-item dropdown"><button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">Community</button><div class="dropdown-menu"><a class="dropdown-item feature" href="https://www.jenkins.io/participate/">Overview</a><a class="dropdown-item feature" href="https://www.jenkins.io/chat/" title="Chat with the rest of the Jenkins community on IRC">Chat</a><a class="dropdown-item feature" href="https://www.jenkins.io/projects/jam/">Meet</a><a class="dropdown-item feature" href="https://www.jenkins.io/events/">Events</a><a class="dropdown-item feature" href="https://issues.jenkins.io/">Issue Tracker</a><a class="dropdown-item feature" href="https://www.jenkins.io/mailing-lists/" title="Browse Jenkins mailing list archives and/or subscribe to lists">Mailing Lists</a><a class="dropdown-item feature" href="https://www.jenkins.io/project/roadmap/">Roadmap</a><a class="dropdown-item feature" href="https://accounts.jenkins.io/" title="Create/manage your account for accessing wiki, issue tracker, etc">Account Management</a><a class="dropdown-item feature" href="https://www.jenkins.io/sigs/"><strong>Special Interest Groups</strong></a><a class="dropdown-item feature" href="https://www.jenkins.io/sigs/advocacy-and-outreach/"> - Advocacy and Outreach</a><a class="dropdown-item feature" href="https://www.jenkins.io/sigs/chinese-localization/"> - Chinese Localization</a><a class="dropdown-item feature" href="https://www.jenkins.io/sigs/cloud-native/"> - Cloud Native</a><a class="dropdown-item feature" href="https://www.jenkins.io/sigs/docs/"> - Documentation</a><a class="dropdown-item feature" href="https://www.jenkins.io/sigs/gsoc/"> - Google Summer of Code</a><a class="dropdown-item feature" href="https://www.jenkins.io/sigs/hw-and-eda/"> - Hardware and EDA</a><a class="dropdown-item feature" href="https://www.jenkins.io/sigs/pipeline-authoring/"> - Pipeline Authoring</a><a class="dropdown-item feature" href="https://www.jenkins.io/sigs/platform/"> - Platform</a><a class="dropdown-item feature" href="https://www.jenkins.io/sigs/ux/"> - User Experience</a></div></li><li class="dropdown nav-item"><button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">Subprojects</button><div class="dropdown-menu"><a class="dropdown-item feature" href="https://www.jenkins.io/projects/">Overview</a><a class="dropdown-item feature" href="https://www.jenkins.io/projects/evergreen/">Evergreen</a><a class="dropdown-item feature" href="https://www.jenkins.io/projects/gsoc/">Google Summer of Code in Jenkins</a><a class="dropdown-item feature" href="https://www.jenkins.io/projects/infrastructure/">Infrastructure</a><a class="dropdown-item feature" href="https://www.jenkins.io/projects/jam/">CI/CD and Jenkins Area Meetups</a><a class="dropdown-item feature" href="https://www.jenkins.io/projects/jcasc/">Jenkins Configuration as Code</a><a class="dropdown-item feature" href="https://www.jenkins.io/projects/jenkins-operator/">Jenkins Operator</a><a class="dropdown-item feature" href="https://www.jenkins.io/projects/remoting/">Jenkins Remoting</a><a class="dropdown-item feature" href="https://www.jenkins.io/sigs/docs/gsod/2020/projects/document-jenkins-on-kubernetes/">Document Jenkins on Kubernetes</a></div></li><li class="nav-item dropdown"><button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">About</button><div class="dropdown-menu"><a class="dropdown-item" href="https://www.jenkins.io/project/roadmap/">Roadmap</a><a class="dropdown-item" href="https://www.jenkins.io/security/">Security</a><a class="dropdown-item" href="https://www.jenkins.io/press/">Press</a><a class="dropdown-item" href="https://www.jenkins.io/awards/">Awards</a><a class="dropdown-item" href="https://www.jenkins.io/project/conduct/">Conduct</a><a class="dropdown-item" href="https://www.jenkins.io/artwork/">Artwork</a></div></li><li class="nav-item dropdown"><button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">English</button><div class="dropdown-menu"><a class="dropdown-item" href="https://www.jenkins.io/zh/">中文 Chinese</a></div></li><li class="nav-item"><a class="nav-link btn btn-outline-secondary" href="https://www.jenkins.io/download/">Download</a></li></ul></div></nav><div class="pt-4"> </div><div id="grid-box"><br/><br/><div class="container"><div id="block-block-15" class="block block-block even blog-posts"><h3 class="title">Recent Blog Posts</h3></div><div class="content blog-posts"><div class="item-list"><ul class="ji-blog-list ji-item-list"><li class="post"><a class="body" href="/gatsby-jenkins-io/blog/2017/02/10/declarative-html-publisher/"><div class="header"><div class="date"><div class="month">Feb</div><div class="day">10</div></div><h5 class="title">Declarative Pipeline: Publishing HTML Reports</h5></div><p class="teaser">This is a guest post by Liam Newman,
Technical Evangelist at CloudBees.

Declare Your Pipelines!
Declarative Pipeline 1.0 is here!
This is the second post in a series showing some of the cool features of
Declarative Pipeline.

In the
previous blog post,
we created a simple Declarative Pipeline.
In this blog post, we’ll go back and look at the Scripted Pipeline for the
Publishing HTML Reports in Pipeline blog post.
We’ll convert that Pipeline to Declarative syntax (including properties), go
into more detail on the post section, and then we’ll use the agent
directive to switch our Pipeline to run in Docker.

Setup

For this post, I’m going to use the
blog/add-declarative/html
branch of
my fork of the
hermann project.
I’ve set up a Multibranch Pipeline and pointed it at my repository
the same as did it previous post.
Also the same as before, I’ve set this Pipeline’s Git configuration to
automatically &quot;Clean after checkout&quot;.

This time we already have a Pipeline checked in.
I’ll run it a few times to get a baseline.

Converting to Declarative

Let’s start by converting the Scripted Pipeline straight to Declarative.

// Declarative //
pipeline {
  agent any // &lt;1&gt; (2)
options {
    // Keep the 10 most recent builds
    buildDiscarder(logRotator(numToKeepStr:&#x27;10&#x27;)) (3)
}
  stages {
    stage (&#x27;Build&#x27;) { (4)
steps {
        // install required gems
        sh &#x27;bundle install&#x27;

        // build and run tests with coverage
        sh &#x27;bundle exec rake build spec&#x27;

        // Archive the built artifacts
        archive includes: &#x27;pkg/*.gem&#x27;

        // publish html
        publishHTML target: [
            allowMissing: false,
            alwaysLinkToLastBuild: false,
            keepAll: true,
            reportDir: &#x27;coverage&#x27;,
            reportFiles: &#x27;index.html&#x27;,
            reportName: &#x27;RCov Report&#x27;
          ]
      }
    }
  }
}
// Scripted //
properties([[$class: &#x27;BuildDiscarderProperty&#x27;,
                strategy: [$class: &#x27;LogRotator&#x27;, numToKeepStr: &#x27;10&#x27;]]]) (3)

node { (1)
stage (&#x27;Build&#x27;) { (4)

// Checkout
    checkout scm (2)

// install required gems
    sh &#x27;bundle install&#x27;

    // build and run tests with coverage
    sh &#x27;bundle exec rake build spec&#x27;

    // Archive the built artifacts
    archive includes: &#x27;pkg/*.gem&#x27;

    // publish html
    publishHTML [
        allowMissing: false,
        alwaysLinkToLastBuild: false,
        keepAll: true,
        reportDir: &#x27;coverage&#x27;,
        reportFiles: &#x27;index.html&#x27;,
        reportName: &#x27;RCov Report&#x27;
      ]

  }
}

1
Select where to run this Pipeline, in this case &quot;any&quot; agent, regardless of label.

2
Declarative automatically performs a checkout of source code on the agent,
whereas Scripted Pipeline users must explicitly call checkout scm.

3
Set the Pipeline option to preserve the ten most recent runs.
This overrides the default behavior from the Multibranch parent of this Pipeline.

4
Run the &quot;Build&quot; stage.

Now that we have this Pipeline in Declarative form, let’s take a minute to do a
little clean up.  We’ll split out the bundle actions a little more and move
steps into logically grouped stages.  Rather than having one monolithic &quot;Build&quot;
stage, we’ll have details for each stage.  As long as we’re prettying things
up, let’s switch to using Blue Ocean to view our
builds, as well.

// Declarative //
pipeline {
  agent any
  options {
    // Keep the 10 most recent builds
    buildDiscarder(logRotator(numToKeepStr:&#x27;10&#x27;))
  }
  stages {
    stage (&#x27;Install&#x27;) {
      steps {
        // install required gems
        sh &#x27;bundle install&#x27;
      }
    }
    stage (&#x27;Build&#x27;) {
      steps {
        // build
        sh &#x27;bundle exec rake build&#x27;

        // Archive the built artifacts
        archive includes: &#x27;pkg/*.gem&#x27;
      }
    }
    stage (&#x27;Test&#x27;) {
      steps {
        // run tests with coverage
        sh &#x27;bundle exec rake spec&#x27;

        // publish html
        publishHTML target: [
            allowMissing: false,
            alwaysLinkToLastBuild: false,
            keepAll: true,
            reportDir: &#x27;coverage&#x27;,
            reportFiles: &#x27;index.html&#x27;,
            reportName: &#x27;RCov Report&#x27;
          ]
      }
    }
  }
}
// Scripted //

Using post sections

This looks pretty good, but if we think about it
the archive and publishHTML steps are really post-stage actions.
They should only occur when the rest of their stage succeeds.
As our Pipeline gets more complex we might need to add actions that always happen
even if a stage or the Pipeline as a whole fail.

In Scripted Pipeline, we would use try-catch-finally,
but we cannot do that in Declarative.
One of the defining features of the Declarative Pipeline
is that it does not allow script-based control structures
such as for loops, if-then-else blocks, or try-catch-finally blocks.
Of course, internally Step implementations can still contain whatever conditional logic they want,
but the Declarative Pipeline cannot.

Instead of free-form conditional logic,
Declarative Pipeline provides a set of Pipeline-specific controls:
when directives, which we’ll look at in
a later blog post in this series, control whether to execute the steps in a stage,
and
post sections
control which actions to take based on result of a single stage
or a whole Pipeline. post supports a number of
run conditions,
including always (execute no matter what) and changed
(execute when the result differs from previous run).
We’ll use success to run archive and publishHTML when their respective stages complete.
We’ll also use an always block with a placeholder for sending notifications,
which I’ll implement in the next blog post.

// Declarative //
pipeline {
  agent any
  options {
    // Only keep the 10 most recent builds
    buildDiscarder(logRotator(numToKeepStr:&#x27;10&#x27;))
  }
  stages {
    stage (&#x27;Install&#x27;) {
      steps {
        // install required gems
        sh &#x27;bundle install&#x27;
      }
    }
    stage (&#x27;Build&#x27;) {
      steps {
        // build
        sh &#x27;bundle exec rake build&#x27;
      }

      post {
        success {
          // Archive the built artifacts
          archive includes: &#x27;pkg/*.gem&#x27;
        }
      }
    }
    stage (&#x27;Test&#x27;) {
      steps {
        // run tests with coverage
        sh &#x27;bundle exec rake spec&#x27;
      }

      post {
        success {
          // publish html
          publishHTML target: [
              allowMissing: false,
              alwaysLinkToLastBuild: false,
              keepAll: true,
              reportDir: &#x27;coverage&#x27;,
              reportFiles: &#x27;index.html&#x27;,
              reportName: &#x27;RCov Report&#x27;
            ]
        }
      }
    }
  }
  post {
    always {
      echo &quot;Send notifications for result: ${currentBuild.result}&quot;
    }
  }
}
// Scripted //

Switching agent to run in Docker

agent can actually accept
several other parameters instead of any.
We could filter on label &quot;some-label&quot;, for example,
which would be the equivalent of node (&#x27;some-label&#x27;) in Scripted Pipeline.
However, agent also lets us just as easily switch to using a Docker container,
which replaces a more complicated set of changes in Scripted Pipeline:

pipeline {
  agent {
    // Use docker container
    docker {
      image &#x27;ruby:2.3&#x27;
    }
  }
  /* ... unchanged ... */
}

If I needed to, I could add a label filter under docker
to select a node to host the Docker container.
I already have Docker available on all my agents, so I don’t need label -
this works as is.
As you can see below, the Docker container spins up at the start of the run
and the pipeline runs inside it.  Simple!

Conclusion

At first glance, the Declarative Pipeline’s removal of control structures seems
like it would be too constrictive.  However, it replaces those structures with
facilities like the post section, that give us reasonable control over the
flow our our Pipeline while still improving readability and maintainability.
In the next blog post, we’ll add notifications to this pipeline
and look at how to use Shared Libraries with Declarative
Pipeline to share code and keep Pipelines easy to understand.

Links

Declarative Pipeline plugin

Declarative Pipeline Syntax Reference

Pipeline source for this post<span class="more"></span></p></a><div class="attrs"><a href="/gatsby-jenkins-io/blog/authors/lnewman">Liam Newman</a><ul class="list-inline tags"><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/tutorial">tutorial</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/pipeline">pipeline</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/declarative">declarative</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/plugins">plugins</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/ruby">ruby</a></li></ul></div></li><li class="post"><a class="body" href="/gatsby-jenkins-io/blog/2017/02/07/declarative-maven-project/"><div class="header"><div class="date"><div class="month">Feb</div><div class="day"> 7</div></div><h5 class="title">Declarative Pipeline for Maven Projects</h5></div><p class="teaser">This is a guest post by Liam Newman,
Technical Evangelist at CloudBees.

Declare Your Pipelines!
Declarative Pipeline 1.0 is here!
This is first in a series of blog posts that will show some of the cool features of
Declarative Pipeline.
For several of these posts, I’ll be revisiting some of my
previous posts
on using various plugins with (Scripted) Pipeline,
and seeing how those are implemented in Declarative Pipeline.

To start though, let’s get familiar with the basic structure of a Declarative Pipeline
by creating a simple Pipeline for a Maven-based Java project - the
Jenkins JUnit plugin.
We’ll create a minimal Declarative Pipeline,
add the settings needed to install Maven and the JDK,
and finally we’ll actually run Maven to build the plugin.

Set up

With Declarative, it is still possible to run Pipelines edited directly in the
Jenkins web UI, but one of the key features of &quot;Pipeline as Code&quot; is
checking-in and being able to track changes.  For this post, I’m going to use
the
blog/add-declarative-pipeline
branch of
my fork of the JUnit plugin.
I’m going to set up a Multi-branch Pipeline and point it at my repository.

I’ve also set this Pipeline’s Git configuration to automatically &quot;clean after
checkout&quot; and to only keep the ten most recent runs.

Writing a Minimal Pipeline

As has been said before, Declarative Pipeline provides a more structured,
&quot;opinionated&quot; way to create Pipelines. I’m going to start by creating a minimal
Declarative Pipeline and adding it to my branch.  Below is a minimal Pipeline
(with annotations) that just prints a message:

// Declarative //
pipeline { (1)
agent any // &lt;2&gt; (3)
stages { (4)
stage(&#x27;Build&#x27;) { (5)
steps { (6)
echo &#x27;This is a minimal pipeline.&#x27; (7)
}
        }
    }
}
// Scripted //
node { (2)
checkout scm (3)
stage (&#x27;Build&#x27;) { (5)
echo &#x27;This is a minimal pipeline.&#x27; (6)
}
}

1
All Declarative Pipelines start with a pipeline section.

2
Select where to run this Pipeline, in this case &quot;any&quot; agent, regardless of label.

3
Declarative automatically performs a checkout of source code on the agent,
whereas Scripted Pipeline users must explicitly call checkout scm,

4
A Declarative Pipeline is defined as a series of stages.

5
Run the &quot;Build&quot; stage.

6
Each stage in a Declarative Pipeline runs a series of steps.

7
Run the echo step to print a message in the Console Output.

If you are familiar with Scripted Pipeline, you can toggle the above
Declarative code sample to show the Scripted equivalent.

Once I add the Pipeline above to my Jenkinsfile and run &quot;Branch Indexing&quot;, my
Jenkins will pick it up and run run it.  We see that the Declarative Pipeline
has added stage called &quot;Declarative: Checkout SCM&quot;:

This a &quot;dynamic stage&quot;, one of several the kinds that Declarative Pipeline adds
as needed for clearer reporting.  In this case, it is a stage in which the
Declarative Pipeline automatically checkouts out source code on the agent.

As you can see above, we didn’t have to tell it do any of this,

Console Output

[Pipeline] node
Running on osx_mbp in /Users/bitwiseman/jenkins/agents/osx_mbp/workspace/blog_add-declarative-pipeline
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Declarative: Checkout SCM)
[Pipeline] checkout
Cloning the remote Git repository
{ ... truncated 20 lines ... }
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Build)
[Pipeline] echo
This is a minimal pipeline
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline
Finished: SUCCESS

Declarative Pipeline syntax is a little more verbose than the equivalent Scripted Pipeline,
but the added detail gives a clearer, more consistent view of what the Pipeline is supposed to do.
It also gives us a structure into which we can add more configuration details about this Pipeline.

Adding Tools to Pipeline

The next thing we’ll add in this Pipeline is a tools section to let us use
Maven.  The tools section is one of several sections we can add under
pipeline, which affect the configuration of the rest of the Pipeline.  (We’ll
look at the others, including agent, in later posts.) Each tool entry will
make whatever settings changes, such as updating PATH or other environment
variables, to make the named tool available in the current pipeline.  It will
also automatically install the named tool if that tool is configured to do so
under &quot;Managing Jenkins&quot; → &quot;Global Tool Configuration&quot;.

// Declarative //
pipeline {
    agent any
    tools { (1)
maven &#x27;Maven 3.3.9&#x27; (2)
jdk &#x27;jdk8&#x27; (3)
}
    stages {
        stage (&#x27;Initialize&#x27;) {
            steps {
                sh &#x27;&#x27;&#x27;
                    echo &quot;PATH = ${PATH}&quot;
                    echo &quot;M2_HOME = ${M2_HOME}&quot;
                &#x27;&#x27;&#x27; (4)
}
        }

        stage (&#x27;Build&#x27;) {
            steps {
                echo &#x27;This is a minimal pipeline.&#x27;
            }
        }
    }
}
// Scripted Not Defined //

1
tools section for adding tool settings.

2
Configure this Pipeline to use the Maven version matching &quot;Maven 3.3.9&quot;
(configured in &quot;Managing Jenkins&quot; → &quot;Global Tool Configuration&quot;).

3
Configure this Pipeline to use the Maven version matching &quot;jdk8&quot;
(configured in &quot;Managing Jenkins&quot; → &quot;Global Tool Configuration&quot;).

4
These will show the values of PATH and M2_HOME environment variables.

When we run this updated Pipeline the same way we ran the first, we see that
the Declarative Pipeline has added another stage called &quot;Declarative: Tool
Install&quot;: In the console output, we see that during this particular stage &quot;Maven 3.3.9&quot; gets installed,
and the PATH and M2_HOME environment variables are set:

Console Output

{ ... truncated lines ... }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Declarative: Tool Install)
[Pipeline] tool
Unpacking https://repo.maven.apache.org/maven2/org/apache/maven/apache-maven/3.3.9/apache-maven-3.3.9-bin.zip
to /Users/bitwiseman/jenkins/agents/osx_mbp/tools/hudson.tasks.Maven_MavenInstallation/Maven_3.3.9
on osx_mbp
[Pipeline] envVarsForTool
[Pipeline] tool
[Pipeline] envVarsForTool
[Pipeline] }
[Pipeline] // stage
{ ... }
PATH = /Library/Java/JavaVirtualMachines/jdk1.8.0_92.jdk/Contents/Home/bin:/Users/bitwiseman/jenkins/agents/osx_mbp/tools/hudson.tasks.Maven_MavenInstallation/Maven_3.3.9/bin:...
M2_HOME = /Users/bitwiseman/jenkins/agents/osx_mbp/tools/hudson.tasks.Maven_MavenInstallation/Maven_3.3.9
{ ... }

Running a Maven Build

Finally, running a Maven build is trivial.  The tools section already added
Maven and JDK8 to the PATH, all we need to do is call mvn install.  It
would be nice if I could split the build and the tests into separate stages,
but Maven is famous for not liking when people do that, so I’ll leave it alone
for now.

Instead, let’s load up the results of the build using the JUnit plugin,
however the version that was just built, sorry.

// Declarative //
pipeline {
    agent any
    tools {
        maven &#x27;Maven 3.3.9&#x27;
        jdk &#x27;jdk8&#x27;
    }
    stages {
        stage (&#x27;Initialize&#x27;) {
            steps {
                sh &#x27;&#x27;&#x27;
                    echo &quot;PATH = ${PATH}&quot;
                    echo &quot;M2_HOME = ${M2_HOME}&quot;
                &#x27;&#x27;&#x27;
            }
        }

        stage (&#x27;Build&#x27;) {
            steps {
                sh &#x27;mvn -Dmaven.test.failure.ignore=true install&#x27; (1)
}
            post {
                success {
                    junit &#x27;target/surefire-reports/**/*.xml&#x27; (2)
}
            }
        }
    }
}
// Scripted //
node {
    checkout scm

    String jdktool = tool name: &quot;jdk8&quot;, type: &#x27;hudson.model.JDK&#x27;
    def mvnHome = tool name: &#x27;mvn&#x27;

    /* Set JAVA_HOME, and special PATH variables. */
    List javaEnv = [
        &quot;PATH+MVN=${jdktool}/bin:${mvnHome}/bin&quot;,
        &quot;M2_HOME=${mvnHome}&quot;,
        &quot;JAVA_HOME=${jdktool}&quot;
    ]

    withEnv(javaEnv) {
    stage (&#x27;Initialize&#x27;) {
        sh &#x27;&#x27;&#x27;
            echo &quot;PATH = ${PATH}&quot;
            echo &quot;M2_HOME = ${M2_HOME}&quot;
        &#x27;&#x27;&#x27;
    }
    stage (&#x27;Build&#x27;) {
        try {
            sh &#x27;mvn -Dmaven.test.failure.ignore=true install&#x27;
        } catch (e) {
            currentBuild.result = &#x27;FAILURE&#x27;
        }
    }
    stage (&#x27;Post&#x27;) {
        if (currentBuild.result == null || currentBuild.result == &#x27;SUCCESS&#x27;) {
            junit &#x27;target/surefire-reports/**/*.xml&#x27; (2)
}
    }
}

1
Call mvn, the version configured by the tools section will be first on the path.

2
If the maven build succeeded, archive the JUnit test reports for display in the Jenkins web UI.
We’ll discuss the
post section in detail in the next blog post.

If you are familiar with Scripted Pipeline, you can toggle the above
Declarative code sample to show the Scripted equivalent.

Below is the console output for this last revision:

Console Output

{ ... truncated lines ... }
+ mvn install
[INFO] Scanning for projects...
[WARNING] The POM for org.jenkins-ci.tools:maven-hpi-plugin:jar:1.119 is missing, no dependency information available
[WARNING] Failed to build parent project for org.jenkins-ci.plugins:junit:hpi:1.20-SNAPSHOT
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building JUnit Plugin 1.20-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO]
[INFO] --- maven-hpi-plugin:1.119:validate (default-validate) @ junit ---
[INFO]
[INFO] --- maven-enforcer-plugin:1.3.1:display-info (display-info) @ junit ---
[INFO] Maven Version: 3.3.9
[INFO] JDK Version: 1.8.0_92 normalized as: 1.8.0-92
[INFO] OS Info: Arch: x86_64 Family: mac Name: mac os x Version: 10.12.3
[INFO]
{ ... }
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 03:25 min
[INFO] Finished at: 2017-02-06T22:43:41-08:00
[INFO] Final Memory: 84M/1265M
[INFO] ------------------------------------------------------------------------

Conclusion

The new Declarative syntax is a significant step forward for Jenkins Pipeline.
It trades some verbosity and constraints for much greater clarity and
maintainability.  In the coming weeks, I’ll be adding new blog posts
demonstrating various features of the Declarative syntax along with some recent
Jenkins Pipeline improvements.

Links

Declarative Pipeline

Declarative Pipeline Syntax Reference

Jenkins JUnit plugin<span class="more"></span></p></a><div class="attrs"><a href="/gatsby-jenkins-io/blog/authors/lnewman">Liam Newman</a><ul class="list-inline tags"><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/tutorial">tutorial</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/pipeline">pipeline</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/declarative">declarative</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/maven">maven</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/java">java</a></li></ul></div></li><li class="post"><a class="body" href="/gatsby-jenkins-io/blog/2017/01/19/converting-conditional-to-pipeline/"><div class="header"><div class="date"><div class="month">Jan</div><div class="day">19</div></div><h5 class="title">Converting Conditional Build Steps to Jenkins Pipeline</h5></div><p class="teaser">This is a guest post by Liam Newman,
Technical Evangelist at CloudBees.

Introduction

With all the new developments in
Jenkins Pipeline (and
Declarative Pipeline on the horizon),
it’s easy to forget what we did to create &quot;pipelines&quot; before
Pipeline.
There are number of plugins, some that have been around since the very beginning,
that enable users to create &quot;pipelines&quot; in Jenkins.
For example, basic job chaining worked well in many cases, and the
Parameterized Trigger plugin
made chaining more flexible.
However, creating chained jobs with conditional behavior was
still one of the harder things to do in Jenkins.

The
Conditional BuildStep plugin
is a powerful tool that has allowed Jenkins users to write Jenkins jobs with complex conditional logic.
In this post, we’ll take a look at how we might converting Freestyle jobs that
include conditional build steps to Jenkins Pipeline.
Unlike Freestyle jobs, implementing conditional operations in Jenkins Pipeline is trivial,
but matching the behavior of complex conditional build steps will require a bit more care.

Graphical Programming

The Conditional BuildStep plugin lets users add conditional logic to Freestyle
jobs from within the Jenkins web UI.  It does this by:

Adding two types of Conditional BuildStep (&quot;Single&quot; and &quot;Multiple&quot;) -
these build steps contain one or more other build steps to be run when the configured
condition is met

Adding a set of Condition operations -
these control whether the Conditional BuildStep execute the contained step(s)

Leveraging the Token Macro facility -
these provide values to the Conditions for evaluation

In the example below, this project will run the shell script step when the value of the
REQUESTED_ACTION token equals &quot;greeting&quot;.

Here’s the output when I run this project with REQUESTED_ACTION set to &quot;greeting&quot;:

Run condition [Strings match] enabling prebuild for step [Execute shell]
Strings match run condition: string 1=[greeting], string 2=[greeting]
Run condition [Strings match] enabling perform for step [Execute shell]
[freestyle-conditional] $ /bin/sh -xe /var/folders/hp/f7yc_mwj2tq1hmbv_5n10v2c0000gn/T/hudson5963233933358491209.sh
+ echo &#x27;Hello, bitwiseman!&#x27;
Hello, bitwiseman!
Finished: SUCCESS

And when I pass the value &quot;silence&quot;:

Run condition [Strings match] enabling prebuild for step [Execute shell]
Strings match run condition: string 1=[silence], string 2=[greeting]
Run condition [Strings match] preventing perform for step [Execute shell]
Finished: SUCCESS

This is a simple example but the conditional step can contain any regular build step.
When combined with other plugins, it can control whether to send notifications,
gather data from other sources, wait for user feedback, or call other projects.

The Conditional BuildStep plugin does a great job of leveraging strengths of
the Jenkins web UI, Freestyle jobs, and UI-based programming,
but it is also hampered by their limitations.
The Jenkins web UI can be clunky and confusing at times.
Like the steps in any Freestyle job, these conditional steps are only
stored and viewable in Jenkins.
They are not versioned with other product or build code and can’t be code reviewed.
Like any number of UI-based programming tools, it has to make trade-offs between clarity
and flexibility: more options or clearer presentation.
There’s only so much space on the screen.

Converting to Pipeline

Jenkins Pipeline, on the other hand, enables users to implement their pipeline as code.
Pipeline code can be written directly in the Jenkins Web UI or in any text editor.
It is a full-featured programming language,
which gives users access to much broader set of conditional statements
without the restrictions of UI-based programming.

So, taking the example above, the Pipeline equivalent is:

// Declarative //
pipeline {
    agent any
    parameters {
        choice(
            choices: [&#x27;greeting&#x27; , &#x27;silence&#x27;],
            description: &#x27;&#x27;,
            name: &#x27;REQUESTED_ACTION&#x27;)
    }

    stages {
        stage (&#x27;Speak&#x27;) {
            when {
                // Only say hello if a &quot;greeting&quot; is requested
                expression { params.REQUESTED_ACTION == &#x27;greeting&#x27; }
            }
            steps {
                echo &quot;Hello, bitwiseman!&quot;
            }
        }
    }
}
// Script //
properties ([
    parameters ([
        choice (
            choices: [&#x27;greeting&#x27;, &#x27;silence&#x27;],
            description: &#x27;&#x27;,
            name : &#x27;REQUESTED_ACTION&#x27;)
    ])
])

node {
    stage (&#x27;Speak&#x27;) {
        // Only say hello if a &quot;greeting&quot; is requested
        if (params.REQUESTED_ACTION == &#x27;greeting&#x27;) {
            echo &quot;Hello, bitwiseman!&quot;
        }
    }
}

When I run this project with REQUESTED_ACTION set to &quot;greeting&quot;, here’s the output:

[Pipeline] node
Running on osx_mbp in /Users/bitwiseman/jenkins/agents/osx_mbp/workspace/pipeline-conditional
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Speak)
[Pipeline] echo
Hello, bitwiseman!
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline
Finished: SUCCESS

When I pass the value &quot;silence&quot;, the only change is &quot;Hello, bitwiseman!&quot; is not printed.

Some might argue that the Pipeline code is a bit harder to understand on first reading.
Others would say the UI is just as confusing if not more so.
Either way, the Pipeline representation is considerably more compact than the Jenkins UI presentation.
Pipeline also lets us add helpful comments, which we can’t do in the Freestyle UI.
And we can easily put this Pipeline in a Jenkinsfile to be code-reviewed, checked-in, and versioned
along with the rest of our code.

Conditions

The previous example showed the &quot;Strings match&quot; condition and its Pipeline equivalent.
Let’s look at couple more interesting conditions and their Jenkins Pipeline equivalents.

Boolean condition

You might think that a boolean condition would be the simplest condition, but it isn’t.
Since it works with string values from tokens, the Conditional BuildStep plugin offers
a number of ways to indicate true or false.
Truth is a case insensitive match of one of the following:
1 (the number one), Y, YES, T, TRUE, ON or RUN.

Pipeline can duplicate these, but depending on the scenario we might consider
whether a simpler expression would suffice.

Pipeline

// Declarative //
when {
    // case insensitive regular expression for truthy values
    expression { return token ==~ /(?i)(Y|YES|T|TRUE|ON|RUN)/ }
}
steps {
    /* step */
}

// Script //
// case insensitive regular expression for truthy values
if (token ==~ /(?i)(Y|YES|T|TRUE|ON|RUN)/) {
    /* step */
}

Logical &quot;OR&quot; of conditions

This condition wraps other conditions.
It takes their results as inputs and performs a logical &quot;or&quot; of the results.
The AND and NOT conditions do the same, performing their respective operations.

Pipeline

// Declarative //
when {
    // A or B
    expression { return A || B }
}
steps {
    /* step */
}

// Script //
// A or B
if (A || B) {
    /* step */
}

Tokens

Tokens can be considerably more work than conditions.
There are more of them and they cover a much broader range of behaviors.
The previous example showed one of the simpler cases, accessing a build parameter,
where the token has a direct equivalent in Pipeline.
However, many tokens don’t have direct equivalents,
some take a parameters (adding to their complexity),
and some provide information that is simply not exposed in Pipeline yet.
So, determining how to migrate tokens needs to be done on case-by-case basis.

Let’s look at a few examples.

&quot;FILE&quot; token

Expands to the contents of a file. The file path is relative to the build workspace root.

${FILE,path=&quot;PATH&quot;}

This token maps directly to the readFile step.
The only difference is the file path for readFile is relative to the
current working directory on the agent, but that is the workspace root by default.
No problem.

Pipeline

// Declarative //
when {
    expression { return readFile(&#x27;pom.xml&#x27;).contains(&#x27;mycomponent&#x27;) }
}
steps {
    /* step */
}

// Script //
if (readFile(&#x27;pom.xml&#x27;).contains(&#x27;mycomponent&#x27;)) {
    /* step */
}

GIT_BRANCH

Expands to the name of the branch that was built.

Parameters (descriptions omitted): all, fullName.

This information may or may not be exposed in Pipeline.  If you’re using the
Pipeline Multibranch plugin
env.BRANCH_NAME will give similar basic information, but doesn’t offer the parameters.
There are also
several
issues
filed around GIT_* tokens in Pipeline.
Until they are addressed fully, we can follow the pattern shown in
pipeline-examples,
executing a shell to get the information we need.

Pipeline

GIT_BRANCH = sh(returnStdout: true, script: &#x27;git rev-parse --abbrev-ref HEAD&#x27;).trim()

CHANGES_SINCE_LAST_SUCCESS

Displays the changes since the last successful build.

Parameters (descriptions omitted):
reverse, format, changesFormat, showPaths, pathFormat,
showDependencies, dateFormat, regex, replace, default.

Not only is the information provided by this token not exposed in Pipeline,
the token has ten optional parameters, including format strings and regular expression
searches. There are a number of ways we might get similar information in Pipeline.
Each have their own particular limitations and ways they differ from the token output.
Then we’ll need to consider how each of the parameters changes the output.
If nothing else, translating this token is clearly beyond the scope of this post.

Slightly More Complex Example

Let’s do one more example that shows some of these conditions and tokens.
This time we’ll perform different build steps depending on what branch we’re building.
We’ll take two build parameters: BRANCH_PATTERN and FORCE_FULL_BUILD.
Based on BRANCH_PATTERN, we’ll checkout a repository.
If we’re building on the master branch or the user checked FORCE_FULL_BUILD,
we’ll call three other builds in parallel
( full-build-linux, full-build-mac, and full-build-windows),
wait for them to finish, and report the result.
If we’re not building on the master branch and the user did not check FORCE_FULL_BUILD,
we’ll print a message saying we skipped the full builds.

Freestyle

Here’s the configuration for Freestyle version.
(It’s pretty long.  Feel free to skip down to the Pipeline version):

The Pipeline version of this job determines the GIT_BRANCH branch by
running a shell script that returns the current local branch name.
This means that the Pipeline version must checkout to a local branch (not a detached head).

Freestyle version of this job does not require a local branch, GIT_BRANCH is set automatically.
However, to maintain functional parity, the Freestyle version of this job includes
&quot;Checkout to Specific Local Branch&quot; as well.

Pipeline

Here’s the equivalent Pipeline:

Freestyle version of this job is not stored in source control.

In general, the Pipeline version of this job would be stored in source control,
would checkout scm, and would run that same repository.
However, to maintain functional parity, the Pipeline version shown does a checkout
from source control but is not stored in that repository.

Pipeline

// Script //
properties ([
    parameters ([
        string (
            defaultValue: &#x27;*&#x27;,
            description: &#x27;&#x27;,
            name : &#x27;BRANCH_PATTERN&#x27;),
        booleanParam (
            defaultValue: false,
            description: &#x27;&#x27;,
            name : &#x27;FORCE_FULL_BUILD&#x27;)
    ])
])

node {
    stage (&#x27;Prepare&#x27;) {
        checkout([$class: &#x27;GitSCM&#x27;,
            branches: [[name: &quot;origin/${BRANCH_PATTERN}&quot;]],
            doGenerateSubmoduleConfigurations: false,
            extensions: [[$class: &#x27;LocalBranch&#x27;]],
            submoduleCfg: [],
            userRemoteConfigs: [[
                credentialsId: &#x27;bitwiseman_github&#x27;,
                url: &#x27;https://github.com/bitwiseman/hermann&#x27;]]])
    }

    stage (&#x27;Build&#x27;) {
        GIT_BRANCH = &#x27;origin/&#x27; + sh(returnStdout: true, script: &#x27;git rev-parse --abbrev-ref HEAD&#x27;).trim()
        if (GIT_BRANCH == &#x27;origin/master&#x27; || params.FORCE_FULL_BUILD) {

            // Freestyle build trigger calls a list of jobs
            // Pipeline build() step only calls one job
            // To run all three jobs in parallel, we use &quot;parallel&quot; step
            // https://jenkins.io/doc/pipeline/examples/#jobs-in-parallel
            parallel (
                linux: {
                    build job: &#x27;full-build-linux&#x27;, parameters: [string(name: &#x27;GIT_BRANCH_NAME&#x27;, value: GIT_BRANCH)]
                },
                mac: {
                    build job: &#x27;full-build-mac&#x27;, parameters: [string(name: &#x27;GIT_BRANCH_NAME&#x27;, value: GIT_BRANCH)]
                },
                windows: {
                    build job: &#x27;full-build-windows&#x27;, parameters: [string(name: &#x27;GIT_BRANCH_NAME&#x27;, value: GIT_BRANCH)]
                },
                failFast: false)

        } else {
            echo &#x27;Skipped full build.&#x27;
        }
    }
}
// Declarative //
pipeline {
    agent any
    parameters {
        string (
            defaultValue: &#x27;*&#x27;,
            description: &#x27;&#x27;,
            name : &#x27;BRANCH_PATTERN&#x27;)
        booleanParam (
            defaultValue: false,
            description: &#x27;&#x27;,
            name : &#x27;FORCE_FULL_BUILD&#x27;)
    }

    stages {
        stage (&#x27;Prepare&#x27;) {
            steps {
                checkout([$class: &#x27;GitSCM&#x27;,
                    branches: [[name: &quot;origin/${BRANCH_PATTERN}&quot;]],
                    doGenerateSubmoduleConfigurations: false,
                    extensions: [[$class: &#x27;LocalBranch&#x27;]],
                    submoduleCfg: [],
                    userRemoteConfigs: [[
                        credentialsId: &#x27;bitwiseman_github&#x27;,
                        url: &#x27;https://github.com/bitwiseman/hermann&#x27;]]])
            }
        }

        stage (&#x27;Build&#x27;) {
            when {
                expression {
                    GIT_BRANCH = &#x27;origin/&#x27; + sh(returnStdout: true, script: &#x27;git rev-parse --abbrev-ref HEAD&#x27;).trim()
                    return GIT_BRANCH == &#x27;origin/master&#x27; || params.FORCE_FULL_BUILD
                }
            }
            steps {
                // Freestyle build trigger calls a list of jobs
                // Pipeline build() step only calls one job
                // To run all three jobs in parallel, we use &quot;parallel&quot; step
                // https://jenkins.io/doc/pipeline/examples/#jobs-in-parallel
                parallel (
                    linux: {
                        build job: &#x27;full-build-linux&#x27;, parameters: [string(name: &#x27;GIT_BRANCH_NAME&#x27;, value: GIT_BRANCH)]
                    },
                    mac: {
                        build job: &#x27;full-build-mac&#x27;, parameters: [string(name: &#x27;GIT_BRANCH_NAME&#x27;, value: GIT_BRANCH)]
                    },
                    windows: {
                        build job: &#x27;full-build-windows&#x27;, parameters: [string(name: &#x27;GIT_BRANCH_NAME&#x27;, value: GIT_BRANCH)]
                    },
                    failFast: false)
            }
        }
        stage (&#x27;Build Skipped&#x27;) {
            when {
                expression {
                    GIT_BRANCH = &#x27;origin/&#x27; + sh(returnStdout: true, script: &#x27;git rev-parse --abbrev-ref HEAD&#x27;).trim()
                    return !(GIT_BRANCH == &#x27;origin/master&#x27; || params.FORCE_FULL_BUILD)
                }
            }
            steps {
                echo &#x27;Skipped full build.&#x27;
            }
        }
    }
}

Conclusion

As I said before, the Conditional BuildStep plugin is great.
It provides a clear, easy to understand way to add conditional logic to any Freestyle job.
Before Pipeline, it was one of the few plugins to do this and it remains one of the most popular plugins.
Now that we have Pipeline, we can implement conditional logic directly in code.

This is blog post discussed how to approach converting conditional build steps to Pipeline
and showed a couple concrete examples.  Overall, I’m pleased with the results so far.
I found scenarios which could not easily be migrated to Pipeline, but even those
are only more difficult, rather than impossible.

The next thing to do is add a section to the
Jenkins Handbook documenting the Pipeline
equivalent of all of the Conditions and the most commonly used Tokens.
Look for it soon!

Links

Conditional BuildStep plugin<span class="more"></span></p></a><div class="attrs"><a href="/gatsby-jenkins-io/blog/authors/lnewman">Liam Newman</a><ul class="list-inline tags"><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/pipeline">pipeline</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/freestyle">freestyle</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/plugins">plugins</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/conditional-build-step">conditional-build-step</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/tutorial">tutorial</a></li></ul></div></li><li class="post"><a class="body" href="/gatsby-jenkins-io/blog/2016/08/29/sauce-pipeline/"><div class="header"><div class="date"><div class="month">Aug</div><div class="day">29</div></div><h5 class="title">Browser-testing with Sauce OnDemand and Pipeline</h5></div><p class="teaser">This is a guest post by Liam Newman,
Technical Evangelist at CloudBees.

Testing web applications across multiple browsers on different platforms can be challenging even for smaller applications.
With Jenkins and the
Sauce OnDemand Plugin,
you can wrangle that complexity by defining your Pipeline as Code.

Pipeline ♥ UI Testing, Too

I recently started looking for a way to do browser UI testing for an open-source JavaScript project to which I contribute.
The project is targeted primarily at
Node.js
but we’re committed to maintaining browser-client compatibility as well.
That means we should run tests on a matrix of browsers.
Sauce Labs
has an &quot;open-sauce&quot; program that provides free test instances to open-source projects.
I decided to try using the
Sauce OnDemand Plugin
and
Nightwatch.js
to run Selenium tests on a sample project first, before trying a full-blown suite of tests.

Starting from Framework

I started off by following Sauce Labs&#x27; instructions on
&quot; Setting up Sauce Labs with Jenkins&quot;
as far as I could.
I installed the
JUnit and
Sauce OnDemand
plugins, created an account with Sauce Labs, and
added my Sauce Labs credentials to Jenkins.
From there I started to get a little lost.
I’m new to Selenium and I had trouble understanding how to translate the instructions to my situation.
I needed a working example that I could play with.

Happily, there’s a whole range of sample projects in
&quot; saucelabs-sample-test-frameworks&quot;
on GitHub, which show how to integrate Sauce Labs with various test frameworks, including Nightwatch.js.
I forked the Nightwatch.js sample to
bitwiseman/JS-Nightwatch.js
and set to writing my Jenkinsfile.
Between the sample and the Sauce Labs instructions,
I was able to write a pipeline that ran five tests on one browser via
Sauce Connect :

node {
    stage &quot;Build&quot;
    checkout scm

    sh &#x27;npm install&#x27; (1)

stage &quot;Test&quot;
    sauce(&#x27;f0a6b8ad-ce30-4cba-bf9a-95afbc470a8a&#x27;) { (2)
sauceconnect(options: &#x27;&#x27;, useGeneratedTunnelIdentifier: false, verboseLogging: false) { (3)
sh &#x27;./node_modules/.bin/nightwatch -e chrome --test tests/guineaPig.js || true&#x27; (4)
junit &#x27;reports/**&#x27; (5)
step([$class: &#x27;SauceOnDemandTestPublisher&#x27;]) (6)
}
    }
}

1
Install dependencies

2
Use my
previously added sauce credentials

3
Start up the
Sauce Connect
tunnel to Sauce Labs

4
Run Nightwatch.js

5
Use JUnit to track results and show a trend graph

6
Link result details from Sauce Labs

This pipeline expects to be run from a Jenkinsfile in SCM.
To copy and paste it directly into a Jenkins Pipeline job, replace the checkout scm step with
git url:&#x27;https://github.com/bitwiseman/JS-Nightwatch.js&#x27;, branch: &#x27;sauce-pipeline&#x27;.

I ran this job a few times to get the JUnit report to show a trend graph.

This sample app generates the SauceOnDemandSessionID for each test, enabling the Jenkins Sauce OnDemand Plugin’s result publisher to link results to details Sauce Labs captured during the run.

Adding Platforms

Next I wanted to add a few more platforms to my matrix.
This would require changing both the test framework configuration and the pipeline.
I’d need to add new named combinations of platform, browser, and browser version (called &quot;environments&quot;) to the Nightwatch.js configuration file,
and modify the pipeline to run tests in those new environments.

This is a perfect example of the power of pipeline as code.
If I were working with a separately configured pipeline,
I’d have to make the change to the test framework, then change the pipeline manually.
With my pipeline checked in as code,
I could change both in one commit,
preventing errors resulting from pipeline configurations going out of sync from the rest of the project.

I added three new environments to nightwatch.json :

&quot;test_settings&quot; : {
  &quot;default&quot;: { /*----8 &lt;----*/ },
  &quot;chrome&quot;: { /*----8 &lt;----*/ },

  &quot;firefox&quot;: {
    &quot;desiredCapabilities&quot;: {
      &quot;platform&quot;: &quot;linux&quot;,
      &quot;browserName&quot;: &quot;firefox&quot;,
      &quot;version&quot;: &quot;latest&quot;
    }
  },
  &quot;ie&quot;: {
    &quot;desiredCapabilities&quot;: {
      &quot;platform&quot;: &quot;Windows 10&quot;,
      &quot;browserName&quot;: &quot;internet explorer&quot;,
      &quot;version&quot;: &quot;latest&quot;
    }
  },
  &quot;edge&quot;: {
    &quot;desiredCapabilities&quot;: {
      &quot;platform&quot;: &quot;Windows 10&quot;,
      &quot;browserName&quot;: &quot;MicrosoftEdge&quot;,
      &quot;version&quot;: &quot;latest&quot;
    }
  }
}

And I modified my Jenkinsfile to call them:

//----8 (1)
&#x27;chrome&#x27;,
        &#x27;firefox&#x27;,
        &#x27;ie&#x27;,
        &#x27;edge&#x27;
    ].join(&#x27;,&#x27;)
    // Run selenium tests using Nightwatch.js
    sh &quot;./node_modules/.bin/nightwatch -e ${configs} --test tests/guineaPig.js&quot; (2)
} //----8

1
Using an array to improve readability and make it easy to add more platforms later.

2
Changed from single-quoted string to double-quoted to support variable substitution.

Test frameworks have bugs too. Nightwatch.js (v0.9.8) generates incomplete JUnit files,
reporting results without enough information in them to distinguish between platforms.
I implemented a fix for it and
submitted a PR to Nightwatch.js.
This blog shows output with that fix applied locally.

As expected, Jenkins picked up the new pipeline and ran Nightwatch.js on four platforms.
Sauce Labs of course recorded the results and correctly linked them into this build.
Nightwatch.js was already configured to use multiple worker threads to run tests against those platforms in parallel, and
my Sauce Labs account supported running them all at the same time,
letting me cover four configurations in less that twice the time,
and that added time was most due to individual new environments taking longer to complete.
When I move to the actual project, this will let me run broad acceptance passes quickly.

Conclusion: To Awesome and Beyond

Considering the complexity of the system, I was impressed with how easy it was to integrate Jenkins with Sauce OnDemand to start testing on multiple browsers.
The plugin worked flawlessly with Jenkins Pipeline.
I went ahead and ran some additional tests to show that failure reporting also behaved as expected.

//----8 (1)
//----8

1
Removed --test filter to run all tests

Epilogue: Pipeline vs. Freestyle

Just for comparison here’s the final state of this job in Freestyle UI versus fully-commented pipeline code:

This includes the
AnsiColor Plugin
to support Nightwatch.js&#x27; default ANSI color output.

Freestyle

Pipeline

node {
    stage &quot;Build&quot;
    checkout scm

    // Install dependencies
    sh &#x27;npm install&#x27;

    stage &quot;Test&quot;

    // Add sauce credentials
    sauce(&#x27;f0a6b8ad-ce30-4cba-bf9a-95afbc470a8a&#x27;) {
        // Start sauce connect
        sauceconnect(options: &#x27;&#x27;, useGeneratedTunnelIdentifier: false, verboseLogging: false) {

            // List of browser configs we&#x27;ll be testing against.
            def platform_configs = [
                &#x27;chrome&#x27;,
                &#x27;firefox&#x27;,
                &#x27;ie&#x27;,
                &#x27;edge&#x27;
            ].join(&#x27;,&#x27;)

            // Nightwatch.js supports color ouput, so wrap this step for ansi color
            wrap([$class: &#x27;AnsiColorBuildWrapper&#x27;, &#x27;colorMapName&#x27;: &#x27;XTerm&#x27;]) {

                // Run selenium tests using Nightwatch.js
                // Ignore error codes. The junit publisher will cover setting build status.
                sh &quot;./node_modules/.bin/nightwatch -e ${platform_configs} || true&quot;
            }

            junit &#x27;reports/**&#x27;

            step([$class: &#x27;SauceOnDemandTestPublisher&#x27;])
        }
    }
}

This pipeline expects to be run from a Jenkinsfile in SCM.
To copy and paste it directly into a Jenkins Pipeline job, replace the checkout scm step with
git url:&#x27;https://github.com/bitwiseman/JS-Nightwatch.js&#x27;, branch: &#x27;sauce-pipeline&#x27;.

Not only is the pipeline as code more compact,
it also allows for comments to further clarify what is being done.
And as I noted earlier,
changes to this pipeline code are committed the same as changes to the rest of the project,
keeping everything synchronized, reviewable, and testable at any commit.
In fact, you can view the full set of commits for this blog post in the
blog/sauce-pipeline
branch of the
bitwiseman/JS-Nightwatch.js
repository.

Links

Sauce OnDemand Plugin

bitwiseman/JS-Nightwatch.js

saucelabs-sample-test-frameworks<span class="more"></span></p></a><div class="attrs"><a href="/gatsby-jenkins-io/blog/authors/lnewman">Liam Newman</a><ul class="list-inline tags"><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/tutorial">tutorial</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/pipeline">pipeline</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/plugins">plugins</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/saucelabs">saucelabs</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/selenium">selenium</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/nightwatch">nightwatch</a></li></ul></div></li><li class="post"><a class="body" href="/gatsby-jenkins-io/blog/2016/08/10/rails-cd-with-pipeline/"><div class="header"><div class="date"><div class="month">Aug</div><div class="day">10</div></div><h5 class="title">Continuous Security for Rails apps with Pipeline and Brakeman</h5></div><p class="teaser">This is a guest post by R. Tyler Croy, who is a
long-time contributor to Jenkins and the primary contact for Jenkins project
infrastructure. He is also a Jenkins Evangelist at
CloudBees, Inc.

When the Ruby on Rails framework debuted it
changed the industry in two noteworthy ways: it created a trend of opinionated web
application frameworks ( Django,
Play, Grails) and it
also strongly encouraged thousands of developers to embrace test-driven
development along with many other modern best practices (source control, dependency
management, etc). Because Ruby, the language underneath Rails, is interpreted
instead of compiled there isn’t a &quot;build&quot; per se but rather tens, if not
hundreds, of tests, linters and scans which are run to ensure the application’s
quality. With the rise in popularity of Rails, the popularity of application
hosting services with easy-to-use deployment tools like Heroku or
Engine Yard rose too.

This combination of good test coverage and easily automated deployments
makes Rails easy to continuously deliver with Jenkins. In this post we’ll cover
testing non-trivial Rails applications with Jenkins
Pipeline and, as an added bonus, we will add security scanning via
Brakeman and the
Brakeman
plugin.

Topics

Preparing the app

Preparing Jenkins

Writing the Pipeline

Security scanning

Deploying the good stuff

Wrap up

For this demonstration, I used Ruby Central &#x27;s
cfp-app :

A Ruby on Rails application that lets you manage your conference’s call for
proposal (CFP), program and schedule. It was written by Ruby Central to run the
CFPs for RailsConf and RubyConf.

I chose this Rails app, not only because it’s a sizable application with lots
of tests, but it’s actually the application we used to collect talk proposals
for the &quot; Community Tracks&quot; at this
year’s Jenkins World. For the most part,
cfp-app is a standard Rails application. It uses
PostgreSQL for its database,
RSpec for its tests and
Ruby 2.3.x as its runtime.

If you prefer to just to look at the code, skip straight to the
Jenkinsfile.

Preparing the app

For most Rails applications there are few, if any, changes needed to enable
continuous delivery with Jenkins. In the case of
cfp-app, I added two gems to get
the most optimal integration into Jenkins:

ci_reporter, for test report
integration

brakeman, for security scanning.

Adding these was simple, I just needed to update the Gemfile and the
Rakefile in the root of the repository to contain:

Gemfile

# .. snip ..
group :test do
  # RSpec, etc
  gem &#x27;ci_reporter&#x27;
  gem &#x27;ci_reporter_rspec&#x27;
  gem &quot;brakeman&quot;, :require =&gt; false
end

Rakefile

# .. snip ..
require &#x27;ci/reporter/rake/rspec&#x27;
# Make sure we setup ci_reporter before executing our RSpec examples
task :spec =&gt; &#x27;ci:setup:rspec&#x27;

Preparing Jenkins

With the cfp-app project set up, next on the list is to ensure that Jenkins itself
is ready. Generally I suggest running the latest LTS of
Jenkins; for this demonstration I used Jenkins 2.7.1 with the following
plugins:

Pipeline plugin

Brakeman plugin

CloudBees
Docker Pipeline plugin

I also used the
GitHub
Organization Folder plugin to automatically create pipeline items in my
Jenkins instance; that isn’t required for the demo, but it’s pretty cool to see
repositories and branches with a Jenkinsfile automatically show up in
Jenkins, so I recommend it!

In addition to the plugins listed above, I also needed at least one
Jenkins agent with the Docker daemon installed and
running on it. I label these agents with &quot;docker&quot; to make it easier to assign
Docker-based workloads to them in the future.

Any Linux-based machine with Docker installed will work, in my case I was
provisioning on-demand agents with the
Azure
plugin which, like the
EC2 plugin,
helps keep my test costs down.

If you’re using Amazon Web Services, you might also be interested in
this blog post from
earlier this year unveiling the
EC2
Fleet plugin for working with EC2 Spot Fleets.

Writing the Pipeline

To make sense of the various things that the Jenkinsfile needs to do, I find
it easier to start by simply defining the stages of my pipeline. This helps me
think of, in broad terms, what order of operations my pipeline should have.
For example:

/* Assign our work to an agent labelled &#x27;docker&#x27; */
node(&#x27;docker&#x27;) {
    stage &#x27;Prepare Container&#x27;
    stage &#x27;Install Gems&#x27;
    stage &#x27;Prepare Database&#x27;
    stage &#x27;Invoke Rake&#x27;
    stage &#x27;Security scan&#x27;
    stage &#x27;Deploy&#x27;
}

As mentioned previously, this Jenkinsfile is going to rely heavily on the
CloudBees
Docker Pipeline plugin. The plugin provides two very important features:

Ability to execute steps inside of a running Docker container

Ability to run a container in the &quot;background.&quot;

Like most Rails applications, one can effectively test the application with two
commands: bundle install followed by bundle exec rake. I already had some
Docker images prepared with RVM and Ruby 2.3.0 installed,
which ensures a common and consistent starting point:

node(&#x27;docker&#x27;) {
    // .. &#x27;stage&#x27; steps removed
    docker.image(&#x27;rtyler/rvm:2.3.0&#x27;).inside { (1)
rvm &#x27;bundle install&#x27; (2)
rvm &#x27;bundle exec rake&#x27;
    } (3)
}

1
Run the named container. The inside method can take optional additional flags for the docker run command.

2
Execute our shell commands using our tiny sh step wrapper
rvm . This ensures that the shell code is executed in the correct RVM environment.

3
When the closure completes, the container will be destroyed.

Unfortunately, with this application, the bundle exec rake command will fail
if PostgreSQL isn’t available when the process starts. This is where the
second important feature of the CloudBees Docker Pipeline plugin comes
into effect: the ability to run a container in the &quot;background.&quot;

node(&#x27;docker&#x27;) {
    // .. &#x27;stage&#x27; steps removed
    /* Pull the latest `postgres` container and run it in the background */
    docker.image(&#x27;postgres&#x27;).withRun { container -&gt; (1)
echo &quot;PostgreSQL running in container ${container.id}&quot; (2)
} (3)
}

1
Run the container, effectively docker run postgres

2
Any number of steps can go inside the closure

3
When the closure completes, the container will be destroyed.

Running the tests

Combining these two snippets of Jenkins Pipeline is, in my opinion, where the
power of the DSL
shines:

node(&#x27;docker&#x27;) {
    docker.image(&#x27;postgres&#x27;).withRun { container -&gt;
        docker.image(&#x27;rtyler/rvm:2.3.0&#x27;).inside(&quot;--link=${container.id}:postgres&quot;) { (1)
stage &#x27;Install Gems&#x27;
            rvm &quot;bundle install&quot;

            stage &#x27;Invoke Rake&#x27;
            withEnv([&#x27;DATABASE_URL=postgres://postgres@postgres:5432/&#x27;]) { (2)
rvm &quot;bundle exec rake&quot;
            }
            junit &#x27;spec/reports/*.xml&#x27; (3)
}
    }
}

1
By passing the --link argument, the Docker daemon will allow the RVM container to talk to the PostgreSQL container under the host name &#x27;postgres&#x27;.

2
Use the withEnv step to set environment variables for everything that is in the closure. In this case, the cfp-app DB scaffolding will look for the DATABASE_URL variable to override the DB host/user/dbname defaults.

3
Archive the test reports generated by ci_reporter so that Jenkins can display test reports and trend analysis.

With this done, the basics are in place to consistently run the tests for
cfp-app in fresh Docker containers for each execution of the pipeline.

Security scanning

Using Brakeman, the security scanner for Ruby
on Rails, is almost trivially easy inside of Jenkins Pipeline, thanks to the
Brakeman
plugin which implements the publishBrakeman step.

Building off our example above, we can implement the &quot;Security scan&quot; stage:

node(&#x27;docker&#x27;) {
    /* --8 (1)
publishBrakeman &#x27;brakeman-output.tabs&#x27; (2)
/* --8

1
Run the Brakeman security scanner for Rails and store the output for later in brakeman-output.tabs

2
Archive the reports generated by Brakeman so that Jenkins can display detailed reports with trend analysis.

As of this writing, there is work in progress
( JENKINS-31202) to
render trend graphs from plugins like Brakeman on a pipeline project’s main
page.

Deploying the good stuff

Once the tests and security scanning are all working properly, we can start to
set up the deployment stage. Jenkins Pipeline provides the variable
currentBuild which we can use to determine whether our pipeline has been
successful thus far or not. This allows us to add the logic to only deploy when
everything is passing, as we would expect:

node(&#x27;docker&#x27;) {
    /* --8 (1)
sh &#x27;./deploy.sh&#x27; (2)
}
    else {
        mail subject: &quot;Something is wrong with ${env.JOB_NAME} ${env.BUILD_ID}&quot;,
                  to: &#x27;nobody@example.com&#x27;,
                body: &#x27;You should fix it&#x27;
    }
    /* --8

1
currentBuild has the result property which would be &#x27;SUCCESS&#x27;, &#x27;FAILED&#x27;, &#x27;UNSTABLE&#x27;, &#x27;ABORTED&#x27;

2
Only if currentBuild.result is successful should we bother invoking our deployment script (e.g. git push heroku master)

Wrap up

I have gratuitously commented the full
Jenkinsfile
which I hope is a useful summation of the work outlined above. Having worked
on a number of Rails applications in the past, the consistency provided by
Docker and Jenkins Pipeline above would have definitely improved those
projects&#x27; delivery times. There is still room for improvement however, which
is left as an exercise for the reader. Such as: preparing new containers with
all their
dependencies
built-in instead of installing them at run-time. Or utilizing the parallel
step for executing RSpec across multiple Jenkins agents simultaneously.

The beautiful thing about defining your continuous delivery, and continuous
security, pipeline in code is that you can continue to iterate on it!<span class="more"></span></p></a><div class="attrs"><a href="/gatsby-jenkins-io/blog/authors/rtyler">R. Tyler Croy</a><ul class="list-inline tags"><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/tutorial">tutorial</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/ruby">ruby</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/pipeline">pipeline</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/rails">rails</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/brakeman">brakeman</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/continuousdelivery">continuousdelivery</a></li></ul></div></li><li class="post"><a class="body" href="/gatsby-jenkins-io/blog/2016/07/18/pipeline-notifications/"><div class="header"><div class="date"><div class="month">Jul</div><div class="day">18</div></div><h5 class="title">Sending Notifications in Pipeline</h5></div><p class="teaser">This is a guest post by Liam Newman,
Technical Evangelist at CloudBees.

Rather than sitting and watching Jenkins for job status, I want Jenkins to send
notifications when events occur.  There are Jenkins plugins for
Slack,
HipChat,
or even email
among others.

Note: Something is happening!

I think we can all agree getting notified when events occur is preferable to
having to constantly monitor them just in case.  I’m going to continue from
where I left off in my
previous post with the
hermann project.  I added a Jenkins
Pipeline with an HTML publisher for code coverage. This week, I’d like to make
Jenkins to notify me when builds start and when they succeed or fail.

Setup and Configuration

First, I select targets for my notifications. For this blog post, I’ll use sample
targets that I control.  I’ve created Slack and HipChat organizations called
&quot;bitwiseman&quot;, each with one member - me.  And for email I’m running a Ruby SMTP server called
mailcatcher, that is perfect for local testing
such as this.  Aside for these concessions, configuration would be much the
same in a non-demo situation.

Next, I install and add server-wide configuration for the
Slack,
HipChat,
and Email-ext
plugins.  Slack and HipChat use API tokens - both products have integration
points on their side that generate tokens which I copy into my Jenkins
configuration. Mailcatcher SMTP runs locally. I just point Jenkins
at it.

Here’s what the Jenkins configuration section for each of these looks like:

Original Pipeline

Now I can start adding notification steps. The same as
last week, I’ll use the
Jenkins Pipeline Snippet Generator
to explore the step syntax for the notification plugins.

Here’s the base pipeline before I start making changes:

stage &#x27;Build&#x27;

node {
  // Checkout
  checkout scm

  // install required bundles
  sh &#x27;bundle install&#x27;

  // build and run tests with coverage
  sh &#x27;bundle exec rake build spec&#x27;

  // Archive the built artifacts
  archive (includes: &#x27;pkg/*.gem&#x27;)

  // publish html
  // snippet generator doesn&#x27;t include &quot;target:&quot;
  // https://issues.jenkins.io/browse/JENKINS-29711.
  publishHTML (target: [
      allowMissing: false,
      alwaysLinkToLastBuild: false,
      keepAll: true,
      reportDir: &#x27;coverage&#x27;,
      reportFiles: &#x27;index.html&#x27;,
      reportName: &quot;RCov Report&quot;
    ])
}

This pipeline expects to be run from a Jenkinsfile in SCM.
To copy and paste it directly into a Jenkins Pipeline job, replace the checkout scm step with
git &#x27;https://github.com/reiseburo/hermann.git&#x27;.

Job Started Notification

For the first change, I decide to add a &quot;Job Started&quot; notification.  The
snippet generator and then reformatting makes this straightforward:

node {

  notifyStarted()

  /* ... existing build steps ... */
}

def notifyStarted() {
  // send to Slack
  slackSend (color: &#x27;#FFFF00&#x27;, message: &quot;STARTED: Job &#x27;${env.JOB_NAME} [${env.BUILD_NUMBER}]&#x27; (${env.BUILD_URL})&quot;)

  // send to HipChat
  hipchatSend (color: &#x27;YELLOW&#x27;, notify: true,
      message: &quot;STARTED: Job &#x27;${env.JOB_NAME} [${env.BUILD_NUMBER}]&#x27; (${env.BUILD_URL})&quot;
    )

  // send to email
  emailext (
      subject: &quot;STARTED: Job &#x27;${env.JOB_NAME} [${env.BUILD_NUMBER}]&#x27;&quot;,
      body: &quot;&quot;&quot; STARTED: Job &#x27;${env.JOB_NAME} [${env.BUILD_NUMBER}]&#x27;:
Check console output at &quot; ${env.JOB_NAME} [${env.BUILD_NUMBER}]&quot;&quot;&quot;&quot;,
      recipientProviders: [[$class: &#x27;DevelopersRecipientProvider&#x27;]]
    )
}

Since Pipeline is a Groovy-based DSL, I can use
string interpolation
and variables to add exactly the details I want in my notification messages. When
I run this I get the following notifications:

Job Successful Notification

The next logical choice is to get notifications when a job succeeds.  I’ll
copy and paste based on the notifyStarted method for now and do some refactoring
later.

node {

  notifyStarted()

  /* ... existing build steps ... */

  notifySuccessful()
}

def notifyStarted() { /* .. */ }

def notifySuccessful() {
  slackSend (color: &#x27;#00FF00&#x27;, message: &quot;SUCCESSFUL: Job &#x27;${env.JOB_NAME} [${env.BUILD_NUMBER}]&#x27; (${env.BUILD_URL})&quot;)

  hipchatSend (color: &#x27;GREEN&#x27;, notify: true,
      message: &quot;SUCCESSFUL: Job &#x27;${env.JOB_NAME} [${env.BUILD_NUMBER}]&#x27; (${env.BUILD_URL})&quot;
    )

  emailext (
      subject: &quot;SUCCESSFUL: Job &#x27;${env.JOB_NAME} [${env.BUILD_NUMBER}]&#x27;&quot;,
      body: &quot;&quot;&quot; SUCCESSFUL: Job &#x27;${env.JOB_NAME} [${env.BUILD_NUMBER}]&#x27;:
Check console output at &quot; ${env.JOB_NAME} [${env.BUILD_NUMBER}]&quot;&quot;&quot;&quot;,
      recipientProviders: [[$class: &#x27;DevelopersRecipientProvider&#x27;]]
    )
}

Again, I get notifications, as expected.  This build is fast enough,
some of them are even on the screen at the same time:

Job Failed Notification

Next I want to add failure notification.  Here’s where we really start to see the power
and expressiveness of Jenkins pipeline.  A Pipeline is a Groovy script, so as we’d
expect in any Groovy script, we can handle errors using try-catch blocks.

node {
  try {
    notifyStarted()

    /* ... existing build steps ... */

    notifySuccessful()
  } catch (e) {
    currentBuild.result = &quot;FAILED&quot;
    notifyFailed()
    throw e
  }
}

def notifyStarted() { /* .. */ }

def notifySuccessful() { /* .. */ }

def notifyFailed() {
  slackSend (color: &#x27;#FF0000&#x27;, message: &quot;FAILED: Job &#x27;${env.JOB_NAME} [${env.BUILD_NUMBER}]&#x27; (${env.BUILD_URL})&quot;)

  hipchatSend (color: &#x27;RED&#x27;, notify: true,
      message: &quot;FAILED: Job &#x27;${env.JOB_NAME} [${env.BUILD_NUMBER}]&#x27; (${env.BUILD_URL})&quot;
    )

  emailext (
      subject: &quot;FAILED: Job &#x27;${env.JOB_NAME} [${env.BUILD_NUMBER}]&#x27;&quot;,
      body: &quot;&quot;&quot; FAILED: Job &#x27;${env.JOB_NAME} [${env.BUILD_NUMBER}]&#x27;:
Check console output at &quot; ${env.JOB_NAME} [${env.BUILD_NUMBER}]&quot;&quot;&quot;&quot;,
      recipientProviders: [[$class: &#x27;DevelopersRecipientProvider&#x27;]]
    )
}

Code Cleanup

Lastly, now that I have it all working, I’ll do some refactoring. I’ll unify
all the notifications in one method and move the final success/failure notification
into a finally block.

stage &#x27;Build&#x27;

node {
  try {
    notifyBuild(&#x27;STARTED&#x27;)

    /* ... existing build steps ... */

  } catch (e) {
    // If there was an exception thrown, the build failed
    currentBuild.result = &quot;FAILED&quot;
    throw e
  } finally {
    // Success or failure, always send notifications
    notifyBuild(currentBuild.result)
  }
}

def notifyBuild(String buildStatus = &#x27;STARTED&#x27;) {
  // build status of null means successful
  buildStatus = buildStatus ?: &#x27;SUCCESS&#x27;

  // Default values
  def colorName = &#x27;RED&#x27;
  def colorCode = &#x27;#FF0000&#x27;
  def subject = &quot;${buildStatus}: Job &#x27;${env.JOB_NAME} [${env.BUILD_NUMBER}]&#x27;&quot;
  def summary = &quot;${subject} (${env.BUILD_URL})&quot;
  def details = &quot;&quot;&quot; STARTED: Job &#x27;${env.JOB_NAME} [${env.BUILD_NUMBER}]&#x27;:
Check console output at &quot; ${env.JOB_NAME} [${env.BUILD_NUMBER}]&quot;&quot;&quot;&quot;

  // Override default values based on build status
  if (buildStatus == &#x27;STARTED&#x27;) {
    color = &#x27;YELLOW&#x27;
    colorCode = &#x27;#FFFF00&#x27;
  } else if (buildStatus == &#x27;SUCCESS&#x27;) {
    color = &#x27;GREEN&#x27;
    colorCode = &#x27;#00FF00&#x27;
  } else {
    color = &#x27;RED&#x27;
    colorCode = &#x27;#FF0000&#x27;
  }

  // Send notifications
  slackSend (color: colorCode, message: summary)

  hipchatSend (color: color, notify: true, message: summary)

  emailext (
      subject: subject,
      body: details,
      recipientProviders: [[$class: &#x27;DevelopersRecipientProvider&#x27;]]
    )
}

You have been notified!

I now get notified twice per build on three different channels.  I’m not sure I
need to get notified this much for such a short build.  However, for a longer
or complex CD pipeline, I might want exactly that.  If needed, I could even
improve this to handle other status strings and call it as needed throughout
my pipeline.

Links

Slack Plugin

HipChat Plugin

Email-ext Plugin

Jenkins Pipeline Snippet Generator<span class="more"></span></p></a><div class="attrs"><a href="/gatsby-jenkins-io/blog/authors/lnewman">Liam Newman</a><ul class="list-inline tags"><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/tutorial">tutorial</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/pipeline">pipeline</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/plugins">plugins</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/notifications">notifications</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/slack">slack</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/hipchat">hipchat</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/emailext">emailext</a></li></ul></div></li><li class="post"><a class="body" href="/gatsby-jenkins-io/blog/2016/07/01/html-publisher-plugin/"><div class="header"><div class="date"><div class="month">Jul</div><div class="day"> 1</div></div><h5 class="title">Publishing HTML Reports in Pipeline</h5></div><p class="teaser">This is a guest post by Liam Newman,
Technical Evangelist at CloudBees.

Most projects need more that just JUnit result reporting.  Rather than writing a
custom plugin for each type of report, we can use the
HTML Publisher Plugin.

Let’s Make This Quick

I’ve found a Ruby project,
hermann, I’d like to build using Jenkins Pipeline. I’d
also like to have the code coverage results published with each build job.  I could
write a plugin to publish this data, but I’m in a bit of hurry and
the build already creates an HTML report file using SimpleCov
when the unit tests run.

Simple Build

I’m going to use the
HTML Publisher Plugin
to add the HTML-formatted code coverage report to my builds.  Here’s a simple
pipeline for building the hermann
project.

stage &#x27;Build&#x27;

node {
  // Checkout
  checkout scm

  // install required bundles
  sh &#x27;bundle install&#x27;

  // build and run tests with coverage
  sh &#x27;bundle exec rake build spec&#x27;

  // Archive the built artifacts
  archive (includes: &#x27;pkg/*.gem&#x27;)
}

This pipeline expects to be run from a Jenkinsfile in SCM.
To copy and paste it directly into a Jenkins Pipeline job, replace the checkout scm step with
git &#x27;https://github.com/reiseburo/hermann.git&#x27;.

Simple enough, it builds, runs tests, and archives the package.

Now I just need to add the step to publish the code coverage report.
I know that rake spec creates an index.html file in the coverage directory.
I’ve already installed the
HTML Publisher Plugin.
How do I add the HTML publishing step to the pipeline?  The plugin page doesn’t
say anything about it.

Snippet Generator to the Rescue

Documentation is hard to maintain and easy to miss, even more so in a system
like Jenkins with hundreds of plugins the each potential have one or more
groovy fixtures to add to the Pipeline.  The Pipeline Syntax&quot;Snippet Generator&quot; helps users
navigate this jungle by providing a way to generate a code snippet for any step using
provided inputs.

It offers a dynamically generated list of steps, based on the installed plugins.
From that list I select the publishHTML step:

Then it shows me a UI similar to the one used in job configuration.  I fill in
the fields, click &quot;generate&quot;, and it shows me snippet of groovy generated from
that input.

HTML Published

I can use that snippet directly or as a template for further customization.
In this case, I’ll just reformat and copy it in at the end of my
pipeline.  (I ran into a minor bug
in the snippet generated for this plugin step. Typing
error string in my search bar immediately found the bug and a workaround.)

/* ...unchanged... */

  // Archive the built artifacts
  archive (includes: &#x27;pkg/*.gem&#x27;)

  // publish html
  // snippet generator doesn&#x27;t include &quot;target:&quot;
  // https://issues.jenkins.io/browse/JENKINS-29711.
  publishHTML (target: [
      allowMissing: false,
      alwaysLinkToLastBuild: false,
      keepAll: true,
      reportDir: &#x27;coverage&#x27;,
      reportFiles: &#x27;index.html&#x27;,
      reportName: &quot;RCov Report&quot;
    ])

}

When I run this new pipeline I am rewarded with an RCov Report link on left side,
which I can follow to show the HTML report.

I even added the keepAll setting to let I can also go back an look at reports on old jobs as
more come in.  As I said to to begin with, this is not as slick as what I
could do with a custom plugin, but it is much easier and works with any static
HTML.

Links

HTML Publisher Plugin

Jenkins Pipeline Snippet Generator<span class="more"></span></p></a><div class="attrs"><a href="/gatsby-jenkins-io/blog/authors/lnewman">Liam Newman</a><ul class="list-inline tags"><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/tutorial">tutorial</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/pipeline">pipeline</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/plugins">plugins</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/ruby">ruby</a></li></ul></div></li><li class="post"><a class="body" href="/gatsby-jenkins-io/blog/2016/06/16/parallel-test-executor-plugin/"><div class="header"><div class="date"><div class="month">Jun</div><div class="day">16</div></div><h5 class="title">Faster Pipelines with the Parallel Test Executor Plugin</h5></div><p class="teaser">This is a guest post by Liam Newman,
Technical Evangelist at CloudBees.

In this blog post, I’ll show you how to speed up your pipeline by using the
Parallel Test Executor Plugin.

So much to do, so little time…​

In my career, I’ve helped many teams move to continuous integration and delivery. One problem
we always encounter is how to run all the tests needed to ensure high-quality
changes while still keeping pipeline times reasonable and changes flowing
smoothly. More tests mean greater confidence, but also longer wait times.
Build systems may or may not support running tests in parallel, but they still only use one
machine even while other lab machines sit idle. In these cases, parallelizing
test execution across multiple machines is a great way to speed up pipelines.
The Parallel Test Executor plugin lets us leverage Jenkins do just that with no
disruption to the rest of the build system.

Serial Test Execution

For this post, I’ll be running a pipeline based on the
Jenkins Git Plugin. I’ve modified
the Jenkinsfile from that project to allow us to compare execution times to our
later changes, and I’ve truncated the &quot;mvn&quot; utility method since it remains
unchanged.  You can find the original file
here.

node {
  stage &#x27;Checkout&#x27;
  checkout scm

  stage &#x27;Build&#x27;

  /* Call the Maven build without tests. */
  mvn &quot;clean install -DskipTests&quot;

  stage &#x27;Test&#x27;
  runTests()

  /* Save Results. */
  stage &#x27;Results&#x27;

  /* Archive the build artifacts */
  archive includes: &#x27;target/*.hpi,target/*.jpi&#x27;
}

void runTests(def args) {
  /* Call the Maven build with tests. */
  mvn &quot;install -Dmaven.test.failure.ignore=true&quot;

  /* Archive the test results */
  junit &#x27;**/target/surefire-reports/TEST-*.xml&#x27;
}

/* Run Maven */
void mvn(def args) { /* ... */ }

This pipeline expects to be run from a Jenkinsfile in SCM.
To copy and paste it directly into a Jenkins Pipeline job, replace the checkout scm step with
git &#x27;https://github.com/jenkinsci/git-plugin.git&#x27;.

This is a Maven project, so the Jenkinsfile is pretty simple.
I’ve split the Maven build into separate “Build” and “Test”
stages. Maven doesn’t support this split very well, it wants to run all
the steps of the lifecycle in order every time. So, I have to call Maven twice:
first using the “skipTests” property to do only build steps in the first call,
and then a second time with out that property to run tests.

On my quad-core machine, executing this pipeline takes about 13 minutes and 30
seconds.  Of that time, it takes 13 minutes to run about 2.7 thousand tests in
serial.

Parallel Test Execution

This looks like an ideal project for parallel test execution: a short build
followed by a large number of serially executed tests that consume the most of
the pipeline time. There are a number of things I could try to speed this up.
For example, I could modify test harness to look for ways to parallelize
the test execution on this single machine. Or I could try speed up the tests
themselves. Both of those can be time-consuming and both risk destabilizing the
tests. I’d need to know more about the project to do it well.

I’ll avoid that risk by using Jenkins and the
Parallel Test Executor Plugin to
parallelize the tests across multiple nodes instead. This will isolate the tests
from each other, while still giving us speed gains from parallel execution.

The plugin reads the list of tests from the results archived in the previous execution of this
job and splits that list into a specified number of sublists. I can then use
those sublists to execute the tests in parallel, passing a different sublist to
each node.

Let’s look at how this changes the pipeline:

node { /* ...unchanged... */ }

void runTests(def args) {
  /* Request the test groupings.  Based on previous test results. */
  /* see https://wiki.jenkins.io/display/JENKINS/Parallel+Test+Executor+Plugin and demo on github
  /* Using arbitrary parallelism of 4 and &quot;generateInclusions&quot; feature added in v1.8. */
  def splits = splitTests parallelism: [$class: &#x27;CountDrivenParallelism&#x27;, size: 4], generateInclusions: true

  /* Create dictionary to hold set of parallel test executions. */
  def testGroups = [:]

  for (int i = 0; i }. */
    /*     includes = whether list specifies tests to include (true) or tests to exclude (false). */
    /*     list = list of tests for inclusion or exclusion. */
    /* The list of inclusions is constructed based on results gathered from */
    /* the previous successfully completed job. One additional record will exclude */
    /* all known tests to run any tests not seen during the previous run.  */
    testGroups[&quot;split-${i}&quot;] = {  // example, &quot;split3&quot;
      node {
        checkout scm

        /* Clean each test node to start. */
        mvn &#x27;clean&#x27;

        def mavenInstall = &#x27;install -DMaven.test.failure.ignore=true&#x27;

        /* Write includesFile or excludesFile for tests.  Split record provided by splitTests. */
        /* Tell Maven to read the appropriate file. */
        if (split.includes) {
          writeFile file: &quot;target/parallel-test-includes-${i}.txt&quot;, text: split.list.join(&quot;\n&quot;)
          mavenInstall += &quot; -Dsurefire.includesFile=target/parallel-test-includes-${i}.txt&quot;
        } else {
          writeFile file: &quot;target/parallel-test-excludes-${i}.txt&quot;, text: split.list.join(&quot;\n&quot;)
          mavenInstall += &quot; -Dsurefire.excludesFile=target/parallel-test-excludes-${i}.txt&quot;
        }

        /* Call the Maven build with tests. */
        mvn mavenInstall

        /* Archive the test results */
        junit &#x27;**/target/surefire-reports/TEST-*.xml&#x27;
      }
    }
  }
  parallel testGroups
}

/* Run Maven */
void mvn(def args) { /* ... */ }

That’s it!  The change is significant but it is all encapsulated in this one
method in the Jenkinsfile.

Great (ish) Success!

Here’s the results for the new pipeline with parallel test execution:

The tests ran almost twice as fast, without changes outside pipeline.  Great!

However, I used 4 test executors, so why am I not seeing a 4x? improvement.
A quick review of the logs shows the problem: A small number of tests are taking up
to 5 minutes each to complete! This is actually good news. It means that I
should be able to see further improvement in pipeline throughput just by refactoring
those few long running tests into smaller parts.

Conclusion

While I would like to have seen closer to a 4x improvement to match to number
of executors, 2x is still perfectly respectable. If I were working on a group of projects
with similar pipelines, I’d be completely comfortable reusing these same changes
on my other project and I’d expect to similar improvement without any disruption to
other tools or processes.

Links

https://wiki.jenkins.io/display/JENKINS/Parallel+Test+Executor+Plugin<span class="more"></span></p></a><div class="attrs"><a href="/gatsby-jenkins-io/blog/authors/lnewman">Liam Newman</a><ul class="list-inline tags"><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/tutorial">tutorial</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/pipeline">pipeline</a></li><li><a class="tag-link" href="/gatsby-jenkins-io/node/tags/plugins">plugins</a></li></ul></div></li></ul></div></div><div><nav><ul class="pagination"><li class="page-item "><a class="page-link" href="/gatsby-jenkins-io/node/tags/tutorial">«</a></li><li class="page-item "><a class="page-link" href="/gatsby-jenkins-io/node/tags/tutorial">1</a></li><li class="page-item active"><a aria-current="page" class="page-link" href="/gatsby-jenkins-io/node/tags/tutorial/page/2">2</a></li><li class="page-item "><a class="page-link" href="/gatsby-jenkins-io/node/tags/tutorial/page/3">3</a></li><li class="page-item "><a class="page-link" href="/gatsby-jenkins-io/node/tags/tutorial/page/4">4</a></li><li class="page-item "><a class="page-link" href="/gatsby-jenkins-io/node/tags/tutorial/page/3">»</a></li></ul></nav></div></div></div><script src="https://www.jenkins.io/assets/bower/anchor-js/anchor.min.js"></script><script src="https://www.jenkins.io/assets/bower/tether/js/tether.min.js"></script><script src="https://www.jenkins.io/assets/bower/bootstrap/js/bootstrap.min.js"></script><footer id="footer"><div class="container"><div class="row"><div class="col-md-4"><div class="license-box"><div id="creativecommons"><a href="https://creativecommons.org/licenses/by-sa/4.0/"><p><img alt="Creative Commons Attribution-ShareAlike license" src="https://licensebuttons.net/l/by-sa/4.0/88x31.png"/></p></a><p>The content driving this site is licensed under the Creative Commons Attribution-ShareAlike 4.0 license.</p></div></div></div><div class="links col-md-8"><div class="container"><div class="row"><div class="area col-md-3"><div class="div-mar"><h5>Resources</h5><ul class="resources"><li><a href="https://www.jenkins.io/download/">Downloads</a></li><li><a href="https://www.jenkins.io/node/">Blog</a></li><li><a href="https://www.jenkins.io/doc/">Documentation</a></li><li><a href="https://plugins.jenkins.io/">Plugins</a></li><li><a href="https://www.jenkins.io/security/">Security</a></li><li><a href="https://www.jenkins.io/participate/">Contributing</a></li></ul></div></div><div class="area col-md-3"><div class="div-mar"><h5>Project</h5><ul class="project"><li><a href="https://www.jenkins.io/project/">Structure and governance</a></li><li><a href="https://issues.jenkins.io">Issue tracker</a></li><li><a href="https://www.jenkins.io/project/roadmap/">Roadmap</a></li><li><a href="https://github.com/jenkinsci">GitHub</a></li><li><a href="https://ci.jenkins.io">Jenkins on Jenkins</a></li></ul></div></div><div class="area col-md-3"><div class="div-mar"><h5>Community</h5><ul class="community"><li><a href="https://www.jenkins.io/events/">Events</a></li><li><a href="https://www.jenkins.io/mailing-lists/">Mailing lists</a></li><li><a href="https://www.jenkins.io/chat/">Chats</a></li><li><a href="https://www.jenkins.io/sigs/">Special Interest Groups</a></li><li><a href="https://twitter.com/jenkinsci">Twitter</a></li><li><a href="https://reddit.com/r/jenkinsci">Reddit</a></li></ul></div></div><div class="area col-md-3"><div class="div-mar"><h5>Other</h5><ul class="other"><li><a href="https://www.jenkins.io/conduct/">Code of Conduct</a></li><li><a href="https://www.jenkins.io/press/">Press information</a></li><li><a href="https://www.jenkins.io/merchandise/">Merchandise</a></li><li><a href="https://www.jenkins.io/artwork/">Artwork</a></li><li><a href="https://www.jenkins.io/awards/">Awards</a></li></ul></div></div></div></div></div></div></div></footer><script>
  $(function(){
    var $body = $(document.body);
    $(".nav-link.dropdown-toggle").on("mousedown", function(){
      $body.addClass("no-outline");
    })
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/node/tags/tutorial/page/2";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-ea100fe6f02bbc648246.js"],"app":["/app-43188d140ca63afb8771.js"],"component---src-pages-404-js":["/component---src-pages-404-js-47ac51e928948b38608d.js"],"component---src-pages-index-js":["/component---src-pages-index-js-1a97f429813fea6561af.js"],"component---src-pages-page-2-js":["/component---src-pages-page-2-js-74b0880e66be9d8858e3.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-c165de62207de7fb5221.js"],"component---src-templates-author-blog-list-template-js":["/component---src-templates-author-blog-list-template-js-4fd3352763eb6aa9a207.js"],"component---src-templates-blog-list-template-js":["/component---src-templates-blog-list-template-js-e2cd9207924d94609c6a.js"],"component---src-templates-post-js":["/component---src-templates-post-js-ab70778cc73419c5af08.js"],"component---src-templates-tag-blog-list-template-js":["/component---src-templates-tag-blog-list-template-js-381f7f48e804ae2ed26a.js"]};/*]]>*/</script><script src="/gatsby-jenkins-io/polyfill-ea100fe6f02bbc648246.js" nomodule=""></script><script src="/gatsby-jenkins-io/component---src-templates-tag-blog-list-template-js-381f7f48e804ae2ed26a.js" async=""></script><script src="/gatsby-jenkins-io/commons-12cbe55ce4f6cbfe1e93.js" async=""></script><script src="/gatsby-jenkins-io/app-43188d140ca63afb8771.js" async=""></script><script src="/gatsby-jenkins-io/framework-094b0089736b8f621f0d.js" async=""></script><script src="/gatsby-jenkins-io/webpack-runtime-a27851d3e55b75342059.js" async=""></script></body></html>