{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/blog/2013/06/21/reducing-the-of-threads-in-jenkins-ssh-slaves/",
    "result": {"data":{"blog":{"html":"<div class=\"literalblock\">\n<div class=\"content\">\n<pre class=\"nowrap\"> +\nAs the usage of Jenkins expands, we started seeing users who run multiple 100s of agents on one controller, and thus it became a lot more important for us to scale well to even larger number of agents. +\n +</pre>\n</div>\n</div>\n<div class=\"literalblock\">\n<div class=\"content\">\n<pre class=\"nowrap\"> +\nWhile I was looking at the thread dump of a large system, I started noticing that there are a large number of threads lying around pumping `+InputStream+` and writing to another `+OutputStream+`. On Linux, each thread occupies 2MB just for its stack size, so if we can eliminate some of them, it'd be a good saving. +\n +</pre>\n</div>\n</div>\n<div class=\"literalblock\">\n<div class=\"content\">\n<pre class=\"nowrap\"> +\nSo this morning, I tackled one source of such waste. +\n +</pre>\n</div>\n</div>\n<div class=\"literalblock\">\n<div class=\"content\">\n<pre class=\"nowrap\"> +\nJenkins has https://wiki.jenkins.io/display/JENKINS/SSH+Slaves+plugin[the ability to launch agent on a remote server via SSH] for the longest time, and to simplify this, we've been using a https://github.com/jenkinsci/trilead-ssh2[pure-Java implementation of SSH client]. +\n +</pre>\n</div>\n</div>\n<div class=\"literalblock\">\n<div class=\"content\">\n<pre class=\"nowrap\"> +\nTo cut the long story short, I was able to eliminate two pump threads per every SSH connection. Furthermore, when it runs on the upcoming Jenkins 1.521, it'll save one more thread per every SSH connection. So if you have 100 agents connected through SSH, this alone saves up 600MB of memory. That's pretty good for a few hours work! +\n +</pre>\n</div>\n</div>\n<div class=\"literalblock\">\n<div class=\"content\">\n<pre class=\"nowrap\"> +\nIf you run a lot of agents, be sure to pick up version 0.27 of https://wiki.jenkins.io/display/JENKINS/SSH+Slaves+plugin[the SSH agents plugin] to take advantages of this! +</pre>\n</div>\n</div>","id":"24926dd2-b6f9-5057-9f68-59a583212c04","title":"Reducing the # of threads in Jenkins: SSH agents","date":"2013-06-21T00:00:00.000Z","slug":"/blog/2013/06/21/reducing-the-of-threads-in-jenkins-ssh-slaves/","links":{"discourse":""},"authors":[{"avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/gatsby-jenkins-io/static/dd191cfa3b1158515bff16d455e6117b/edb43/kohsuke.jpg","srcSet":"/gatsby-jenkins-io/static/dd191cfa3b1158515bff16d455e6117b/f81fe/kohsuke.jpg 32w,\n/gatsby-jenkins-io/static/dd191cfa3b1158515bff16d455e6117b/01b1b/kohsuke.jpg 64w,\n/gatsby-jenkins-io/static/dd191cfa3b1158515bff16d455e6117b/edb43/kohsuke.jpg 128w","sizes":"(min-width: 128px) 128px, 100vw"},"sources":[{"srcSet":"/gatsby-jenkins-io/static/dd191cfa3b1158515bff16d455e6117b/035c3/kohsuke.webp 32w,\n/gatsby-jenkins-io/static/dd191cfa3b1158515bff16d455e6117b/273f8/kohsuke.webp 64w,\n/gatsby-jenkins-io/static/dd191cfa3b1158515bff16d455e6117b/e3840/kohsuke.webp 128w","type":"image/webp","sizes":"(min-width: 128px) 128px, 100vw"}]},"width":128,"height":148}},"publicURL":"/gatsby-jenkins-io/static/dd191cfa3b1158515bff16d455e6117b/kohsuke.jpeg"},"blog":null,"github":"kohsuke","html":"<div class=\"paragraph\">\n<p>Kohsuke is the creator of Jenkins.</p>\n</div>","id":"kohsuke","irc":null,"linkedin":null,"name":"Kohsuke Kawaguchi","slug":"/blog/authors/kohsuke","twitter":"kohsukekawa"}]}},"pageContext":{"id":"24926dd2-b6f9-5057-9f68-59a583212c04"}},
    "staticQueryHashes": ["1271460761","3649515864"]}