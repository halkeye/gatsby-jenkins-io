{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/blog/2018/06/18/remoting-over-message-bus/",
    "result": {"data":{"blog":{"html":"<div class=\"sect2\">\n<h3 id=\"about-me\"><a class=\"anchor\" href=\"#about-me\"></a>About me</h3>\n<div class=\"paragraph\">\n<p>My name is Pham Vu Tuan, I am a final year undergraduate student from Singapore. This is the first time I participate in Google Summer of Code and contribute to an open-source organization. I am very excited to contribute this summer.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"mentors\"><a class=\"anchor\" href=\"#mentors\"></a>Mentors</h3>\n<div class=\"paragraph\">\n<p>I have GSoC mentors who help me in this project <a href=\"https://github.com/oleg-nenashev\">Oleg Nenashev</a> and <a href=\"https://github.com/Supun94\">Supun Wanniarachchi</a>. Besides that, I also receive great support from developers in remoting project <a href=\"https://github.com/dwnusbaum\">Devin Nusbaum</a> and <a href=\"https://github.com/jeffret-b\">Jeff Thompson</a>.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"overview\"><a class=\"anchor\" href=\"#overview\"></a>Overview</h3>\n<div class=\"paragraph\">\n<p>Current versions of Jenkins Remoting are based on the TCP protocol. If it fails, the agent connection and the build fails as well. There are also issues with traffic prioritization and multi-agent communications, which impact Jenkins stability and scalability.</p>\n</div>\n<div class=\"paragraph\">\n<p>This project aims to develop a plugin in order to add support of a popular message queue/bus technology (Kafka) as a fault-tolerant communication layer in Jenkins.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"why-kafka\"><a class=\"anchor\" href=\"#why-kafka\"></a>Why Kafka?</h3>\n<div class=\"paragraph\">\n<p>When planning for this project, we want to use traditional message queue system such as <a href=\"https://github.com/oleg-nenashev\">ActiveMQ</a> or <a href=\"https://github.com/oleg-nenashev\">RabbitMQ</a>. However, after some discussion, we decided to have a try with <a href=\"https://kafka.apache.org/\">Kafka</a> with more suitable features with this project:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Kafka itself is not a queue like ActiveMQ or RabbitMQ, it is a distributed, replicated commit log. This helps to remove message delivery complexity we have in traditional queue system.</p>\n</li>\n<li>\n<p>We need to support data streaming as a requirement, and Kafka is good at this aspect, which RabbitMQ is lack of.</p>\n</li>\n<li>\n<p>Kafka is said to have a better scalability and good support from the development community.</p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"current-state\"><a class=\"anchor\" href=\"#current-state\"></a>Current State</h3>\n<div class=\"paragraph\">\n<p>The project is reaching the end of the first phase and here are things we have achieved so far:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Setup project as a set of Docker Compose components: Kafka cluster, Jenkins controller (with plugin) and a custom agent (JAR).</p>\n</li>\n<li>\n<p>Create a PoC with new command transport implementation to support Kafka, which involves of command invocation, RMI, classloading and data streaming.</p>\n</li>\n<li>\n<p>Make neccessary changes in Remoting and Jenkins core to make them extensible for the use of this project.</p>\n</li>\n<li>\n<p>Decide to use Kafka as a suitable final implementation.</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>We planned to release an alpha version of this plugin by the end of this phase, but decided to move this release to the second phase because we need to wait for remoting and core patches to be released.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"architecture-overview\"><a class=\"anchor\" href=\"#architecture-overview\"></a>Architecture Overview</h3>\n<div class=\"paragraph\">\n<p>The project consists of multiple components:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Kafka Client Library - new command transport implementation, producer and consumer client logic.</p>\n</li>\n<li>\n<p>Remoting Kafka Plugin - plugin implementation with KafkaGlobalConfiguration and KafkaComputerLauncher.</p>\n</li>\n<li>\n<p>Remoting Kafka Agent - A custom JAR agent with remoting JAR packaged together with a custom Engine implementation to setup a communication channel with Kafka.</p>\n</li>\n<li>\n<p>All the components are packaged together with Docker Compose.</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>The below diagram is the overview of the current architecture:\n<span class=\"image center\"><img src=\"/images/post-images/remoting-kafka-intro/remoting-kafka-architecture.png\" alt=\"remoting kafka architecture\" title=\"Remoting Kafka Plugin Current Architecture\"></span></p>\n</div>\n<div class=\"paragraph\">\n<p>With this design, controller is not communicating with agent using direct TCP communication anymore, all the communication commands are transfered with Kafka.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"features\"><a class=\"anchor\" href=\"#features\"></a>Features</h3>\n<div class=\"sect3\">\n<h4 id=\"1-kafka-global-configuration\"><a class=\"anchor\" href=\"#1-kafka-global-configuration\"></a>1. Kafka Global Configuration</h4>\n<div class=\"paragraph\">\n<p><span class=\"image center\"><img src=\"/images/post-images/remoting-kafka-intro/kafka-global-config.png\" alt=\"kafka global config\" title=\"Remoting Kafka Global Configuration\"></span></p>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"2-custom-agent-start-up-as-a-jar\"><a class=\"anchor\" href=\"#2-custom-agent-start-up-as-a-jar\"></a>2. Custom agent start up as a JAR</h4>\n<div class=\"paragraph\">\n<p>User can start running an agent with the following command:\n<span class=\"image center\"><img src=\"/images/post-images/remoting-kafka-intro/start-agent.png\" alt=\"start agent\" title=\"Command to start an agent\"></span></p>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"3-launch-agents-with-kafka\"><a class=\"anchor\" href=\"#3-launch-agents-with-kafka\"></a>3. Launch agents with Kafka</h4>\n<div class=\"paragraph\">\n<p><span class=\"image center\"><img src=\"/images/post-images/remoting-kafka-intro/launch-agent-kafka.png\" alt=\"launch agent kafka\" title=\"Launch agent with Kafka\"></span></p>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"4-commands-transferred-between-controller-and-agent-over-kafka\"><a class=\"anchor\" href=\"#4-commands-transferred-between-controller-and-agent-over-kafka\"></a>4. Commands transferred between controller and agent over Kafka</h4>\n<div class=\"paragraph\">\n<p><span class=\"image center\"><img src=\"/images/post-images/remoting-kafka-intro/kafka-commands.png\" alt=\"kafka commands\" title=\"controller-agent communication with Kafka\"></span></p>\n</div>\n<div class=\"paragraph\">\n<p>Remoting operations are being executed over Kafka. In the log you may see:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Classloading (Classloader.fetch())</p>\n</li>\n<li>\n<p>Log streaming (Pipe.chunk())</p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"5-run-jobs-with-remoting-kafka\"><a class=\"anchor\" href=\"#5-run-jobs-with-remoting-kafka\"></a>5. Run jobs with remoting Kafka</h4>\n<div class=\"paragraph\">\n<p>It is possible to run jobs on Agents connected over Kafka\n<span class=\"image center\"><img src=\"/images/post-images/remoting-kafka-intro/remoting-kafka-run-job.png\" alt=\"remoting kafka run job\" title=\"Job run with Remoting Kafka Plugin\"></span></p>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"next-phase-plan\"><a class=\"anchor\" href=\"#next-phase-plan\"></a>Next Phase Plan</h3>\n<div class=\"paragraph\">\n<p>Here are the tasks planned for the next phase:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Support security for controller-agent connection:</p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Kafka authentication/authorization (<a href=\"https://issues.jenkins.io/browse/JENKINS-51472\">JENKINS-51472</a>, <a href=\"https://issues.jenkins.io/browse/JENKINS-51473\">JENKINS-51473</a>).</p>\n</li>\n<li>\n<p>Agent secrets (<a href=\"https://issues.jenkins.io/browse/JENKINS-51470\">JENKINS-51470</a>).</p>\n</li>\n</ul>\n</div>\n</li>\n<li>\n<p>Improve Kafka producer-consumer model to ensure reliability (<a href=\"https://issues.jenkins.io/browse/JENKINS-51942\">JENKINS-51942</a>).</p>\n</li>\n<li>\n<p>Bug fixing.</p>\n</li>\n<li>\n<p>Release alpha version and address feedback (<a href=\"https://issues.jenkins.io/browse/JENKINS-51713\">JENKINS-51713</a>).</p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"how-to-run-demo\"><a class=\"anchor\" href=\"#how-to-run-demo\"></a>How to run demo</h3>\n<div class=\"paragraph\">\n<p>You can try to run a demo of the plugin by following the <a href=\"https://github.com/jenkinsci/remoting-kafka-plugin/#plugin-demo-instructions\">instruction</a>.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"links\"><a class=\"anchor\" href=\"#links\"></a>Links</h3>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://gitter.im/jenkinsci/remoting\"><span class=\"image\"><img src=\"https://badges.gitter.im/jenkinsci/remoting.svg\" alt=\"title: &quot;Gitter&quot;\"></span></a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/jenkinsci/remoting-kafka-plugin\">GitHub Repository</a></p>\n</li>\n<li>\n<p><a href=\"https://jenkins.io/projects/gsoc/2018/remoting-over-message-bus/\">Project Page</a></p>\n</li>\n<li>\n<p><a href=\"https://youtu.be/qWHM8S0fzUw\">Phase 1 Presentation Video</a></p>\n</li>\n<li>\n<p><a href=\"https://docs.google.com/presentation/d/1GxkI17lZYQ6_pyAOR9sXNXq1K3LwkqjigXdxxf81VkE/edit?usp=sharing\">Phase 1 Presentation Slides</a></p>\n</li>\n</ul>\n</div>\n</div>","id":"88647b04-059d-549e-a712-a9dfe1d2427e","title":"GSoC Project Intro: Jenkins Remoting over Message Bus/Queue","date":"2018-06-18T00:00:00.000Z","slug":"/blog/2018/06/18/remoting-over-message-bus/","links":{"discourse":""},"authors":[{"avatar":{"childImageSharp":null},"blog":null,"github":"pvtuan10","html":"<div class=\"paragraph\">\n<p>Pham Vu Tuan is a developer from Singapore.\nHe starts contributing to Jenkins from Google Summer of Code 2018 for <a href=\"https://jenkins.io/projects/gsoc/2018/remoting-over-message-bus/\">Jenkins Remoting over Message Bus/Queue</a></p>\n</div>","id":"pvtuan10","irc":"pvtuan10","linkedin":null,"name":"Pham Vu Tuan","slug":"blog/author/pvtuan10","twitter":null}]}},"pageContext":{"next":"/blog/2018/06/19/jenkins-java10-hackathon-day2/","previous":"/blog/2018/06/17/running-jenkins-with-java10-11/","id":"88647b04-059d-549e-a712-a9dfe1d2427e"}},
    "staticQueryHashes": ["1271460761","3649515864"]}