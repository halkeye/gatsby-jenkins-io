{
    "componentChunkName": "component---src-templates-blog-list-template-js",
    "path": "/blog/page/45",
    "result": {"data":{"allBlog":{"edges":[{"node":{"date":"2016-12-09T00:00:00.000Z","id":"08ea2c86-7b22-5481-88a2-4bdcb1cfe5be","slug":"/blog/2016/12/09/december-jenkins-events/","strippedHtml":"Happy Holidays! A special shout out to all JAM leaders who continue to keep\nlocal activities going in December.\n\nOnline JAM\n\nDecember 14 | Live Demos: Pipeline, Git, and Blue Ocean\n\nNorth America\n\nDecember 7 | Seattle JAM: Jenkins at Microsoft\n\nDecember 14 | Los Angeles JAM: Jenkins Days\n\nDecember 14 | Guadalajara JAM: Jenkins & Docker\n\nAustralia\n\nDecember 14 | Melbourne JAM: Meeting at AWS Office\n\nLinks\n\nStart a JAM in your city if there isn’t one already.\n\nBecome a JAM member\n\nBecome an online JAM member\n\nSpeak or sponsor at a JAM. Contact us at jenkinsci-jam@googlegroups.com\n\nBecome a Jenkins project contributor","title":"Upcoming December Jenkins Events","tags":["events","jam"],"authors":[{"avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#281818","images":{"fallback":{"src":"/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/a55dc/alyssat.jpg","srcSet":"/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/8d248/alyssat.jpg 32w,\n/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/c004c/alyssat.jpg 64w,\n/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/a55dc/alyssat.jpg 128w,\n/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/9e67b/alyssat.jpg 256w","sizes":"(min-width: 128px) 128px, 100vw"},"sources":[{"srcSet":"/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/22924/alyssat.webp 32w,\n/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/89767/alyssat.webp 64w,\n/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/40d97/alyssat.webp 128w,\n/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/5028e/alyssat.webp 256w","type":"image/webp","sizes":"(min-width: 128px) 128px, 100vw"}]},"width":128,"height":166}}},"blog":null,"github":"alyssat","html":"<div class=\"paragraph\">\n<p>Member of the <a href=\"/sigs/advocacy-and-outreach/\">Jenkins Advocacy and Outreach SIG</a>.\nAlyssa drives and manages Jenkins participation in community events and conferences like <a href=\"https://fosdem.org/\">FOSDEM</a>, <a href=\"https://www.socallinuxexpo.org/\">SCaLE</a>, <a href=\"https://events.linuxfoundation.org/cdcon/\">cdCON</a>, and <a href=\"https://events19.linuxfoundation.org/events/kubecon-cloudnativecon-north-america-2019/\">KubeCon</a>.\nShe is also responsible for Marketing &amp; Community Programs at <a href=\"https://cloudbees.com\">CloudBees, Inc.</a></p>\n</div>","id":"alyssat","irc":null,"linkedin":null,"name":"Alyssa Tong","slug":"/blog/authors/alyssat","twitter":null}]}},{"node":{"date":"2016-11-22T00:00:00.000Z","id":"bf7f59a9-58e8-5509-a6f1-6515f7050a5b","slug":"/blog/2016/11/22/what-jvm-versions-are-running-jenkins-the-return/","strippedHtml":"Like for last year’s article about the same subject, yet another recent discussion about finally requiring Java 8 to run future versions Jenkins pushed me to gather some more factual data around it.\n\nWhat follows contains some opinions or statements which may not be seen as purely factual or neutral. Note that this represents by no mean the general position of the Jenkins governance board. This is solely my opinion as a contributor based on the data I gathered, and what I feel from the feedback of the community at large.\n\nJava 8 now the most used version, and growing\n\nIf we look at the global numbers, Java 8 runtimes now represent 52.8% of the Jenkins instances running, which have not opted out of anonymous usage statistics.\n\nAnd if you look at the trend, Java 8 is clearly growing fast.\n\nZooming into the Jenkins 2.x instances subset\n\nNow, if you look at that picture, though already interesting and showing a clear trend towards Java 8 runtime adoption, some might argue it’s being too nice to older JREs.\nThe reasoning could be: instances running (very) old Jenkins versions may not be the ones you want to look at when trying to plan the future of an opensource project:\nthose are indeed probably not going to upgrade in general anyway, or when they do, upgrading the JRE would be a small thing compared to the rest to be tested with such a gap.\n\nSo, if we only keep the instances running Jenkins 2.x, then the proportion of Java 8 goes to almost 70% compared to Java 7 (Jenkins 2.x requires Java 7)\n[ 1 ] :\n\nConclusion\n\nJava 8 adoption numbers are getting bigger, while every other JREs are going down.\n\nIf you are still using a JRE 7 to run Jenkins, it is seriously time to think\nabout upgrading to 8.  Knowing that it’s definitely not a bleeding-edge path\nmight help you go that way, especially if you generally do not like upgrades.\nAlso, as a reminder, the most used JDK,\nOracle JDK 7 now got end-of-lifed more than 18 months ago.\n\nContrary to the past attempts the previous years, the discussion on the Jenkins\ndevelopment mailing list did not trigger strong rebutals by many people.\n\nPerhaps it’s finally time for Mr. Jenkins to upgrade to Java 8!\n\nAll numbers shown below are derived from the new jvms.json file now generated automatically every month, after the two related pull-requests 1 and 2 got merged.\n[ 2 ]\n\n1. 69% for October, 67% in September\n\n2. You are more than welcome to review those Pull-Requests and shout if you see something wrong in the calculations.","title":"What JVM versions are running Jenkins? 2016 Update!","tags":["statistics"],"authors":[{"avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8e8d8","images":{"fallback":{"src":"/gatsby-jenkins-io/static/05e25bcf6699abfce74f0630971e7c78/f1e03/batmat.jpg","srcSet":"/gatsby-jenkins-io/static/05e25bcf6699abfce74f0630971e7c78/ede19/batmat.jpg 32w,\n/gatsby-jenkins-io/static/05e25bcf6699abfce74f0630971e7c78/bc20c/batmat.jpg 64w,\n/gatsby-jenkins-io/static/05e25bcf6699abfce74f0630971e7c78/f1e03/batmat.jpg 128w,\n/gatsby-jenkins-io/static/05e25bcf6699abfce74f0630971e7c78/b691b/batmat.jpg 256w","sizes":"(min-width: 128px) 128px, 100vw"},"sources":[{"srcSet":"/gatsby-jenkins-io/static/05e25bcf6699abfce74f0630971e7c78/8ba60/batmat.webp 32w,\n/gatsby-jenkins-io/static/05e25bcf6699abfce74f0630971e7c78/a9ea7/batmat.webp 64w,\n/gatsby-jenkins-io/static/05e25bcf6699abfce74f0630971e7c78/51559/batmat.webp 128w,\n/gatsby-jenkins-io/static/05e25bcf6699abfce74f0630971e7c78/28f98/batmat.webp 256w","type":"image/webp","sizes":"(min-width: 128px) 128px, 100vw"}]},"width":128,"height":130}}},"blog":"http://batmat.net","github":"batmat","html":"<div class=\"paragraph\">\n<p>Baptiste has been using and contributing to Jenkins since it was called differently, and is a huge proponent of the Agile, Devops &amp; Continuous Delivery movements.\nHe loves to discuss not only the technical aspects, but also the even more essential cultural aspects of this all, working together to improve the value provided to customers in a great inclusive and blameless environment.</p>\n</div>","id":"batmat","irc":null,"linkedin":null,"name":"Baptiste Mathus","slug":"/blog/authors/batmat","twitter":"bmathus"}]}},{"node":{"date":"2016-11-21T00:00:00.000Z","id":"bf6fcc51-7017-5159-91de-3d955a72998d","slug":"/blog/2016/11/21/gc-tuning/","strippedHtml":"This is a\ncross\npost by Sam Van Oort, Software Engineer at\nCloudBees and contributor to the Jenkins project.\n\nToday I’m going to show you how easy it is to tune Jenkins Java settings to\nmake your controllers more responsive and stable, especially with large heap sizes.\n\nThe Magic Settings:\n\nBasics: -server -XX:+AlwaysPreTouch\n\nGC Logging: -Xloggc:$JENKINS_HOME/gc-%t.log -XX:NumberOfGCLogFiles=5 -XX:+UseGCLogFileRotation -XX:GCLogFileSize=20m -XX:+PrintGC -XX:+PrintGCDateStamps -XX:+PrintGCDetails -XX:+PrintHeapAtGC -XX:+PrintGCCause -XX:+PrintTenuringDistribution -XX:+PrintReferenceGC -XX:+PrintAdaptiveSizePolicy\n\nG1 GC settings: -XX:+UseG1GC -XX:+ExplicitGCInvokesConcurrent -XX:+ParallelRefProcEnabled -XX:+UseStringDeduplication -XX:+UnlockExperimentalVMOptions -XX:G1NewSizePercent=20 -XX:+UnlockDiagnosticVMOptions -XX:G1SummarizeRSetStatsPeriod=1\n\nHeap settings: set your minimum heap size ( -Xms) to at least 1/2 of your maximum size ( -Xmx).\n\nNow, let’s look at where those came from!  We’re going to focus on garbage\ncollection (GC) here and dig fast and deep to strike for gold; if you’re not\nfamiliar with GC fundamentals\ntake a look at this source.\n\nBecause performance tuning is data driven, I’m going to use real-world data\nselected three very large Jenkins instances that I help support.\n\nWhat we’re not going to do: Jenkins basics, or play with max heap.  See the\nsection \"what should I do before tuning.\"  This is for cases where we really\ndo need a big heap and can’t easily split our Jenkins controllers into smaller\nones.\n\nThe Problem: Hangups\n\nSymptom: Users report that the Jenkins instance periodically hangs, taking\nseveral seconds to handle normally fast requests.  We may even see lockups or\ntimeouts from systems communicating with the Jenkins controller (build agents,\netc).  In long periods of heavy load, users may report Jenkins running slowly.\nApplication monitoring shows that during lockups all or most of the CPU cores\nare fully loaded, but there’s not enough activity to justify it.  Process and\nJStack dumps will reveal that the most active Java threads are doing garbage\ncollection.\n\nWith Instance A, they had this problem.  Their Jenkins Java arguments are very\nclose to the default, aside from sizing the heap:\n\n24 GB max heap, 4 GB initial, default GC settings (ParallelGC)\n\nA few flags set (some coming in as defaults): -XX:-BytecodeVerificationLocal -XX:-BytecodeVerificationRemote -XX:+ReduceSignalUsage -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:-UseLargePagesIndividualAllocation\n\nAfter enabling garbage collection (GC) logging we see the following rough stats:\n\n.\n\nDiving deeper, we get this chart of GC pause durations:\n\nKey stats:\n\nThroughput: 99.64%  (percent of time spent executing application code, not doing garbage collection)\n\nAverage GC time: 348 ms (ugh!)\n\nGC cycles over 2 seconds: 36 (2.7%)\n\nMinor/Full GC average time: 263 ms / 2.803 sec\n\nObject creation & promotion rate: 42.4 MB/s & 1.99 MB/s\n\nExplanations:\n\nAs you can see, young GC cycles very quickly clear away freshly-created\ngarbage, but the deeper old-gen GC cycles run very slowly: 2-4 seconds. This is\nwhere our problems happen.  The default Java garbage collection algorithm\n(ParallelGC) pauses everything when it has to collect garbage (often called a\n\"stop the world pause\"). During that period, Jenkins is fully halted: normally\n(with small heaps) these pauses are too brief to be an issue.  With heaps of 4\nGB or larger, the time required becomes long enough to be a problem: several\nseconds over short windows, and over a longer interval you occasionally see\nmuch longer pauses (tens of seconds, or minutes.)\n\nThis is where the user-visible hangs and lock-ups happen.  It also adds\nsignificant latency to those build/deploy tasks.  In periods of heavy load, the\nsystem was even experiencing hangs of 30+ seconds for a single full GC cycle.\nThis was long enough to trigger network timeouts (or internal Jenkins thread\ntimeouts) and cause even larger problems.\n\nFortunately there’s a solution: the concurrent low-pause garbage collection\nalgorithms, Concurrent Mark Sweep (CMS) and Garbage First (G1). These attempt\nto do much of the garbage collection concurrently with application threads,\nresulting in much shorter pauses (at a slight cost in extra CPU use).  We’re\ngoing to focus on G1, because it is slated to become the default in Java 9 and\nis the official recommendation for large heap sizes.\n\nLet’s see what happens when someone uses G1 on a similarly-sized Jenkins\ncontroller with Instance B (17 GB heap):\n\nTheir settings:\n\n16 GB max heap, 0.5 GB initial size\n\nJava flags (mostly defaults, except for G1): -XX:+UseG1GC -XX:+UseCompressedClassPointers -XX:+UseCompressedOops\n\nAnd the GC log analysis:\n\nKey stats:\n\nThroughput: 98.76%  (not great, but still only slowing things down a bit)\n\nAverage GC time: 128 ms\n\nGC cycles over 2 seconds: 11, 0.27%\n\nMinor/Full GC average time: 122 ms / 1 sec 232 ms\n\nObject creation & promotion rate: 132.53 MB/s & 522 KB/s\n\nOkay, much better : some improvement may be expected from a 30% smaller\nheap, but not as much as we’ve seen.  Most of the GC pauses are well\nunder 2 seconds, but we have 11 outliers - long Full GC pauses of 2-12 seconds.\nThose are troubling; we’ll take a deeper dive into their causes in a second.\nFirst, let’s look at the big picture and at how Jenkins behaves with G1 GC for\na second instance.\n\nG1 Garbage Collection with Instance C (24 GB heap):\n\nTheir settings:\n\n24 GB max heap, 24 GB initial heap, 2 GB max metaspace\n\nSome custom flags: `-XX:+UseG1GC -XX:+AlwaysPreTouch -XX:+UseStringDeduplication  -XX:+UseCompressedClassPointers -XX:+UseCompressedOops `\n\nClearly they’ve done some garbage collection tuning and optimization.  The\nAlwaysPreTouch pre-zeros allocated heap pages, rather than waiting until\nthey’re first used. This is suggested especially for large heap sizes, because\nit trades slightly slower startup times for improved runtime performance.  Note\nalso that they pre-allocated the whole heap.  This is a common optimization.\n\nThey also enabled StringDeduplication, a G1 option introduced in Java 8 Update\n20 that transparently replaces identical character arrays with pointers to the\noriginal, reducing memory use (and improving cache performance).  Think of it\nlike String.intern() but it silently happens during garbage collection.  This\nis a concurrent operation added on to normal GC cycles, so it doesn’t pause the\napplication.  We’ll look at its impacts later.\n\nLooking at the basics:\n\nSimilar picture to Instance B, but it’s hidden by the sheer number of points\n(this is a longer period here, 1 month).  Those same occasional Full GC\noutliers are present!\n\nKey stats:\n\nThroughput: 99.93%\n\nAverage GC time: 127 ms\n\nGC cycles over 2 seconds: 235 (1.56%)\n\nMinor/Full GC average time: 56 ms / 3.97 sec\n\nObject creation & promotion rate: 34.06 MB/s & 286 kb/s\n\nOverall fairly similar to Instance B: ~100 ms GC cycles, all the minor GC\ncycles are very fast.  Object promotion rates sound similar.\n\nRemember those random long pauses?\n\nLet’s find out what caused them and how to get rid of them.  Instance B had 11\nsuper-long pause outliers.  Let’s get some more detail, by opening GC Logs in\nGCViewer.\nThis tool gives a tremendous amount of information.  Too much, in fact —  I\nprefer to use\nGCEasy.io\nexcept where needed.  Since GC logs do not contain compromising information\n(unlike heap dumps or some stack traces), web apps are a great tool for\nanalysis.\n\nWhat we care about are at the Full GC times in the middle (highlighted).  See\nhow much longer they are vs. the young and concurrent GC cycles up top (2\nseconds or less)?\n\nNow, I lied a bit earlier - sorry!  For concurrent garbage collectors, there\nare actually 3 modes: young GC, concurrent GC, and full GC.  Concurrent GC\nreplaces the Full GC mode in Parallel GC with a faster concurrent operation\nthat runs in parallel with the application.  But in a few cases, we are\nforced to fall back to a non-concurrent Full GC operation, which will use the\nserial  (single-threaded) garbage collector.  That means that even if we have\n30+ CPU cores, only one is working. This is what is happening here, and on a\nlarge-heap, multicore system it is S  L  O  W.  How slow?  280 MB/s vs. 12487\nMB/s for Instance B (for instance C, the difference is also about 50:1).\n\nWhat triggers a full GC instead of concurrent:\n\nExplicit calls to System.gc() (most common culprit, often tricky to trace down)\n\nMetadata GC Threshold: Metaspace (used for Class data mostly) has hit the\ndefined size to force garbage collection or increase it.  Documentation is\nterrible for this,\nStack Overflow\nwill be your friend.\n\nConcurrent mode failure: concurrent GC can’t complete fast enough to keep up\nwith objects the application is creating (there are JVM arguments to trigger\nconcurrent GC earlier)\n\nHow do we fix this?\n\nFor explicit GC:\n\n-XX:+DisableExplicitGC will turn off Full GC triggered by System.gc().  Often set in production, but the below option is safer.\n\nWe can trigger a concurrent GC in place of a full one with -XX:+ExplicitGCInvokesConcurrent - this will take the explicit call as a hint to do deeper cleanup, but with less performance cost.\n\nGotcha for people who’ve used CMS: if you have used CMS in the past, you\nmay have used the option -XX:+ExplicitGCInvokesConcurrentAndUnloadsClasses — which does what it says.  This option will silently fail in G1, meaning you\nstill see the very long pauses from Full GC cycles as if it wasn’t set (no\nwarning is generated).  I have logged a JVM bug for this issue.\n\nFor the Metadata GC threshold:\n\nIncrease your initial metaspace to the final amount to avoid resizing. For example: -XX:MetaspaceSize=500M\n\nInstance C also suffered the same problem with explicit GC calls, with almost\nall our outliers accounted for (230 out of 235) by slow, nonconcurrent Full GC\ncycles (all from explicit System.gc() calls, since they tuned metaspace):\n\nHere’s what GC pause durations look like if we remove the log entries for the\nexplicit System.gc() calls, assuming that they’ll blend in with the other\nconcurrent GC pauses (not 100% accurate, but a good approximation):\n\nInstance B:\n\nThe few long Full GC cycles at the start are from metaspace expansion — they\ncan be removed by increasing initial Metaspace size, as noted above. The\nspikes?  That’s when we’re about to resize the Java heap, and memory pressure\nis high. You can avoid this by setting the minimum/initial heap to at least\nhalf of the maximum, to limit resizing.\n\nStats:\n\nThroughput: 98.93%\n\nAverage GC time: 111 ms\n\nGC cycles over 2 seconds: 3\n\nMinor & Full or concurrent GC average time: 122 ms / 25 ms (yes, faster than minor!)\n\nObject creation & promotion rate: 132.07 MB/s & 522 kB/s\n\nInstance C:\n\nStats:\n\nThroughput: 99.97%\n\nAverage GC time: 56 ms\n\nGC cycles over 2 seconds: 0 (!!!)\n\nMinor & Full or concurrent GC average time: 56 ms & 10 ms (yes, faster than minor!)\n\nObject creation & promotion rate: 33.31 MB/s & 286 kB/s\n\nSide point: GCViewer is claiming GC performance of 128 GB/s (not unreasonable, we clear ~10 GB of young generation in under 100 ms usually)\n\nOkay, so we’ve tamed the long worst-case pauses!\n\nBut What About Those Long Minor GC Pauses We Saw?\n\nOkay, now we’re in the home stretch!  We’ve tamed the old-generation GC pauses\nwith concurrent collection, but what about those longer young-generation\npauses?  Lets look at stats for the different phases and causes again in\nGCViewer.\n\nHighlighted in yellow we see the culprit: the remark phase of G1 garbage\ncollection. This stop-the-world phase ensures we’ve identified all live\nobjects, and process references (\nmore info).\n\nLet’s look at a sample execution to get more info:\n\n2016-09-07T15:28:33.104+0000: 26230.652: [GC remark 26230.652: [GC ref-proc, 1.7204585 secs], 1.7440552 secs]\n\n [Times: user=1.78 sys=0.03, real=1.75 secs]\n\nThis turns out to be typical for the GC log: the longest pauses are spent in\nreference processing. This is not surprising because Jenkins internally uses\nreferences heavily for caching, especially weak references, and the default\nreference processing algorithm is single-threaded.  Note that user (CPU) time\nmatches real time, and it would be higher if we were using multiple cores.\n\nSo, we add the GC flag -XX:+ParallelRefProcEnabled which enables us to use the multiple cores more effectively.\n\nTuning young-generation GC further based on Instance C:\n\nBack to GCViewer we go, to see what’s time consuming with the GC for Instance C.\n\nThat’s good, because most of the time is just sweeping out the trash\n(evacuation pause).  But the 1.8 second pause looks odd.  Let’s look at the raw\nGC log for the longest pause:\n\n2016-09-24T16:31:27.738-0700: 106414.347: [GC pause (G1 Evacuation Pause) (young), 1.8203527 secs]\n[Parallel Time: 1796.4 ms, GC Workers: 8]\n [GC Worker Start (ms): Min: 106414348.2, Avg: 106414348.3, Max: 106414348.6, Diff: 0.4]\n[Ext Root Scanning (ms): Min: 0.3, Avg: 1.7, Max: 5.7, Diff: 5.4, Sum: 14.0]\n  [Update RS (ms): Min: 0.0, Avg: 7.0, Max: 19.6, Diff: 19.6, Sum: 55.9]\n    [Processed Buffers: Min: 0, Avg: 45.1, Max: 146, Diff: 146, Sum: 361]\n [Scan RS (ms): Min: 0.2, Avg: 0.4, Max: 0.7, Diff: 0.6, Sum: 3.5]\n [Code Root Scanning (ms): Min: 0.0, Avg: 0.0, Max: 0.1, Diff: 0.1, Sum: 0.2]\n [Object Copy (ms): Min: 1767.1, Avg: 1784.4, Max: 1792.6, Diff: 25.5, Sum: 14275.2]\n [Termination (ms): Min: 0.3, Avg: 2.4, Max: 3.5, Diff: 3.2, Sum: 19.3]\n    [Termination Attempts: Min: 11, Avg: 142.5, Max: 294, Diff: 283, Sum: 1140]\n [GC Worker Other (ms): Min: 0.0, Avg: 0.1, Max: 0.4, Diff: 0.3, Sum: 0.8]\n [GC Worker Total (ms): Min: 1795.9, Avg: 1796.1, Max: 1796.2, Diff: 0.3, Sum: 14368.9]\n [GC Worker End (ms): Min: 106416144.4, Avg: 106416144.5, Max: 106416144.5, Diff: 0.1]\n\n…​oh, well dang. Almost the entire time (1.792 s out of 1.820) is walking\nthrough the live objects and copying them.  And wait, what about this line,\nshowing the summary statistics:\n\nEden: 13.0G(13.0G)->0.0B(288.0M) Survivors: 1000.0M->936.0M Heap: 20.6G(24.0G)->7965.2M(24.0G)]\n\nGood grief, we flushed out 13 GB (!!!) of freshly-allocated garbage in one\nswoop and compacted the leftovers!  No wonder it was so slow.  I wonder how we\naccumulated so much…​\n\nOh, right…​ we set up for 24 GB of heap initially, and each minor GC clears\nmost of the young generation.  Okay, so we’ve set aside tons of space for trash\nto collect, which means longer but less frequent GC periods.  This also gets\nthe best performance from Jenkins memory caches which are using WeakReferences\n(survives until collected by GC) and SoftReferences (more long-lived). Those\ncaches boost performance a lot.\n\nWe could take actions to prevent those rare longer pauses. The best ways are to\nlimit total heap size or reduce the value of -XX:MaxGCPauseMillis=200 from\nits default (200).  A more advanced way (if those don’t help enough) is to\nexplicitly set the maximum size of the young generation smaller (say\n-XX:G1MaxNewSizePercent=45 instead of the default of 60).  We could also\nthrow more CPUs at the problem.\n\nBut if we look up, most pauses are around 100 ms (200 ms is the default value\nfor MaxGCPauseMillis).  For Jenkins on this hardware, this appears to work\njust fine and a rare longer pause is OK as long as they don’t get too\nbig.  Also remember, if this happens often, G1 GC will try to autotune for\nlower pauses and more predictable performance.\n\nA Few Final Settings\n\nWe mentioned StringDeduplication was on with Instance C, what is the impact?\nThis only triggers on Strings that have survived a few generations (most of our\ngarbage does not), has limits on the CPU time it can use, and replaces\nduplicate references to their immutable backing character arrays.\nFor more info, look here.\nSo, we should be trading a little CPU time for improved memory efficiently\n(similarly to string interning).\n\nAt the beginning, this has a huge impact:\n\n[GC concurrent-string-deduplication, 375.3K->222.5K(152.8K), avg 63.0%, 0.0     024966 secs]\n[GC concurrent-string-deduplication, 4178.8K->965.5K(3213.2K), avg 65.3%, 0     .0272168 secs]\n[GC concurrent-string-deduplication, 36.1M->9702.6K(26.6M), avg 70.3%, 0.09     65196 secs]\n[GC concurrent-string-deduplication, 4895.2K->394.9K(4500.3K), avg 71.9%, 0     .0114704 secs]\n\nThis peaks at an average of about ~90%:\n\nAfter running for a month, less of an impact - many of the strings that can be\ndeduplicated already are:\n\n[GC concurrent-string-deduplication, 138.7K->39.3K(99.4K), avg 68.2%, 0.0007080 secs]\n[GC concurrent-string-deduplication, 27.3M->21.5M(5945.1K), avg 68.1%, 0.0554714 secs]\n[GC concurrent-string-deduplication, 304.0K->48.5K(255.5K), avg 68.1%, 0.0021169 secs]\n[GC concurrent-string-deduplication, 748.9K->407.3K(341.7K), avg 68.1%, 0.0026401 secs]\n[GC concurrent-string-deduplication, 3756.7K->663.1K(3093.6K), avg 68.1%, 0.0270676 secs]\n[GC concurrent-string-deduplication, 974.3K->17.0K(957.3K), avg 68.1%, 0.0121952 secs]\n\nHowever it’s cheap to use: in average, each dedup cycle takes 8.8 ms and\nremoves 2.4 kB of duplicates.  The median takes 1.33 ms and removes 17.66 kB\nfrom the old generation.  A small change per cycle, but in aggregate it adds up\nquickly — in periods of heavy load, this can save hundreds of megabytes of\ndata. But that’s still small, relative to multi-GB heaps.\n\nConclusion: turn string deduplication on string deduplication is fairly\ncheap to use, and reduces the steady-state memory needed for Jenkins.  That\nfrees up more room for the young generation, and should overall reduce GC time\nby removing duplicate objects.  I think it’s worth turning on.\n\nSoft reference flushing: Jenkins uses soft references for caching build\nrecords and in pipeline FlowNodes.  The only guarantee for these is that they\nwill be removed instead of causing an OutOfMemoryError…​ however Java\napplications can slow to a crawl from memory pressure long before that happens.\nThere’s an option that provides a hint to the JVM based on time & free memory,\ncontrolled by -XX:SoftRefLRUPolicyMSPerMB (default 1000).  The SoftReferences\nbecome eligible for garbage collection after this many milliseconds have\nelapsed since last touch…​ per MB of unused heap (vs the maximum).  The\nreferenced objects don’t count towards that target.  So, with 10 GB of heap\nfree and the default 1000 ms setting, soft references stick around for ~2.8\nhours (!).\n\nIf the system is continuously allocating more soft references, it may trigger\nheavy GC activity, rather than clearing out soft references. See the open bug\nJDK-6912889\nfor more details.\n\nIf Jenkins consumes excessive old generation memory, it may help to make soft\nreferences easier to flush  by reducing -XX:SoftRefLRUPolicyMSPerMB from its\ndefault (1000) to something smaller (say 10-200).  The catch is that\nSoftReferences are often used for objects that are relatively expensive to\nload, such lazy-loaded build records and pipeline FlowNode data.\n\nCaveats\n\nG1 vs. CMS:\n\nG1 was available on later releases of JRE 7, but unstable and slow. If you\nuse it you absolutely must be using JRE 8, and the later the release the better\n(it’s gotten a lot of patches).  Googling around will show horrible G1 vs CMS\nbenchmarks from around 2014: these are probably best ignored, since the G1\nimplementation was still immature then. There’s probably a niche for CMS use\nstill, especially on midsized heaps (1-3 GB) or where settings are already\ntuned.  With appropriate tuning it can still perform generally well for\nJenkins (which mostly generates short-lived garbage), but CMS eventually suffer\nfrom heap fragmentation and need a slow, non-concurrent Full GC to clear this.\nIt also needs considerably more tuning than G1.\n\nGeneral GC tuning caveats :\n\nNo single setting is perfect for everybody.  We avoid tweaking settings that we\ndon’t have strong evidence for here, but there are of course many additional\nsettings to tweak.  One shouldn’t change them without evidence though, because\nit can cause unexpected side effects.  The GC logs we enabled earlier will\ncollect this evidence.  The only setting that jumps out as a likely candidate\nfor further tuning is G1 region size (too small and there are many humungous\nobject allocations, which hurt performance).  Running on smaller systems,\nI’ve seen evidence that regions shouldn’t be smaller than 4 MB because\nthere are 1-2 MB objects allocated somewhat regularly — but it’s not\nenough to make solid guidance without more data.\n\nWhat Should I Do Before Tuning Jenkins GC:\n\nIf you’ve seen\nStephen Connolly’s excellent Jenkins World talk,\nyou know that most Jenkins instances can and should get by with 4 GB or less of\nallocated heap, even up to very large sizes.  You will want to turn on GC\nlogging (suggested above) and look at stats over a few weeks (remember\nGCeasy.io).\nIf you’re not seeing periodic longer pause times, you’re probably okay.\n\nFor this post we assume we’ve already done the basic performance work for Jenkins:\n\nJenkins is running on fast, SSD-backed storage.\n\nWe’ve set up build rotation for your Jobs, to delete old builds so they don’t pile up.\n\nThe weather column is already disabled for folders.\n\nAll builds/deploys are running on build agents not on the controller. If the controller has executors allocated, they are exclusively used for backup tasks.\n\nWe’ve verified that Jenkins really does need the large heap size and can’t easily be split into separate controllers.\n\nIf not, we need to do that FIRST before looking at GC tuning, because those will have larger impacts.\n\nConclusions\n\nWe’ve gone from:\n\nAverage 350 ms pauses (bad user experience) including less frequent 2+ second generation pauses\n\nTo an average pause of ~50 ms, with almost all under 250 ms\n\nReduced total memory footprint from String deduplication\n\nHow:\n\nUse Garbage First (G1) garbage collection, which performs generally very well for Jenkins.  Usually there’s enough spare CPU time to enable concurrent running.\n\nEnsure explicit System.gc() and metaspace resizing do not trigger a Full GC because this can trigger a very long pause\n\nTurn on parallel reference processing for Jenkins to use all CPU cores fully.\n\nUse String deduplication, which generates a tidy win for Jenkins\n\nEnable GC logging, which can then be used for the next level of tuning and diagnostics, if needed.\n\nThere’s still a little unpredictability, but using appropriate settings gives a\nmuch more stable, responsive CI/CD server…​ even up to 20 GB heap sizes!\n\nFurther Reading:\n\nG1GC fundamentals\n\nMechanicalSympathy: Garbage Collection Distilled\n\nOracle Garbage First Garbage Collector Tuning\n\nOne additional thing\n\nI’ve added -XX:+UnlockExperimentalVMOptions -XX:G1NewSizePercent=20 to our\noptions above.  This is covering a complex and usually infrequent case where G1\nself-tuning can trigger bad performance for Jenkins — but that’s material for\nanother post…​","title":"Tuning Jenkins GC For Responsiveness and Stability with Large Instances","tags":["performance","scalability","administration"],"authors":[{"avatar":null,"blog":null,"github":"svanoort","html":"","id":"svanoort","irc":null,"linkedin":null,"name":"Sam Van Oort","slug":"/blog/authors/svanoort","twitter":null}]}},{"node":{"date":"2016-11-16T00:00:00.000Z","id":"98cc175a-5e42-541a-a6b0-25f3c783cc80","slug":"/blog/2016/11/16/security-updates-addressing-zero-day/","strippedHtml":"A zero-day vulnerability in Jenkins was published on Friday, November 11.  Last\nweek\nwe provided an immediate mitigation\nand today we are releasing updates to Jenkins which fix the vulnerability. We\nstrongly recommend you update Jenkins to 2.32 (main line) or 2.19.3 (LTS) as\nsoon as possible.\n\nToday’s\nsecurity advisory\ncontains more information on the exploit, affected versions, and fixed\nversions, but in short:\n\nAn unauthenticated remote code execution vulnerability allowed attackers to\ntransfer a serialized Java object to the Jenkins CLI, making Jenkins connect to\nan attacker-controlled LDAP server, which in turn can send a serialized payload\nleading to code execution, bypassing existing protection mechanisms.\n\nMoving forward, the Jenkins security team is revisiting the design of the\nJenkins CLI over the coming weeks to prevent this class of vulnerability in the\nfuture. If you are interested in participating in that discussion, please join\nin on the\njenkinsci-dev@\nmailing list.\n\nThe Jenkins project encourages administrators to subscribe to the\njenkinsci-advisories@\nmailing list to receive future Jenkins security notifications.","title":"Security updates addressing zero day vulnerability","tags":["core","security"],"authors":[{"avatar":null,"blog":null,"github":"daniel-beck","html":"<div class=\"paragraph\">\n<p>Daniel is a Jenkins core maintainer and, as security officer, leads the <a href=\"/security/#team\">Jenkins security team</a>.\nHe sometimes contributes to developer documentation and project infrastructure.</p>\n</div>","id":"daniel-beck","irc":null,"linkedin":null,"name":"Daniel Beck","slug":"/blog/authors/daniel-beck","twitter":null}]}},{"node":{"date":"2016-11-13T00:00:00.000Z","id":"b71d7a97-ee04-57a0-8fc9-5e55b98bc3bf","slug":"/blog/2016/11/13/november-jenkins-events/","strippedHtml":"November is packed full of meetups and events. If you are in any of the areas\nbelow please stop by to say \"Hi\" and talk Jenkins over beer.\n\nNorth America\n\nNovember 15 | SF JAM: Let’s Talk CI/CD and DevOps with ClusterHQ and Jenkins\n\nNovember 15 | DC JAM: Jenkins and Fannie Mae\n\nNovember 30 | Albuquerque JAM: Learn About Blue Ocean\n\nNovember 30 | Guadalajara JAM: Jenkins Install and Setup\n\nEurope\n\nNovember 10 | Amsterdam JAM: Jenkins and Docker - Multiple Uses for Containers and Jenkins\n\nNovember 10 | Milano JAM: Meet and Greet\n\nAustralia\n\nNovember 15 | Melbourne JAM: Blue Ocean - A New User Experience\n\nAsia\n\nNovember 17 | Singapore JAM: CI Using Source Code on GitHub\n\nLinks\n\nStart a JAM in your city if there isn’t one already.\n\nBecome a JAM member\n\nBecome an online JAM member\n\nSpeak or sponsor at a JAM. Contact us at jenkinsci-jam@googlegroups.com\n\nBecome a Jenkins project contributor","title":"Upcoming November Jenkins Events","tags":["events","jam"],"authors":[{"avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#281818","images":{"fallback":{"src":"/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/a55dc/alyssat.jpg","srcSet":"/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/8d248/alyssat.jpg 32w,\n/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/c004c/alyssat.jpg 64w,\n/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/a55dc/alyssat.jpg 128w,\n/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/9e67b/alyssat.jpg 256w","sizes":"(min-width: 128px) 128px, 100vw"},"sources":[{"srcSet":"/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/22924/alyssat.webp 32w,\n/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/89767/alyssat.webp 64w,\n/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/40d97/alyssat.webp 128w,\n/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/5028e/alyssat.webp 256w","type":"image/webp","sizes":"(min-width: 128px) 128px, 100vw"}]},"width":128,"height":166}}},"blog":null,"github":"alyssat","html":"<div class=\"paragraph\">\n<p>Member of the <a href=\"/sigs/advocacy-and-outreach/\">Jenkins Advocacy and Outreach SIG</a>.\nAlyssa drives and manages Jenkins participation in community events and conferences like <a href=\"https://fosdem.org/\">FOSDEM</a>, <a href=\"https://www.socallinuxexpo.org/\">SCaLE</a>, <a href=\"https://events.linuxfoundation.org/cdcon/\">cdCON</a>, and <a href=\"https://events19.linuxfoundation.org/events/kubecon-cloudnativecon-north-america-2019/\">KubeCon</a>.\nShe is also responsible for Marketing &amp; Community Programs at <a href=\"https://cloudbees.com\">CloudBees, Inc.</a></p>\n</div>","id":"alyssat","irc":null,"linkedin":null,"name":"Alyssa Tong","slug":"/blog/authors/alyssat","twitter":null}]}},{"node":{"date":"2016-11-12T00:00:00.000Z","id":"8957e4ed-d485-505d-a0dd-5f3eaa1932fe","slug":"/blog/2016/11/12/addressing-remote-vulnerabilities-in-cli/","strippedHtml":"The Jenkins\nsecurity team\nhas been made aware of a new attack vector for a remote code execution\nvulnerability in the\nJenkins CLI,\naccording to\nthis\nadvisory\nby Daniel Beck:\n\nWe have received a report of a possible unauthenticated remote code execution\nvulnerability in Jenkins (all versions).\n\nWe strongly advise anyone running a Jenkins instance on a public network\ndisable the CLI for now.\n\nAs this uses the same attack vector as SECURITY-218, you can reuse the script\nand instructions published in this repository: https://github.com/jenkinsci-cert/SECURITY-218\n\nWe have since been able to confirm the vulnerability and strongly recommend\nthat everyone follow the instructions in the linked repository.\n\nAs Daniel mentions in the security advisory, the advised mitigation strategy is\nto disable the CLI subsystem via\nthis\nGroovy script.\nIf you are a Jenkins administrator, navigate to the 'Manage Jenkins' page and\nclick on the 'Script Console', which will allow you to run the Groovy script to\nimmediately disable the CLI.\n\nIn order to persist this change across restarts of your Jenkins controller, place\nthe\nGroovy script\nin $JENKINS_HOME/init.groovy.d/cli-shutdown.groovy so that Jenkins executes\nthe script on each boot.\n\nWe are expecting to have a fix implemented, tested and included in an updated\nweekly and LTS release this upcoming Wednesday, November 16th.\n\nFor users who are operating Jenkins on public, or otherwise hostile, networks,\nwe suggest hosting Jenkins behind reverse proxies such as Apache or Nginx.\nThese can help provide an additional layer of security, when used appropriately,\nto cordon off certain URLs such as /cli.\n\nAdditionally, we strongly recommend that all Jenkins administrators subscribe\nto the\njenkinsci-advisories@googlegroups.com\nmailing list to receive future advisories.\n\nThe Jenkins project has a responsible disclosure policy, which we strongly\nencourage anybody who believes they have discovered a potential vulnerability\nto follow. You can learn more about this policy and our processes on our\nsecurity page.","title":"Addressing recently disclosed vulnerabilities in the Jenkins CLI","tags":["security","lts"],"authors":[{"avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/gatsby-jenkins-io/static/c98b6de76465e89f9f5e5b331e9abfea/19e71/rtyler.jpg","srcSet":"/gatsby-jenkins-io/static/c98b6de76465e89f9f5e5b331e9abfea/77b35/rtyler.jpg 32w,\n/gatsby-jenkins-io/static/c98b6de76465e89f9f5e5b331e9abfea/d4a57/rtyler.jpg 64w,\n/gatsby-jenkins-io/static/c98b6de76465e89f9f5e5b331e9abfea/19e71/rtyler.jpg 128w,\n/gatsby-jenkins-io/static/c98b6de76465e89f9f5e5b331e9abfea/68974/rtyler.jpg 256w","sizes":"(min-width: 128px) 128px, 100vw"},"sources":[{"srcSet":"/gatsby-jenkins-io/static/c98b6de76465e89f9f5e5b331e9abfea/ef6ff/rtyler.webp 32w,\n/gatsby-jenkins-io/static/c98b6de76465e89f9f5e5b331e9abfea/8257c/rtyler.webp 64w,\n/gatsby-jenkins-io/static/c98b6de76465e89f9f5e5b331e9abfea/6766a/rtyler.webp 128w,\n/gatsby-jenkins-io/static/c98b6de76465e89f9f5e5b331e9abfea/22bfc/rtyler.webp 256w","type":"image/webp","sizes":"(min-width: 128px) 128px, 100vw"}]},"width":128,"height":128}}},"blog":"http://unethicalblogger.com","github":"rtyler","html":"<div class=\"paragraph\">\n<p>R&#46; Tyler Croy has been part of the Jenkins project for the past seven years.\nWhile avoiding contributing any Java code, Tyler is involved in many of the\nother aspects of the project which keep it running, such as this website,\ninfrastructure, governance, etc.</p>\n</div>","id":"rtyler","irc":null,"linkedin":null,"name":"R. Tyler Croy","slug":"/blog/authors/rtyler","twitter":"agentdero"}]}},{"node":{"date":"2016-11-11T00:00:00.000Z","id":"d2259d49-39ab-5a56-8c40-0a3cf8acbdc4","slug":"/blog/2016/11/11/monthly-jam-recap-october/","strippedHtml":"October has proven to be a busy month within the Jenkins Area Meetup groups.\nBelow is a recap of topics discussed at various JAMS in the month of October.\n\nDallas Forth Worth, Texas (DFW) JAM\n\nJames Dumay\ntook time out of his vacation to present Blue Ocean, a project that rethinks\nthe user experience of Jenkins, modeling and presenting the process of software\ndelivery by surfacing information that is important to development teams with\nas few clicks as possible, while still staying true to the extensibility that\nJenkins always has had as a core value.\n\nSee recording HERE.\n\nSan Francisco, CA JAM\n\nAndrey Falko from Salesforce shared how he and his Diagnostics team used\nJenkins to deliver software securely and reliably to production within\nSalesforce.\n\nSee videos HERE and\nHERE.\n\nBoulder, CO JAM\n\nThis was a meetup with CA Technologies and included\nMark Waite, maintainer of the Jenkins git plugin\nand a director at CA Technologies in Fort Collins.\nTyler did a great presentation about Jenkins\nPipeline and Blue Ocean and showed off how the community is using Blue Ocean to\nbuild Jenkins.\n\nBarcelona, Spain JAM\n\nAt this meetup, there were plenty of engaging discussions surrounding the\nJenkins Certification and DevOps 2.1 Toolkit: Continuous Deployment with\nJenkins and Docker Swarm.  Guillem Sola shared his Jenkins certification\nexperience HERE while Viktor\nFarcic presented his thoughts on the aspects of building, testing, deploying,\nand monitoring services inside Docker Swarm clusters and Jenkins\nhttps://www.youtube.com/watch?v=fs1ED_y5mUc.\n\nLima, Peru JAM\n\nOctober’s meetup was a joint effort with collaboration from Perú JUG, and\nDocker Lima. The first talk was an Introduction to\nDocker Ecosystem, second was\nBuilding and Testing Apps with Docker and\nArquillian Cube\nand the last one was\nCI/CD using Docker and Jenkins Pipelines.\n\nWe had a full house at the meetup. Now, everyone in the room has a Mr. Jenkins\nbranded on their laptop :)\n\nSpecial thanks to Mario Inga and\nHéctor Paz for their collaborations during the\nlast meetups.\n\nLinks\n\nStart a JAM in your city if there isn’t one already.\n\nBecome a JAM member.\n\nBecome an online JAM member\n\nBe a JAM speaker or sponsor. Let us know jenkinsci-jam@googlegroups.com\n\nBecome a Jenkins project contributor","title":"Monthly JAM Recap - October 2016","tags":["event","JAM","meetup"],"authors":[{"avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#281818","images":{"fallback":{"src":"/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/a55dc/alyssat.jpg","srcSet":"/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/8d248/alyssat.jpg 32w,\n/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/c004c/alyssat.jpg 64w,\n/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/a55dc/alyssat.jpg 128w,\n/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/9e67b/alyssat.jpg 256w","sizes":"(min-width: 128px) 128px, 100vw"},"sources":[{"srcSet":"/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/22924/alyssat.webp 32w,\n/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/89767/alyssat.webp 64w,\n/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/40d97/alyssat.webp 128w,\n/gatsby-jenkins-io/static/fee8c4b53c42d9c396735bc2b737ff84/5028e/alyssat.webp 256w","type":"image/webp","sizes":"(min-width: 128px) 128px, 100vw"}]},"width":128,"height":166}}},"blog":null,"github":"alyssat","html":"<div class=\"paragraph\">\n<p>Member of the <a href=\"/sigs/advocacy-and-outreach/\">Jenkins Advocacy and Outreach SIG</a>.\nAlyssa drives and manages Jenkins participation in community events and conferences like <a href=\"https://fosdem.org/\">FOSDEM</a>, <a href=\"https://www.socallinuxexpo.org/\">SCaLE</a>, <a href=\"https://events.linuxfoundation.org/cdcon/\">cdCON</a>, and <a href=\"https://events19.linuxfoundation.org/events/kubecon-cloudnativecon-north-america-2019/\">KubeCon</a>.\nShe is also responsible for Marketing &amp; Community Programs at <a href=\"https://cloudbees.com\">CloudBees, Inc.</a></p>\n</div>","id":"alyssat","irc":null,"linkedin":null,"name":"Alyssa Tong","slug":"/blog/authors/alyssat","twitter":null}]}},{"node":{"date":"2016-10-31T00:00:00.000Z","id":"dcf580a2-8de4-526e-8237-399ee53b3b39","slug":"/blog/2016/10/31/xunit-reporting/","strippedHtml":"This is a guest post by Liam Newman,\nTechnical Evangelist at CloudBees.\n\nThe\nJUnit plugin\nis the go-to test result reporter for many Jenkins projects,\nbut the it is not the only one available.  The\nxUnit plugin\nis a viable alternative that supports JUnit and many other test result file formats.\n\nIntroduction\n\nNo matter the project, you need to gather and report test results.\nJUnit is one of the most widely supported formats for recording test results.\nFor a scenarios where your tests are stable and your framework can produce JUnit output,\nthis makes the JUnit plugin ideal for reporting results in Jenkins.\nIt will consume results from a specified file or path, create a report,\nand if it finds test failures it will set the the job state to \"unstable\" or \"failed\".\n\nThere are also plenty of scenarios where the JUnit plugin is not enough.\nIf your project has some failing tests that will take some time to fix,\nor if there are some flaky tests,\nthe JUnit plugin’s simplistic view of test failures may be difficult to work with.\n\nNo problem, the Jenkins plugin model lets us replace the JUnit\nplugin functionality with similar\nfunctionality from another plugin and Jenkins Pipeline lets us do this in safe\nstepwise fashion where we can test and debug each of our changes.\n\nIn this article, I will show you how to replace the JUnit plugin with the\nxUnit plugin in Pipeline code to address a few common test reporting scenarios.\n\nInitial Setup\n\nI’m going to use the \"JS-Nightwatch.js\" sample project from my\nprevious post to demonstrate a couple\ncommon scenarios that the xUnit handles better.\nI already have the latest\nJUnit plugin\nand\nxUnit plugin\ninstalled on my Jenkins server.\n\nI’ll be keeping my changes in\nlink: my fork\nof the \"JS-Nightwatch.js\" sample project on GitHub, under the\n\" blog/xunit\" branch.\n\nHere’s what the Jenkinsfile looked like at the end of that previous post and what\nthe report page looks like after a few runs:\n\nJenkinsfile\n\nnode {\n    stage \"Build\"\n    checkout scm\n\n    // Install dependencies\n    sh 'npm install'\n\n    stage \"Test\"\n    // Add sauce credentials\n    sauce('f0a6b8ad-ce30-4cba-bf9a-95afbc470a8a') {\n        // Start sauce connect\n        sauceconnect(options: '', useGeneratedTunnelIdentifier: false, verboseLogging: false) {\n\n            // List of browser configs we'll be testing against.\n            def platform_configs = [\n                'chrome',\n                'firefox',\n                'ie',\n                'edge'\n            ].join(',')\n\n            // Nightwatch.js supports color ouput, so wrap this step for ansi color\n            wrap([$class: 'AnsiColorBuildWrapper', 'colorMapName': 'XTerm']) {\n                // Run selenium tests using Nightwatch.js\n                // Ignore error codes. The junit publisher will cover setting build status.\n                sh \"./node_modules/.bin/nightwatch -e ${platform_configs} || true\"\n            }\n\n            junit 'reports/**'\n\n            step([$class: 'SauceOnDemandTestPublisher'])\n        }\n    }\n}\n\nSwitching from JUnit to xUnit\n\nI’ll start by replacing JUnit with xUnit in my pipeline.\nI use the Snippet Generator to create the step with the right parameters.\nThe main downside of using the xUnit plugin is that while it is Pipeline compatible,\nit still uses the more verbose step() syntax and has some very rough edges around that, too.\nI’ve filed\nJENKINS-37611\nbut in the meanwhile, we’ll work with what we have.\n\n// Original JUnit step\njunit 'reports/**'\n\n// Equivalent xUnit step - generated (reformatted)\nstep([$class: 'XUnitBuilder', testTimeMargin: '3000', thresholdMode: 1,\n    thresholds: [\n        [$class: 'FailedThreshold', failureNewThreshold: '', failureThreshold: '', unstableNewThreshold: '', unstableThreshold: '1'],\n        [$class: 'SkippedThreshold', failureNewThreshold: '', failureThreshold: '', unstableNewThreshold: '', unstableThreshold: '']],\n    tools: [\n        [$class: 'JUnitType', deleteOutputFiles: false, failIfNotNew: false, pattern: 'reports/**', skipNoTestFiles: false, stopProcessingIfError: true]]\n    ])\n\n// Equivalent xUnit step - cleaned\nstep([$class: 'XUnitBuilder',\n    thresholds: [[$class: 'FailedThreshold', unstableThreshold: '1']],\n    tools: [[$class: 'JUnitType', pattern: 'reports/**']]])\n\nIf I replace the junit step in my Jenkinsfile with that last step above,\nit produces a report and job result identical to the JUnit plugin but using the xUnit plugin.  Easy!\n\nnode {\n    stage \"Build\"\n    // ... snip ...\n\n    stage \"Test\"\n    // Add sauce credentials\n    sauce('f0a6b8ad-ce30-4cba-bf9a-95afbc470a8a') {\n        // Start sauce connect\n        sauceconnect(options: '', useGeneratedTunnelIdentifier: false, verboseLogging: false) {\n\n            // ... snip ...\n\n            // junit 'reports/**'\n            step([$class: 'XUnitBuilder',\n                thresholds: [[$class: 'FailedThreshold', unstableThreshold: '1']],\n                tools: [[$class: 'JUnitType', pattern: 'reports/**']]])\n\n            // ... snip ...\n        }\n    }\n}\n\nAccept a Baseline\n\nMost projects don’t start off with automated tests passing or even running.\nThey start with a people hacking and prototyping, and eventually they start to write tests.\nAs new tests are written, having tests checked-in, running, and failing can be valuable information.\nWith the xUnit plugin we can accept a baseline of failed cases and drive that number down over time.\n\nI’ll start by changing the Jenkinsfile to fail jobs only if the number of failures is greater than an expected baseline,\nin this case four failures. When I run the job with this change, the reported numbers remain the same, but the job passes.\n\nJenkinsfile\n\n// The rest of the Jenkinsfile is unchanged.\n// Only the xUnit step() call is modified.\nstep([$class: 'XUnitBuilder',\n    thresholds: [[$class: 'FailedThreshold', failureThreshold: '4']],\n    tools: [[$class: 'JUnitType', pattern: 'reports/**']]])\n\nNext, I can also check that the plugin reports the job as failed if more failures occur.\nSince this is sample code, I’ll do this by adding another failing test and checking the job\nreports as failed.\n\ntests/guineaPig.js\n\n// ... snip ...\n\n    'Guinea Pig Assert Title 0 - D': function(client) { /* ... */ },\n\n    'Guinea Pig Assert Title 0 - E': function(client) {\n        client\n            .url('https://saucelabs.com/test/guinea-pig')\n            .waitForElementVisible('body', 1000)\n            //.assert.title('I am a page title - Sauce Labs');\n            .assert.title('I am a page title - Sauce Labs - Cause a Failure');\n    },\n\n    afterEach: function(client, done) { /* ... */ }\n\n// ... snip ...\n\nIn a real project, we’d make fixes over a number of commits bringing the number of failures down and adjusting our baseline.\nSince this is a sample, I’ll just make all tests pass and set the job failure threshold for failed and skipped cases to zero.\n\nJenkinsfile\n\n// The rest of the Jenkinsfile is unchanged.\n// Only the xUnit step() call is modified.\nstep([$class: 'XUnitBuilder',\n    thresholds: [\n        [$class: 'SkippedThreshold', failureThreshold: '0'],\n        [$class: 'FailedThreshold', failureThreshold: '0']],\n    tools: [[$class: 'JUnitType', pattern: 'reports/**']]])\n\ntests/guineaPig.js\n\n// ... snip ...\n\n    'Guinea Pig Assert Title 0 - D': function(client) { /* ... */ },\n\n    'Guinea Pig Assert Title 0 - E': function(client) {\n        client\n            .url('https://saucelabs.com/test/guinea-pig')\n            .waitForElementVisible('body', 1000)\n            .assert.title('I am a page title - Sauce Labs');\n    },\n\n    afterEach: function(client, done) { /* ... */ }\n\n// ... snip ...\n\ntests/guineaPig_1.js\n\n// ... snip ...\n\n    'Guinea Pig Assert Title 1 - A': function(client) {\n        client\n            .url('https://saucelabs.com/test/guinea-pig')\n            .waitForElementVisible('body', 1000)\n            .assert.title('I am a page title - Sauce Labs');\n    },\n\n// ... snip ...\n\nAllow for Flakiness\n\nWe’ve all known the frustration of having one flaky test that fails once every ten jobs.\nYou want to keep it active so you can working isolating the source of the problem,\nbut you also don’t want to destablize your CI pipeline or reject commits that are actually okay.\nYou could move the test to a separate job that runs the \"flaky\" tests,\nbut in my experience that just leads to a job that is always in a failed state\nand a pile of flaky tests no one looks at.\n\nWith the xUnit plugin, we can keep the this flaky test in main test suite but allow\nthe our job to still pass.\n\nI’ll start by adding a sample flaky test.  After a few runs, we can see the test\nfails intermittently and causes the job to fail too.\n\ntests/guineaPigFlaky.js\n\n// New test file: tests/guineaPigFlaky.js\nvar https = require('https');\nvar SauceLabs = require(\"saucelabs\");\n\nmodule.exports = {\n\n    '@tags': ['guineaPig'],\n\n    'Guinea Pig Flaky Assert Title 0': function(client) {\n        var expectedTitle = 'I am a page title - Sauce Labs';\n        // Fail every fifth minute\n        if (Math.floor(Date.now() / (1000 * 60)) % 5 === 0) {\n            expectedTitle += \" - Cause failure\";\n        }\n\n        client\n            .url('https://saucelabs.com/test/guinea-pig')\n            .waitForElementVisible('body', 1000)\n            .assert.title(expectedTitle);\n    }\n\n    afterEach: function(client, done) {\n        client.customSauceEnd();\n\n        setTimeout(function() {\n            done();\n        }, 1000);\n\n    }\n\n};\n\nI can almost hear my teammates screaming in frustration just looking at this report.\nTo allow specific tests to be unstable but not others,\nI’m going to add a guard \"suite completed\" test to the suites that should be stable,\nand keep flaky test on it’s own.\nThen I’ll tell xUnit to allow for a number of failed tests, but no skipped ones.\nIf any test fails other than the ones I allow to be flaky,\nit will also result in one or more skipped tests and will fail the build.\n\n// The rest of the Jenkinsfile is unchanged.\n// Only the xUnit step() call is modified.\nstep([$class: 'XUnitBuilder',\n    thresholds: [\n        [$class: 'SkippedThreshold', failureThreshold: '0'],\n        // Allow for a significant number of failures\n        // Keeping this threshold so that overwhelming failures are guaranteed\n        //     to still fail the build\n        [$class: 'FailedThreshold', failureThreshold: '10']],\n    tools: [[$class: 'JUnitType', pattern: 'reports/**']]])\n\ntests/guineaPig.js\n\n// ... snip ...\n\n    'Guinea Pig Assert Title 0 - E': function(client) { /* ... */ },\n\n    'Guinea Pig Assert Title 0 - Suite Completed': function(client) {\n      // No assertion needed\n    },\n\n    afterEach: function(client, done) { /* ... */ }\n\n// ... snip ...\n\ntests/guineaPig_1.js\n\n// ... snip ...\n\n    'Guinea Pig Assert Title 1 - E': function(client) { /* ... */ },\n\n    'Guinea Pig Assert Title 1 - Suite Completed': function(client) {\n      // No assertion needed\n    },\n\n    afterEach: function(client, done) { /* ... */ }\n\n// ... snip ...\n\nAfter a few more runs, you can see the flaky test is still being flaky,\nbut it is no longer failing the build.  Meanwhile, if another test fails,\nit will cause the \"suite completed\" test to be skipped, failing the job.\nIf this were a real project, the test owner could instrument and eventually fix\nthe test.  When they were confident they had stabilized the test the could add\na \"suite completed\" test after it to enforce it passing without changes to other\ntests or framework.\n\nConclusion\n\nThis post has shown how to migrate from the JUnit plugin to the\nxUnit plugin on an existing project in Jenkins pipeline.  It also covered how to\nuse the features of xUnit plugin to get more meaningful and effective Jenkins\nreporting behavior.\n\nWhat I didn’t show was how many other formats xUnit supports - from CCPUnit to MSTest.  You can\nalso write your own XSL for result formats not on the known/supported list.\n\nLinks\n\nxUnit plugin\n\nbitwiseman/JS-Nightwatch.js\n\nsaucelabs-sample-test-frameworks","title":"xUnit and Pipeline","tags":["pipeline","plugins","xunit","nightwatch"],"authors":[{"avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#382818","images":{"fallback":{"src":"/gatsby-jenkins-io/static/9717c5c33fe8f4903eec2f2b5a8d1532/19e71/lnewman.jpg","srcSet":"/gatsby-jenkins-io/static/9717c5c33fe8f4903eec2f2b5a8d1532/77b35/lnewman.jpg 32w,\n/gatsby-jenkins-io/static/9717c5c33fe8f4903eec2f2b5a8d1532/d4a57/lnewman.jpg 64w,\n/gatsby-jenkins-io/static/9717c5c33fe8f4903eec2f2b5a8d1532/19e71/lnewman.jpg 128w,\n/gatsby-jenkins-io/static/9717c5c33fe8f4903eec2f2b5a8d1532/68974/lnewman.jpg 256w","sizes":"(min-width: 128px) 128px, 100vw"},"sources":[{"srcSet":"/gatsby-jenkins-io/static/9717c5c33fe8f4903eec2f2b5a8d1532/ef6ff/lnewman.webp 32w,\n/gatsby-jenkins-io/static/9717c5c33fe8f4903eec2f2b5a8d1532/8257c/lnewman.webp 64w,\n/gatsby-jenkins-io/static/9717c5c33fe8f4903eec2f2b5a8d1532/6766a/lnewman.webp 128w,\n/gatsby-jenkins-io/static/9717c5c33fe8f4903eec2f2b5a8d1532/22bfc/lnewman.webp 256w","type":"image/webp","sizes":"(min-width: 128px) 128px, 100vw"}]},"width":128,"height":128}}},"blog":null,"github":"bitwiseman","html":"<div class=\"paragraph\">\n<p>Liam started his software career as a tester, which might explain why he&#8217;s such a fan of CI/CD and Pipeline as Code.\nHe has spent the majority of his software engineering career implementing Continuous Integration systems at companies big and small.\nHe is a Jenkins project contributor and an expert in Jenkins Pipeline, both Scripted and Declarative.\nLiam currently works as a Jenkins Evangelist at <a href=\"https://cloudbees.com\">CloudBees</a>.\nWhen not at work, he enjoys testing gravity by doing Aikido.</p>\n</div>","id":"lnewman","irc":null,"linkedin":null,"name":"Liam Newman","slug":"/blog/authors/lnewman","twitter":"bitwiseman"}]}}]}},"pageContext":{"limit":8,"skip":352,"numPages":100,"currentPage":45}},
    "staticQueryHashes": ["3649515864"]}