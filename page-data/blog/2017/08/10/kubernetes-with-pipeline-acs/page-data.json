{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/blog/2017/08/10/kubernetes-with-pipeline-acs/",
    "result": {"data":{"blog":{"html":"<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-note\" title=\"Note\"></i>\n</td>\n<td class=\"content\">\n<div class=\"paragraph\">\n<p>This is a guest post by <a href=\"https://github.com/puicchan\">Pui Chee Chen</a>,\nProduct Manager at Microsoft working on\n<a href=\"https://jenkinsworld20162017.sched.com/event/AK4K/azure-devops-open-source-integrations\">Azure\nDevOps open source integrations</a>.</p>\n</div>\n</td>\n</tr>\n</table>\n</div>\n<div class=\"paragraph\">\n<p>Recently, we improved the <a href=\"https://plugins.jenkins.io/azure-credentials\">Azure Credential plugin</a> by\nadding a custom binding for Azure Credentials which allows you to use an\n<a href=\"https://docs.microsoft.com/en-us/cli/azure/create-an-azure-service-principal-azure-cli?toc=%2fazure%2fazure-resource-manager%2ftoc.json\">Azure\nservice principal</a> (the analog to a service or system account) via  the\nCredentials Binding plugin. This means it&#8217;s now trivial to run Azure CLI\ncommands from a Jenkins Pipeline. We also recently published the first version\nof the <a href=\"https://plugins.jenkins.io/azure-app-service\">Azure App Service plugin</a> which makes it <em>very</em>\neasy to deploy\n<a href=\"https://azure.microsoft.com/en-us/services/app-service/web/\">Azure Web\nApps</a> directly from Jenkins Pipeline. While we&#8217;ll have\nmuch more to discuss in our Jenkins World presentation on\n<a href=\"https://jenkinsworld20162017.sched.com/event/AK4K/azure-devops-open-source-integrations\">Azure\nDevOps open source integrations</a>, in this blog post I wanted to share some good\nsnippets of what is possible today with Jenkins Pipeline and Azure.</p>\n</div>\n<div class=\"paragraph\">\n<p>First, a simple example using the Azure CLI to list resources in the\nsubscription:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"nowrap\">// Scripted //\nnode {\n    /* .. snip .. */\n    stage('Deploy') {\n        withCredentials([azureServicePrincipal('principal-credentials-id')]) {\n            sh 'az login --service-principal -u $AZURE_CLIENT_ID -p $AZURE_CLIENT_SECRET -t $AZURE_TENANT_ID'\n            sh 'az account set -s $AZURE_SUBSCRIPTION_ID'\n            sh 'az resource list'\n        }\n    }\n}\n// Declarative //</pre>\n</div>\n</div>\n<div class=\"admonitionblock warning\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-warning\" title=\"Warning\"></i>\n</td>\n<td class=\"content\">\n<div class=\"paragraph\">\n<p><code>azureServicePrincipal()</code> cannot be used in Declarative Pipeline until\n<a href=\"https://issues.jenkins.io/browse/JENKINS-46103\">JENKINS-46103</a> is\nresolved.</p>\n</div>\n</td>\n</tr>\n</table>\n</div>\n<div class=\"paragraph\">\n<p>Once a Pipeline can interact with Azure, there are countless ways one could\nimplement continuous delivery with Jenkins and Azure. From a deploying a simple\nwebapp with the\n<a href=\"https://azure.microsoft.com/en-us/blog/annoucing-jenkins-deploy-to-azure-app-service-plugin-and-new-managed-disk-support-for-azure-storage-plugin/\">Azure\nApp Service plugin</a> and the <code>azureWebAppPublish</code> step, or a more advanced\ncontainer-based delivery pipeline to deliver new containers to\n<a href=\"https://docs.microsoft.com/en-us/azure/container-service/kubernetes/container-service-tutorial-kubernetes-deploy-cluster\">Kubernetes\nvia Azure Container Service</a>.</p>\n</div>\n<div class=\"paragraph\">\n<p>With the <a href=\"https://plugins.jenkins.io/docker-workflow\">Docker Pipeline plugin</a> and a little bit of\nextra scripting, a Jenkins Pipeline can also build and publish a Docker\ncontainer to an\n<a href=\"https://azure.microsoft.com/en-us/services/container-registry/\">Azure\nContainer Registry</a>:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"nowrap\">// Scripted //\nimport groovy.json.JsonSlurper\n\nnode {\n    def container\n    def acrSettings\n\n    withCredentials([azureServicePrincipal('principal-credentials-id')]) {\n        stage('Prepare Environment') {\n            sh 'az login --service-principal -u $AZURE_CLIENT_ID -p $AZURE_CLIENT_SECRET -t $AZURE_TENANT_ID'\n            sh 'az account set -s $AZURE_SUBSCRIPTION_ID'\n            acrSettings = new JsonSlurper().parseText(\n                                            sh(script: \"az acs show -o json -n my-acr\", returnStdout: true))\n        }\n\n        stage('Build') {\n            container = docker.build(\"${acrSettings.loginServer}/my-app:${env.BUILD_ID}\")\n        }\n\n        stage('Publish') {\n            /* https://issues.jenkins.io/browse/JENKINS-46108 */\n            sh \"docker login -u ${AZURE_CLIENT_ID} -p ${AZURE_CLIENT_SECRET} ${acrSettings.loginServer}\"\n            container.push()\n        }\n\n        stage('Deploy') {\n            echo 'Orchestrating a new deployment with kubectl is a simple exercise left to the reader ;)'\n        }\n    }\n}\n// Declarative //</pre>\n</div>\n</div>\n<hr>\n<div class=\"paragraph\">\n<p>If you have been following our\n<a href=\"https://azure.microsoft.com/en-us/blog/tag/jenkins/\">Azure Blog</a>, you may\nhave noticed we have shipped a <strong>lot</strong> of updates to provide better support for\nAzure on Jenkins, and vice versa, such as:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><strong>Hosted Jenkins</strong>. New\n<a href=\"https://azuremarketplace.microsoft.com/en-us/marketplace/apps/azure-oss.jenkins\">Solution\nTemplate</a> in Azure Marketplace lets you spin up a\nJenkins Controller on Azure in minutes. Not only is it easy and fast, the solution\ntemplate gives you option to scale up by selecting the VM disk type and size.\nAnd guess what? You can even select the Jenkins release type you want to use -\nLTS, weekly build or Azure verified - all under your control.</p>\n</li>\n<li>\n<p><strong>Continuous integration experience</strong>. In the latest version of our\n<a href=\"https://plugins.jenkins.io/azure-vm-agents\">Azure VM Agents plugin</a>, we improved the user\nexperience and added the option to let you to select Managed Disk for disk\ntype (which is currently used extensively on\n<a href=\"https://ci.jenkins.io\">ci.jenknis.io</a>. You no longer need to worry about\nexceeding the number of VMs on your subscription.</p>\n</li>\n<li>\n<p><strong>Continuous deployment experience</strong>. Now, if\nAzure CLI is not your cup of tea, we released our first plugin to provide\ncontinuous deployment support to Azure App Service. The plugin supports all\nlanguages Azure App Service supports. We even have a walkthrough\n<a href=\"https://docs.microsoft.com/en-us/azure/jenkins/deploy-jenkins-app-service-plugin\">here</a> in the\nbrand new Jenkins Hub where you can find all Jenkins on Azure resources.</p>\n</li>\n<li>\n<p><strong>Pipeline readiness</strong>. Also, all Azure plugins are and will be pipeline ready.\nHave you been leveraging our\n<a href=\"https://plugins.jenkins.io/windows-azure-storage\">Azure Storage plugin</a> in your Pipeline?</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>So, whatâ€™s next? We have a big surprise in store at Jenkins World! :)</p>\n</div>\n<div class=\"paragraph\">\n<p>We are serious about supporting open source and the open source community.\nBe sure to catch our talk on\n<a href=\"https://jenkinsworld20162017.sched.com/event/AK4K/azure-devops-open-source-integrations\">Azure\nDevOps open source integrations</a>.\nSee you at\n<a href=\"https://www.cloudbees.com/jenkinsworld\">Jenkins World 2017</a>!</p>\n</div>\n<div class=\"admonitionblock warning\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-warning\" title=\"Warning\"></i>\n</td>\n<td class=\"content\">\n<div class=\"paragraph\">\n<p>Join the Azure DevOps team at\n<a href=\"https://www.cloudbees.com/jenkinsworld/home\">Jenkins World</a> in August,\nregister with the code <code>JWFOSS</code> for a 30% discount off your pass.</p>\n</div>\n</td>\n</tr>\n</table>\n</div>","id":"7a11360a-42a4-5d64-8401-89a9e4f35904","title":"CI/CD with Jenkins Pipeline and Azure","date":"2017-08-10T00:00:00.000Z","slug":"/blog/2017/08/10/kubernetes-with-pipeline-acs/","links":{"discourse":""},"authors":[{"avatar":{"childImageSharp":null},"blog":"http://unethicalblogger.com","github":"rtyler","html":"<div class=\"paragraph\">\n<p>R&#46; Tyler Croy has been part of the Jenkins project for the past seven years.\nWhile avoiding contributing any Java code, Tyler is involved in many of the\nother aspects of the project which keep it running, such as this website,\ninfrastructure, governance, etc.</p>\n</div>","id":"rtyler","irc":null,"linkedin":null,"name":"R. Tyler Croy","slug":"blog/author/rtyler","twitter":"agentdero"}]}},"pageContext":{"next":"/blog/2017/08/11/remoting-update/","previous":"/blog/2017/08/08/introducing-jenkins-minute/","id":"7a11360a-42a4-5d64-8401-89a9e4f35904"}},
    "staticQueryHashes": ["1271460761","3649515864"]}