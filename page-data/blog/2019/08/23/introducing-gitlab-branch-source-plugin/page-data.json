{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/blog/2019/08/23/introducing-gitlab-branch-source-plugin/",
    "result": {"data":{"blog":{"html":"<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>The GitLab Branch Source Plugin has come out of its beta stage and has been released to the Jenkins update center. It allows you to create job based on GitLab <code>user</code> or <code>group</code> or <code>subgroup</code> project(s). You can either:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Import a single project&#8217;s branches as jobs from a GitLab user/group/subgroup (Multibranch Pipeline Job)</p>\n</li>\n<li>\n<p>Import all or a subset of projects as jobs from a GitLab user/group/subgroup (GitLab Group Job or GitLab Folder Organization)</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>The GitLab Group project scans the projects, importing the pipeline jobs it identifies based on the criteria provided. After a project is imported, Jenkins immediately runs the jobs based on the <code>Jenkinsfile</code> pipeline script and notifies the status to GitLab Pipeline Status. This plugin unlike other Branch Source Plugins provides GitLab server configuration which can be configured in Configure System. Jenkins Configuration as Code (JCasC) can also be used to configure the server. To learn more about server configuration see my <a href=\"https://jenkins.io/blog/2019/06/29/phase-1-multibranch-pipeline-support-for-gitlab/\">previous blog post</a>.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"requirements\"><a class=\"anchor\" href=\"#requirements\"></a>Requirements</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Jenkins - 2.176.2 (LTS)</p>\n</li>\n<li>\n<p>GitLab - v11.0+</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"creating-a-job\"><a class=\"anchor\" href=\"#creating-a-job\"></a>Creating a Job</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>To create a Multibranch Pipeline Job (with GitLab branch source) or GitLab Group Job, you must have GitLab Personal Access Token added to the server configuration. The credentials is used to fetch meta data of the project(s) and to set up hooks on GitLab Server. If the token has admin access you can also set up <code>System Hooks</code> while <code>Web Hooks</code> can be set up from any user token.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"create-a-multibranch-pipeline-job\"><a class=\"anchor\" href=\"#create-a-multibranch-pipeline-job\"></a>Create a Multibranch Pipeline Job</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Go to Jenkins &gt; New Item &gt; Multibranch Pipeline &gt; Add Source &gt; GitLab Project</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/post-images/gsoc-gitlab-branch-source-plugin/branch-source.png\" alt=\"GitLab Project Branch Source\">\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>Server</code> - Select your desired GitLab server from the dropdown, needs to be configured before creating this job.</p>\n</li>\n<li>\n<p><code>Checkout Credentials</code> - Add credentials of type <code>SSHPrivateKey</code> or <code>Username/Password</code> if there are any private projects to be built by the plugin. If all projects are public then no checkout credentials required. Checkout credential is different from the credential (of type <code>GitLab Personal Access Token</code>) setup in GitLab server config.</p>\n</li>\n<li>\n<p><code>Owner</code> - Can be a <code>user</code>, <code>group</code> or <code>subgroup</code>. Depending on this the <code>Projects</code> field is populated.</p>\n</li>\n<li>\n<p><code>Projects</code> - Select the project you want to build from the dropdown.</p>\n</li>\n<li>\n<p><code>Behaviours</code> - These traits are very powerful tool to configure the build logic and post build logic. We have defined new traits. You can see all the information in repository documentation.</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>Save and wait for the branches indexing. You are free to navigate from here, the job progress is displayed to the left hand side.</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/post-images/gsoc-gitlab-branch-source-plugin/multibranch-indexing.png\" alt=\"Multibranch Pipeline Job Indexing\">\n</div>\n</div>\n<div class=\"paragraph\">\n<p>After the indexing, the imported project listed all the branches, merge requests and tags as jobs.</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/post-images/gsoc-gitlab-branch-source-plugin/multibranch-folder.png\" alt=\"Multibranch Pipeline Job Folder\">\n</div>\n</div>\n<div class=\"paragraph\">\n<p>On visiting each job, you will find some action items on the left hand side:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>You can trigger the job manually by selecting <code>Build Now</code>.</p>\n</li>\n<li>\n<p>You can visiting the particular branch/merge request/tag on your GitLab Server by selecting the corresponding button.</p>\n</li>\n</ul>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/post-images/gsoc-gitlab-branch-source-plugin/icon-tag.png\" alt=\"Build Actions\">\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"create-a-gitlab-group-job-type\"><a class=\"anchor\" href=\"#create-a-gitlab-group-job-type\"></a>Create a GitLab Group Job Type</h3>\n<div class=\"paragraph\">\n<p>Go to Jenkins &gt; New Item &gt; GitLab Group</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/post-images/gsoc-gitlab-branch-source-plugin/gitlab-group.png\" alt=\"GitLab Folder Organization\">\n</div>\n</div>\n<div class=\"paragraph\">\n<p>You can notice the configuration is very similar to Multibranch Pipeline Job with only <code>Projects</code> field missing. You can add all the projects inside your Owner i.e. User/Group/Subgroup. The form validation will check with your GitLab server if the owner is valid. You can add <code>Discover subgroup project</code> trait which allows you to discover this child projects of all subgroups inside a Group or Subgroup but this trait is not applicable to User. While indexing, web hook is created in each project. GitLab Api doesn&#8217;t support creation of Group web hooks so this plugin doesn&#8217;t support that feature which is only available in GitLab EE.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can now explore your imported projects, configuring different settings on each of those folders if needed.</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/post-images/gsoc-gitlab-branch-source-plugin/gitlab-group-folder.png\" alt=\"GitLab Group Folder\">\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"gitlab-pipeline-status-notification\"><a class=\"anchor\" href=\"#gitlab-pipeline-status-notification\"></a>GitLab Pipeline Status Notification</h3>\n<div class=\"paragraph\">\n<p>GitLab is notified about build status from the point of queuing of jobs.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Success - the job was successful</p>\n</li>\n<li>\n<p>Failure - the job failed and the merge request is not ready to be merged</p>\n</li>\n<li>\n<p>Error - something unexpected happened; example: the job was aborted in Jenkins</p>\n</li>\n<li>\n<p>Pending - the job is waiting in the build queue</p>\n</li>\n</ul>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/post-images/gsoc-gitlab-branch-source-plugin/pipeline-status.png\" alt=\"GitLab Pipeline Status\">\n</div>\n</div>\n<div class=\"paragraph\">\n<p>On GitLab Pipeline status are hyperlinks to the corresponding Jenkins job build. To see the Pipeline Stages and the console output you will be required to visit your Jenkins server. We also planned to notify the pipeline stages to GitLab but it came with some drawbacks which has been addressed so far but there is future plan to add it as trait.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can also skip notifying GitLab about the pipeline status by selecting <code>Skip pipeline status notifications</code> from the traits list.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"merge-requests\"><a class=\"anchor\" href=\"#merge-requests\"></a>Merge Requests</h3>\n<div class=\"paragraph\">\n<p>Implementing support for Merge Requests for the projects was challenging. First, MRs are of 2 types i.e. Origin branches and Forked Project branches so there had to be different implementation for each head. Second, MRs from forks can be from untrusted sources, so a new strategy <code>Trust Members</code> was implemented which allows CI to build MRs only from trusted users who have accesslevel of <code>Developer</code>/<code>Maintainer</code>/<code>Owner</code>.</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/post-images/gsoc-gitlab-branch-source-plugin/trusted-members.png\" alt=\"Trusted Member Strategy\">\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Third, MRs from forks do not support pipeline status notification due to GitLab issue, see <a href=\"https://docs.gitlab.com/ee/ci/merge_request_pipelines/#important-notes-about-merge-requests-from-forked-projects\">this</a>. You can add a trait <code>Log Build Status as Comment on GitLab</code> that allows you to add a sudo user (leave empty if you want owner user) to comment on the commit/tag/mrs the build result. To add a sudo user your token must have admin access. By default only failure/error are logged as comment but you can also enable logging of success build by ticking the checkbox.</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/post-images/gsoc-gitlab-branch-source-plugin/log-comment-trait.png\" alt=\"Build Status Comment Trait\">\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Sometimes, Merge Requests fail due to external errors so you want to trigger rebuild of mr by commenting <code>jenkins rebuild</code>. To enable this trigger add the trait <code>Trigger build on merge request comment</code>. The comment body can be changed in the trait. For security reasons, commentor should have <code>Developer</code>/<code>Maintainer</code>/<code>Owner</code> accesslevel in the project.</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/post-images/gsoc-gitlab-branch-source-plugin/build-trigger-trait.png\" alt=\"Merge request build trigger\">\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"hooks\"><a class=\"anchor\" href=\"#hooks\"></a>Hooks</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Web hooks are automatically created on your projects if configured to do so in server configuration. Web hooks are ensured to pass through a CSRF filter. Jenkins listens to web hooks on the path <code>/gitlab-webhook/post</code>. On GitLab web hooks are triggered on the following events:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>Push Event</code> - when a commit or branch is pushed</p>\n</li>\n<li>\n<p><code>Tag Event</code> - when a new tag is created</p>\n</li>\n<li>\n<p><code>Merge Request Event</code> - when a merge request is created/updated</p>\n</li>\n<li>\n<p><code>Note Event</code> - when a comment is made on a merge request</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>You can also set up System Hooks on your GitLab server if your token has admin access. System hooks are triggered when new projects are created, Jenkins triggers a rescan of the new project based on the configuration and sets up web hook on it. Jenkins listens to system hooks on the path <code>/gitlab-systemhook/post</code>. On GitLab system hooks are triigered on <code>Repository Update Events</code>.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can also use <code>Override Hook Management mode</code> trait to override the default hook management and choose if you want to use a different context (say Item) or disable it altogether.</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/post-images/gsoc-gitlab-branch-source-plugin/override-hook.png\" alt=\"Override Hook Management\">\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"job-dsl-and-jcasc\"><a class=\"anchor\" href=\"#job-dsl-and-jcasc\"></a>Job DSL and JCasC</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>You can use <code>Job DSL</code> to create jobs. Here&#8217;s an example of Job DSL script:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight nowrap\"><code class=\"language-groovy\" data-lang=\"groovy\">organizationFolder('GitLab Organization Folder') {\n    description(\"GitLab org folder created with Job DSL\")\n    displayName('My Project')\n    // \"Projects\"\n    organizations {\n        gitLabSCMNavigator {\n            projectOwner(\"baymac\")\n            credentialsId(\"i&lt;3GitLab\")\n            serverName(\"gitlab-3214\")\n            // \"Traits\" (\"Behaviours\" in the GUI) that are \"declarative-compatible\"\n            traits {\n                subGroupProjectDiscoveryTrait() // discover projects inside subgroups\n                gitLabBranchDiscovery {\n                    strategyId(3) // discover all branches\n                }\n                originMergeRequestDiscoveryTrait {\n                    strategyId(1) // discover MRs and merge them with target branch\n                }\n                gitLabTagDiscovery() // discover tags\n            }\n        }\n    }\n    // \"Traits\" (\"Behaviours\" in the GUI) that are NOT \"declarative-compatible\"\n    // For some 'traits, we need to configure this stuff by hand until JobDSL handles it\n    // https://issues.jenkins.io/browse/JENKINS-45504\n    configure {\n        def traits = it / navigators / 'io.jenkins.plugins.gitlabbranchsource.GitLabSCMNavigator' / traits\n        traits &lt;&lt; 'io.jenkins.plugins.gitlabbranchsource.ForkMergeRequestDiscoveryTrait' {\n            strategyId(2)\n            trust(class: 'io.jenkins.plugins.gitlabbranchsource.ForkMergeRequestDiscoveryTrait$TrustPermission')\n        }\n    }\n    // \"Project Recognizers\"\n    projectFactories {\n        workflowMultiBranchProjectFactory {\n            scriptPath 'Jenkinsfile'\n        }\n    }\n    // \"Orphaned Item Strategy\"\n    orphanedItemStrategy {\n        discardOldItems {\n            daysToKeep(10)\n            numToKeep(5)\n        }\n    }\n    // \"Scan Organization Folder Triggers\" : 1 day\n    // We need to configure this stuff by hand because JobDSL only allow 'periodic(int min)' for now\n    triggers {\n        periodicFolderTrigger {\n            interval('1d')\n        }\n    }\n}</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>You can also use <code>JCasC</code> to directly create job from a Job DSL script. For example see the plugin <a href=\"https://github.com/jenkinsci/gitlab-branch-source-plugin/blob/master/README.md\">repository</a>.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"how-to-talk-to-us-about-bugs-or-new-features\"><a class=\"anchor\" href=\"#how-to-talk-to-us-about-bugs-or-new-features\"></a>How to talk to us about bugs or new features?</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>This project uses <a href=\"https://issues.jenkins.io/\">Jenkins JIRA</a> to track issues. You can file issues under <a href=\"https://issues.jenkins.io/issues/?jql=project+%3D+JENKINS+AND+component+%3D+gitlab-branch-source-plugin\"><code>gitlab-branch-source-plugin</code></a> component.</p>\n</li>\n<li>\n<p>Send your mail in the <a href=\"https://groups.google.com/forum/#!forum/jenkinsci-dev\">Developer Mailing list</a>.</p>\n</li>\n<li>\n<p>Join our <a href=\"https://gitter.im/jenkinsci/gitlab-branch-source-plugin\">Gitter channel</a>.</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"future-work\"><a class=\"anchor\" href=\"#future-work\"></a>Future work</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Actively maintain <code>GitLab Branch Source Plugin</code> and take feedbacks from users to improve the plugin&#8217;s user experience.</p>\n</li>\n<li>\n<p>Extend support for GitLab Pipeline to Blueocean.</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"resources\"><a class=\"anchor\" href=\"#resources\"></a>Resources</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://github.com/jenkinsci/gitlab-api-plugin\">GitLab API Plugin</a></p>\n</li>\n<li>\n<p><a href=\"https://wiki.jenkins.io/display/JENKINS/GitLab+API+Plugin\">GitLab API Plugin Wiki</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/jenkinsci/gitlab-branch-source-plugin\">GitLab Branch Source Plugin</a></p>\n</li>\n<li>\n<p><a href=\"https://jenkins.io/projects/gsoc/2019/gitlab-support-for-multibranch-pipeline/\">Project Summary</a></p>\n</li>\n<li>\n<p><a href=\"https://go.cloudbees.com/docs/plugins/github-branch-source/\">GitHub Branch Source Plugin Release</a></p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>Thank you Jenkins and Google Summer of Code :)</p>\n</div>\n</div>\n</div>","id":"eddbf0dc-37bf-5f4d-8a6e-0bef8711db73","title":"Introducing new GitLab Branch Source Plugin","date":"2019-08-23T00:00:00.000Z","slug":"/blog/2019/08/23/introducing-gitlab-branch-source-plugin/","links":{"discourse":""},"authors":[{"avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#181818","images":{"fallback":{"src":"/gatsby-jenkins-io/static/f0b1fd16f8bec9a14b57a0b0108486f1/20305/baymac.jpg","srcSet":"/gatsby-jenkins-io/static/f0b1fd16f8bec9a14b57a0b0108486f1/eb017/baymac.jpg 32w,\n/gatsby-jenkins-io/static/f0b1fd16f8bec9a14b57a0b0108486f1/ed0e7/baymac.jpg 64w,\n/gatsby-jenkins-io/static/f0b1fd16f8bec9a14b57a0b0108486f1/20305/baymac.jpg 128w,\n/gatsby-jenkins-io/static/f0b1fd16f8bec9a14b57a0b0108486f1/b3c75/baymac.jpg 256w","sizes":"(min-width: 128px) 128px, 100vw"},"sources":[{"srcSet":"/gatsby-jenkins-io/static/f0b1fd16f8bec9a14b57a0b0108486f1/bcdad/baymac.webp 32w,\n/gatsby-jenkins-io/static/f0b1fd16f8bec9a14b57a0b0108486f1/21187/baymac.webp 64w,\n/gatsby-jenkins-io/static/f0b1fd16f8bec9a14b57a0b0108486f1/33025/baymac.webp 128w,\n/gatsby-jenkins-io/static/f0b1fd16f8bec9a14b57a0b0108486f1/d386c/baymac.webp 256w","type":"image/webp","sizes":"(min-width: 128px) 128px, 100vw"}]},"width":128,"height":192}},"publicURL":"/gatsby-jenkins-io/static/f0b1fd16f8bec9a14b57a0b0108486f1/baymac.jpg"},"blog":null,"github":"baymac","html":"<div class=\"paragraph\">\n<p>GSoC 2019 student under Jenkins project. Maintainer of GitLab Branch Source Plugin. Software Developer at Udaan, India.</p>\n</div>","id":"baymac","irc":null,"linkedin":"parichay.barpanda","name":"Parichay Barpanda","slug":"/blog/authors/baymac","twitter":"baymac04"}]}},"pageContext":{"id":"eddbf0dc-37bf-5f4d-8a6e-0bef8711db73"}},
    "staticQueryHashes": ["1271460761","3649515864"]}