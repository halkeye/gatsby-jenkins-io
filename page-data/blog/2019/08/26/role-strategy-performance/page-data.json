{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/blog/2019/08/26/role-strategy-performance/",
    "result": {"data":{"blog":{"html":"<div class=\"paragraph\">\n<p>The task for my Google Summer of Code program was to improve the performance\nof the Role Strategy Plugin. The performance issues for Role Strategy Plugin\nhad been reported multiple times on Jenkins JIRA. With a large number of roles\nand with complex regular expressions, a large slow-down was visible on the Web UI.\nEven before GSoC started, there were a number of patches which tried to improve\nperformance of the plugin (by <a href=\"https://github.com/deepanshnagaria\">Deepansh Nagaria</a>\nand others).</p>\n</div>\n<div class=\"paragraph\">\n<p>At the time, there was no way to reliably measure improvements in performance.\nTherefore, we started by creating a\n<a href=\"/blog/2019/06/21/performance-testing-jenkins/\">framework</a>\nfor running micro-benchmarks on Jenkins Plugins. Benchmarks using the framework\nwere added to the <a href=\"https://plugins.jenkins.io/role-strategy\">Role Strategy Plugin</a> find performance\ncritical parts of the plugins and to measure the improvements of a change.\nThis blog post summarizes the changes that were made and performance improvements\nmeasured.</p>\n</div>\n<div class=\"sect3\">\n<h4 id=\"caching-matching-roles\"><a class=\"anchor\" href=\"#caching-matching-roles\"></a>Caching matching roles</h4>\n<div class=\"paragraph\">\n<p>A couple of major changes were made to the Role Strategy Plugin to improve its\nperformance. First, we started collection of roles that matched a given\nproject name. The Role Strategy plugin before version 2.12 used to run over\nregular expressions for every role that it had for every permission checking\nrequest it got. Storing this produced set of roles in the memory provides us\nlarge improvements in performance and avoids repeated matching of project names\nwith regular expressions. For keeping the plugin working securely, we invalidate\nthe cache whenever any update is made to the roles.</p>\n</div>\n<div class=\"paragraph\">\n<p>After this change, we were able to observe performance improvements of up to\n3300%. These improvements were visualized using\n<a href=\"https://jmh.morethan.io/\">JMH Visualizer</a>.</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/post-images/role-strategy-performance/benchmarks1.png\" alt=\"Benchmarks results after caching matching roles\">\n</div>\n</div>\n<div class=\"paragraph\">\n<p>More information is available at pull request on GitHub:\n<a href=\"https://github.com/jenkinsci/role-strategy-plugin/pull/81\" class=\"bare\">https://github.com/jenkinsci/role-strategy-plugin/pull/81</a></p>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"calculating-implying-permisions-when-plugin-is-loaded\"><a class=\"anchor\" href=\"#calculating-implying-permisions-when-plugin-is-loaded\"></a>Calculating Implying Permisions when plugin is loaded</h4>\n<div class=\"paragraph\">\n<p>Jenkins' permission model allows one permissions to imply other permissions.\nWhen a permission check is made, we need to check if the user has any of\npermissions that would imply this permisison. For every permission checking\nrequest that that the Role Strategy, it used to calculate all the implying\npermissions. To avoid this, we now calculate and store implying permissions\nfor every permission in the Jenkins system when the plugin gets loaded.</p>\n</div>\n<div class=\"paragraph\">\n<p>After both of these changes, we were able to experience improvements of up to\n10000%. The benchmark results show it better:</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/post-images/role-strategy-performance/benchmarks2.png\" alt=\"Benchmarks results after both changes\">\n</div>\n</div>\n<div class=\"paragraph\">\n<p>More information about this change can be found at the GitHub pull request:\n<a href=\"https://github.com/jenkinsci/role-strategy-plugin/pull/83\" class=\"bare\">https://github.com/jenkinsci/role-strategy-plugin/pull/83</a></p>\n</div>\n<div class=\"paragraph\">\n<p>Both of these changes were integrated into the Role Strategy Plugin and the\nimprovements can be experienced starting with version\n<a href=\"https://github.com/jenkinsci/role-strategy-plugin/releases/tag/role-strategy-2.13\">2.13</a>.</p>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"bonus-configuration-as-code-export-now-works-for-role-strategy\"><a class=\"anchor\" href=\"#bonus-configuration-as-code-export-now-works-for-role-strategy\"></a>Bonus: Configuration-as-Code export now works for Role Strategy</h4>\n<div class=\"paragraph\">\n<p>With <a href=\"https://plugins.jenkins.io/configuration-as-code\">Configuration-as-Code plugin</a> version\n<a href=\"https://github.com/jenkinsci/configuration-as-code-plugin/releases/tag/configuration-as-code-1.24\">1.24</a>\nand above, export of your configuration as YAML now works!</p>\n</div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"/images/post-images/role-strategy-performance/jcasc-export.png\" alt=\"Role Strategy configuration export working with JCasC 1.24\">\n</div>\n</div>\n<div class=\"paragraph\">\n<p>As an alternative to\nRole Strategy Plugin, I also created the brand new <a href=\"https://plugins.jenkins.io/folder-auth\">Folder Authorization Plugin</a>.\nYou can check out the <a href=\"/blog/2019/08/16/folder-auth-plugin/\">blog post</a> for\nmore information about the plugin.</p>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"links-and-feedback\"><a class=\"anchor\" href=\"#links-and-feedback\"></a>Links and Feedback</h4>\n<div class=\"paragraph\">\n<p>I would love to hear your comments and suggestions. Please feel free to reach\nout to me through either the\n<a href=\"https://gitter.im/jenkinsci/role-strategy-plugin\">Role Strategy Plugin Gitter chat</a> or through\n<a href=\"mailto:jenkinsci-dev@googlegroups.com\">Jenkins Developer Mailing list</a>.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://drive.google.com/file/d/1lAXDljWXypCq6noiqPHI-eZJqBqaSYue/view?usp=sharing\">Presentation slides for final evaluation of GSoC</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/jenkinsci/folder-auth-plugin\">The Folder Authorization Plugin</a></p>\n</li>\n<li>\n<p><a href=\"https://youtu.be/g19o24uzy6c?t=1234\">Demo for the final evaluations</a></p>\n</li>\n</ul>\n</div>\n</div>","id":"ec0ca077-b2d0-53a4-8b1d-2ecb784b35fd","title":"Performance Improvements to Role Strategy Plugin","date":"2019-08-26T00:00:00.000Z","slug":"/blog/2019/08/26/role-strategy-performance/","links":{"discourse":""},"authors":[{"avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#d8d8d8","images":{"fallback":{"src":"/gatsby-jenkins-io/static/a1ce355d937f34af4ad5cbf6a6d79f30/ff5b9/abhyudayasharma.jpg","srcSet":"/gatsby-jenkins-io/static/a1ce355d937f34af4ad5cbf6a6d79f30/f4523/abhyudayasharma.jpg 32w,\n/gatsby-jenkins-io/static/a1ce355d937f34af4ad5cbf6a6d79f30/1e7bb/abhyudayasharma.jpg 64w,\n/gatsby-jenkins-io/static/a1ce355d937f34af4ad5cbf6a6d79f30/ff5b9/abhyudayasharma.jpg 128w,\n/gatsby-jenkins-io/static/a1ce355d937f34af4ad5cbf6a6d79f30/b48b6/abhyudayasharma.jpg 256w","sizes":"(min-width: 128px) 128px, 100vw"},"sources":[{"srcSet":"/gatsby-jenkins-io/static/a1ce355d937f34af4ad5cbf6a6d79f30/1fd06/abhyudayasharma.webp 32w,\n/gatsby-jenkins-io/static/a1ce355d937f34af4ad5cbf6a6d79f30/9edd6/abhyudayasharma.webp 64w,\n/gatsby-jenkins-io/static/a1ce355d937f34af4ad5cbf6a6d79f30/f5f75/abhyudayasharma.webp 128w,\n/gatsby-jenkins-io/static/a1ce355d937f34af4ad5cbf6a6d79f30/05d06/abhyudayasharma.webp 256w","type":"image/webp","sizes":"(min-width: 128px) 128px, 100vw"}]},"width":128,"height":142}}},"blog":null,"github":"AbhyudayaSharma","html":"<div class=\"paragraph\">\n<p>Abhyudaya is a Computer Science student at Shiv Nadar University, India.\nHe is participating in Google Summer of Code 2019 to improve the performance\nof the <a href=\"https://github.com/jenkinsci/role-strategy-plugin\">Role Strategy Plugin</a>.</p>\n</div>","id":"abhyudayasharma","irc":null,"linkedin":null,"name":"Abhyudaya Sharma","slug":"/blog/authors/abhyudayasharma","twitter":null}]}},"pageContext":{"next":"/blog/2019/08/30/jenkins-cli/","previous":"/blog/2019/08/25/jenkinsworld-contrib-summit-ask-the-expert-booth/","id":"ec0ca077-b2d0-53a4-8b1d-2ecb784b35fd"}},
    "staticQueryHashes": ["1271460761","3649515864"]}