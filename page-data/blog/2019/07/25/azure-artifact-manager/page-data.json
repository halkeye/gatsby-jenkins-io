{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/blog/2019/07/25/azure-artifact-manager/",
    "result": {"data":{"blog":{"html":"<div class=\"paragraph\">\n<p>Jenkins stores all generated artifacts on the controller server filesystem. This presents a couple of challenges especially when you try to run Jenkins in the cloud:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>As the number of artifacts grow, your Jenkins controller will run out of disk space. Eventually, performance can be impacted.</p>\n</li>\n<li>\n<p>Frequent transfer of files between agents and controller may cause load, CPU or network issues which are always hard to diagnose.</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>Several existing plugins allow you to manage your artifacts externally. To use these plugins, you need to know how they work and perform specific steps in your job&#8217;s configuration. And if you are new to Jenkins, you may find it hard to follow existing samples in Jenkins tutorial like <a href=\"https://jenkins.io/doc/pipeline/tour/tests-and-artifacts/\">Recording tests and artifacts</a>.</p>\n</div>\n<div class=\"paragraph\">\n<p>So, if you are running Jenkins in Azure, you can consider automatically managing new artifacts on <a href=\"https://azure.microsoft.com/en-us/services/storage/\">Azure Storage</a>. The new <a href=\"https://plugins.jenkins.io/azure-artifact-manager\">Azure Artifact Management plugin</a> allows you to store artifacts in Azure blob storage and simplify your existing Jenkins jobs that contain Jenkins general artifacts management steps. This approach will give you all the advantages of a cloud storage, with less effort on your part to maintain your Jenkins instance.</p>\n</div>\n<div class=\"sect1\">\n<h2 id=\"configuration\"><a class=\"anchor\" href=\"#configuration\"></a>Configuration</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"azure-storage-account\"><a class=\"anchor\" href=\"#azure-storage-account\"></a>Azure storage account</h3>\n<div class=\"paragraph\">\n<p>First, you need to have an Azure Storage account. You can skip this section if you already have one. Otherwise, create an Azure storage account for storing your artifacts. Follow this <a href=\"https://docs.microsoft.com/en-us/azure/storage/common/storage-quickstart-create-account?tabs=azure-portal\">tutorial</a> to quickly create one. Then navigate to <strong>Access keys</strong> in the <strong>Settings</strong> section to get the storage account name and one of its keys.</p>\n</div>\n<div class=\"paragraph\">\n<p><span class=\"image center\"><img src=\"/images/post-images/2019-07-25-azure-artifact-manager/1-azure-accesskey.png\" alt=\"1 azure accesskey\"></span></p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"existing-jenkins-instance\"><a class=\"anchor\" href=\"#existing-jenkins-instance\"></a>Existing Jenkins instance</h3>\n<div class=\"paragraph\">\n<p>For existing Jenkins instance, make sure you install the <a href=\"https://plugins.jenkins.io/azure-artifact-manager\">Azure Artifact Manager</a> plugin. Then you can go to your Jenkins <em>System Configuration</em> page and locate the <em>Artifact Management for Builds</em> section. Select the <strong>Add</strong> button to configure an Azure Artifact Storage. Fill in the following parameters:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><strong>Storage Type:</strong> Azure storage supports several storage types like blob, file, queue etc. This plugin currently supports blob storage only.</p>\n</li>\n<li>\n<p><strong>Storage Credentials:</strong> Credentials used to authenticate with Azure storage. If you do not have an existing Azure storage credential in you Jenkins credential store, click the <strong>Add</strong> button and choose <strong>Microsoft Azure Storage</strong> kind to create one.</p>\n</li>\n<li>\n<p><strong>Azure Container Name:</strong> The container under which to keep your artifacts. If the container name does not exist in the blob, this plugin automatically creates one for you when artifacts are uploaded to the blob.</p>\n</li>\n<li>\n<p><strong>Base Prefix:</strong> Prefix added to your artifact paths stored in your container, a forward slash will be parsed as a folder. In the following screenshot, all your artifacts will be stored in the “staging” folder in the container “Jenkins”.</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p><span class=\"image center\"><img src=\"/images/post-images/2019-07-25-azure-artifact-manager/2.configuration.png\" alt=\"2.configuration\"></span></p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"new-jenkins-instance\"><a class=\"anchor\" href=\"#new-jenkins-instance\"></a>New Jenkins instance</h3>\n<div class=\"paragraph\">\n<p>If you need to create a new Jenkins controller, follow this <a href=\"https://docs.microsoft.com/en-us/azure/jenkins/install-jenkins-solution-template\">tutorial</a> to quickly create an Jenkins instance on Azure. In the <strong>Integration Settings</strong> section, you can now set up Azure Artifact Manager directly. Note that you can change any of the configuration after your Jenkins instance is created. Azure storage account and credential, in this case, are still prerequisites.</p>\n</div>\n<div class=\"paragraph\">\n<p><span class=\"image center\"><img src=\"/images/post-images/2019-07-25-azure-artifact-manager/3.integration-setting-azure.png\" alt=\"3.integration setting azure\"></span></p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"usage\"><a class=\"anchor\" href=\"#usage\"></a>Usage</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"jenkins-pipeline\"><a class=\"anchor\" href=\"#jenkins-pipeline\"></a>Jenkins Pipeline</h3>\n<div class=\"paragraph\">\n<p>Here are a few commonly used artifact related steps in pipeline jobs; all are supported to push artifacts to the Azure Storage blob specified.</p>\n</div>\n<div class=\"paragraph\">\n<p>You can use <em>archiveArtifacts</em> step to archive target artifacts into Azure storage. For more details about <em>archiveArtifacts</em> step, see the Jenkins <a href=\"https://jenkins.io/doc/pipeline/steps/core/#archiveartifacts-archive-the-artifacts\">archiveArtifacts setp documentation</a>.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"nowrap\">node {\n  //...\n  stage('Archive') {\n    archiveArtifacts \"pattern\"\n  }\n}</pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>You can use the <em>unarchive</em> step to retrieve the artifacts from Azure storage. For more details about <em>unarchive</em> step, please see <a href=\"https://jenkins.io/doc/pipeline/steps/workflow-basic-steps/#unarchive-copy-archived-artifacts-into-the-workspace\">unarchive step documentation</a>.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"nowrap\">node {\n  //...\n  stage('Unarchive') {\n    unarchive mapping: [\"pattern\": '.']\n  }\n}</pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>To save a set of files so that you can use them later in the same build (generally on another node or workspace), you can use <em>stash</em> step to store files into Azure storage for later use. <em>Stash</em> step documentation can be found <a href=\"https://jenkins.io/doc/pipeline/steps/workflow-basic-steps/#unstash-restore-files-previously-stashed\">here</a>.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"nowrap\">node {\n  //...\n  stash name: 'name', includes: '*'\n}</pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>You can use <em>unstash</em> step to retrieve the files saved with <em>stash</em> step from Azure storage to the local workspace.  <em>Unstash</em> documentation can be found <a href=\"https://jenkins.io/doc/pipeline/steps/workflow-basic-steps/#unstash-restore-files-previously-stashed\">here</a>.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"nowrap\">node {\n  //...\n  unstash 'name'\n}</pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"freestyle-job\"><a class=\"anchor\" href=\"#freestyle-job\"></a>FreeStyle Job</h3>\n<div class=\"paragraph\">\n<p>For a FreeStyle Jenkins job, you can use <strong>Archive the artifacts</strong> step in <strong>Post-build Actions</strong> to upload the target artifacts into Azure storage.</p>\n</div>\n<div class=\"paragraph\">\n<p><span class=\"image center\"><img src=\"/images/post-images/2019-07-25-azure-artifact-manager/4.post-build-actions.png\" alt=\"4.post build actions\"></span></p>\n</div>\n<div class=\"paragraph\">\n<p>This Azure Artifact Manager plugin is also compatible with some other popular management plugins, such as the <a href=\"https://plugins.jenkins.io/copyartifact\">Copy Artifact</a> plugin. You can still use these plugins without changing anything.</p>\n</div>\n<div class=\"paragraph\">\n<p><span class=\"image center\"><img src=\"/images/post-images/2019-07-25-azure-artifact-manager/5-build.png\" alt=\"5 build\"></span></p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"troubleshooting\"><a class=\"anchor\" href=\"#troubleshooting\"></a>Troubleshooting</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>If you have any problems or suggestions when using Azure Artifact Manager plugin, you can file a ticket on <a href=\"https://issues.jenkins.io/secure/Dashboard.jspa\">Jenkins JIRA</a> for the azure-artifact-manager-plugin component.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"conclusion\"><a class=\"anchor\" href=\"#conclusion\"></a>Conclusion</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>The <a href=\"https://plugins.jenkins.io/azure-artifact-manager\">Azure Artifact Manager</a> enables a more cloud-native Jenkins. This is the first step in the <a href=\"https://jenkins.io/sigs/cloud-native/\">Cloud Native project</a>. We have a long way to go to get Jenkins to run on cloud environments as a true “Cloud Native” application. We need help and welcome your participation and contributions to make Jenkins better. Please start contributing and/or give us feedback!</p>\n</div>\n</div>\n</div>","id":"c8dcfc2d-fe9b-51ed-b1d8-8da5973e144c","title":"Managing Jenkins Artifacts with the Azure Artifact Manager Plugin","date":"2019-07-25T00:00:00.000Z","slug":"/blog/2019/07/25/azure-artifact-manager/","links":{"discourse":""},"authors":[{"avatar":{"childImageSharp":null},"blog":null,"github":"gavinfish","html":"<div class=\"paragraph\">\n<p>Software engineer at Microsoft. Focusing on DevOps and cloud native.</p>\n</div>","id":"jshen","irc":null,"linkedin":null,"name":"Jie Shen","slug":"blog/author/jshen","twitter":null}]}},"pageContext":{"next":"/blog/2019/07/30/plugin-management-tool-phase2-updates/","previous":"/blog/2019/07/21/Jenkins-code-coverage-diff-for-pull-request/","id":"c8dcfc2d-fe9b-51ed-b1d8-8da5973e144c"}},
    "staticQueryHashes": ["1271460761","3649515864"]}