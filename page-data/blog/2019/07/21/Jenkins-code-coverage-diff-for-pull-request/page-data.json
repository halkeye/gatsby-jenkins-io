{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/blog/2019/07/21/Jenkins-code-coverage-diff-for-pull-request/",
    "result": {"data":{"blog":{"html":"<div class=\"paragraph\">\n<p>Hello.</p>\n</div>\n<div class=\"paragraph\">\n<p>As you may know, during the last year GSoC <a href=\"https://github.com/cizezsy\">Mr. Shenyu Zheng</a> was working on the <a href=\"/projects/gsoc/2018/code-coverage-api-plugin/\">Jenkins Code Coverage API Plugin</a>. With Mr. Zheng we made a change so the plugin now is able to check the difference in code coverage between pull requests and target branches.</p>\n</div>\n<div class=\"paragraph\">\n<p>In lots of projects it is a common practice to track if unit tests code coverage doesn&#8217;t decrease. So, with this plugin, you may skip separate services that track code coverage and have this feature right in your favorite CI system.</p>\n</div>\n<div class=\"sect1\">\n<h2 id=\"how-it-works\"><a class=\"anchor\" href=\"#how-it-works\"></a>How it works</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>When you build a PR in Jenkins, using plugins like <a href=\"https://plugins.jenkins.io/github\">Github</a> or <a href=\"https://plugins.jenkins.io/cloudbees-bitbucket-branch-source\">Bitbucket Branch Source</a>, that use <a href=\"https://wiki.jenkins.io/display/JENKINS/SCM+API+Plugin\">SCM API Plugin</a>, your PR knows what target branch commit it is based on. (The commit may change because of <em>Discover pull requests from origin</em> strategies). To calculate the diff, when you publish your coverage from PR, it looks for the target branch build for the commit that your PR was based on. If it finds the build on the target branch, it looks for any published code coverage for this target branch build. In case the build has it, the plugin calculates the percentage diff for the <strong>line coverage</strong> and shows it on the pull request build page. Also, it gives you a link to the target branch build that was used for the comparison.</p>\n</div>\n<div class=\"paragraph\">\n<p>That it how it looks like:</p>\n</div>\n<div class=\"paragraph\">\n<div class=\"title\">Decreased coverage</div>\n<p><span class=\"image\"><img src=\"/images/post-images/2019-07-21-Jenkins-code-coverage-diff-for-pull-request/decrease.png\" alt=\"decrease\"></span></p>\n</div>\n<div class=\"paragraph\">\n<div class=\"title\">Increased coverage</div>\n<p><span class=\"image\"><img src=\"/images/post-images/2019-07-21-Jenkins-code-coverage-diff-for-pull-request/increase.png\" alt=\"increase\"></span></p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"how-to-enable-code-coverage-diff-for-pull-requests\"><a class=\"anchor\" href=\"#how-to-enable-code-coverage-diff-for-pull-requests\"></a>How to enable code coverage diff for pull requests</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>To enable this behavior you need to publish your code coverage with the <code>calculateDiffForChangeRequests</code> flag equals <code>true</code>, like this:\n.Jenkinsfile</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight nowrap\"><code class=\"language-groovy\" data-lang=\"groovy\">node(...) {\n  ...\n  // Here we are using the istanbulCoberturaAdapter\n  publishCoverage adapters: [istanbulCoberturaAdapter('cobertura-coverage.xml')],\n    sourceFileResolver: sourceFiles('NEVER_STORE'),\n    calculateDiffForChangeRequests: true\n\n  ...\n}</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"links-and-feedback\"><a class=\"anchor\" href=\"#links-and-feedback\"></a>Links and Feedback</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>If you have some questions about this behavior, please ask me <a href=\"mailto:dntsaygoodbye@gmail.com\">in email</a>.</p>\n</div>\n<div class=\"paragraph\">\n<p>You are free to contribute to this plugin to make it better for everyone. There are a lot of interesting features that can be added and issues that can be solved. Also, you can write some new plugins for other code coverage formats that use the Code Coverage API plugin as a base.</p>\n</div>\n<div class=\"paragraph\">\n<p>Here is the repo of the plugin - <a href=\"https://github.com/jenkinsci/code-coverage-api-plugin\">Code Coverage API Plugin</a></p>\n</div>\n<div class=\"paragraph\">\n<p>Thank you.</p>\n</div>\n</div>\n</div>","id":"e7a046ff-9ae1-585e-826a-dc8f41a2ab04","title":"Jenkins code coverage diff in pull requests","date":"2019-07-21T00:00:00.000Z","slug":"/blog/2019/07/21/Jenkins-code-coverage-diff-for-pull-request/","links":{"discourse":""},"authors":[{"avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#181818","images":{"fallback":{"src":"/gatsby-jenkins-io/static/6ea2a73294a8396d74efba91c53e1bfe/19e71/asavanchuk.jpg","srcSet":"/gatsby-jenkins-io/static/6ea2a73294a8396d74efba91c53e1bfe/77b35/asavanchuk.jpg 32w,\n/gatsby-jenkins-io/static/6ea2a73294a8396d74efba91c53e1bfe/d4a57/asavanchuk.jpg 64w,\n/gatsby-jenkins-io/static/6ea2a73294a8396d74efba91c53e1bfe/19e71/asavanchuk.jpg 128w,\n/gatsby-jenkins-io/static/6ea2a73294a8396d74efba91c53e1bfe/68974/asavanchuk.jpg 256w","sizes":"(min-width: 128px) 128px, 100vw"},"sources":[{"srcSet":"/gatsby-jenkins-io/static/6ea2a73294a8396d74efba91c53e1bfe/ef6ff/asavanchuk.webp 32w,\n/gatsby-jenkins-io/static/6ea2a73294a8396d74efba91c53e1bfe/8257c/asavanchuk.webp 64w,\n/gatsby-jenkins-io/static/6ea2a73294a8396d74efba91c53e1bfe/6766a/asavanchuk.webp 128w,\n/gatsby-jenkins-io/static/6ea2a73294a8396d74efba91c53e1bfe/22bfc/asavanchuk.webp 256w","type":"image/webp","sizes":"(min-width: 128px) 128px, 100vw"}]},"width":128,"height":128}},"publicURL":"/gatsby-jenkins-io/static/6ea2a73294a8396d74efba91c53e1bfe/asavanchuk.jpg"},"blog":null,"github":"tempora-mutantur","html":"<div class=\"paragraph\">\n<p>Software developer from Minsk, Belarus.</p>\n</div>","id":"asavanchuk","irc":null,"linkedin":null,"name":"Aliaksei Savanchuk","slug":"/blog/authors/asavanchuk","twitter":null}]}},"pageContext":{"id":"e7a046ff-9ae1-585e-826a-dc8f41a2ab04"}},
    "staticQueryHashes": ["1271460761","3649515864"]}