{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/blog/2016/05/23/external-workspace-manager-plugin/",
    "result": {"data":{"blog":{"html":"<div class=\"sect2\">\n<h3 id=\"about-myself\"><a class=\"anchor\" href=\"#about-myself\"></a>About myself</h3>\n<div class=\"paragraph\">\n<p>My name is Alexandru Somai.\nI&#8217;m following a major in Software Engineering at the Babes-Bolyai University of Cluj-Napoca, Romania.\nI have more than two years hands-on experience working in Software Development.</p>\n</div>\n<div class=\"paragraph\">\n<p>I enjoy writing code in Java, Groovy and JavaScript.\nThe technologies and frameworks that I&#8217;m most familiar with are: Spring Framework, Spring Security, Hibernate,\nJMS, Web Services, JUnit, TestNG, Mockito.\nAs build tools and continuous integration, I&#8217;m using Maven and Jenkins.\nI&#8217;m a passionate software developer who is always learning, always looking for new challenges.\nI want to start contributing to the open source community and Google Summer of Code is a starting point for me.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"project-summary\"><a class=\"anchor\" href=\"#project-summary\"></a>Project summary</h3>\n<div class=\"paragraph\">\n<p>Currently, Jenkinsâ€™ build workspace may become very large in size due to the fact that some compilers generate\nvery large volumes of data.\nThe existing plugins that share the workspace across builds are able to do this by copying the files from\none workspace to another, process which is inefficient.\nA solution is to have a Jenkins plugin that is able to manage and reuse the same workspace between multiple builds.</p>\n</div>\n<div class=\"paragraph\">\n<p>As part of the <a href=\"https://summerofcode.withgoogle.com/\">Google Summer of Code</a> 2016 I will be working on\nthe <em>External Workspace Manager</em> plugin.\nMy mentors for this project are <a href=\"https://github.com/oleg-nenashev\">Oleg Nenashev</a>\nand <a href=\"https://github.com/martinda\">Martin d&#8217;Anjou</a>.\nThis plugin aims to provide an external workspace management system.\nIt should facilitate workspace share and reuse across multiple Jenkins jobs.\nIt should eliminate the need to copy, archive or move files.\nThe plugin will be written for <a href=\"https://wiki.jenkins.io/display/JENKINS/Pipeline+Plugin\">Pipeline</a> jobs.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"usage\"><a class=\"anchor\" href=\"#usage\"></a>Usage</h3>\n<div class=\"sect3\">\n<h4 id=\"prerequisites\"><a class=\"anchor\" href=\"#prerequisites\"></a>Prerequisites</h4>\n<div class=\"olist arabic\">\n<ol class=\"arabic\">\n<li>\n<p>Multiple physical disks accessible from controller.</p>\n</li>\n<li>\n<p>The same physical disks must be accessible from Jenkins Nodes (renamed to Agents in Jenkins 2.0).</p>\n</li>\n<li>\n<p>In the Jenkins global configuration, define a disk pool (or many) that will contain the physical disks.</p>\n</li>\n<li>\n<p>In each Node configuration, define the mounting point from the current node to each physical disk.</p>\n</li>\n</ol>\n</div>\n<div class=\"paragraph\">\n<p>The following diagram gives you an overview of how an <em>External Workspace Manager</em> configuration may look like:</p>\n</div>\n<div class=\"paragraph\">\n<p><span class=\"image center\"><img src=\"/images/post-images/ewm/ewm-config.png\" alt=\"ewm config\" title=\"Simplified EWM config\"></span></p>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"example-one\"><a class=\"anchor\" href=\"#example-one\"></a>Example one</h4>\n<div class=\"paragraph\">\n<p>Let&#8217;s assume that we have one Jenkins job. In this job, we want to use the same workspace on multiple Jenkins nodes.\nOur pipeline code may look like this:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight nowrap\"><code class=\"language-groovy\" data-lang=\"groovy\">stage ('Stage 1. Allocate workspace')\ndef extWorkspace = exwsAllocate id: 'diskpool1'\n\nnode ('linux') {\n    exws (extWorkspace) {\n        stage('Stage 2. Build on the build server')\n        git url: '...'\n        sh 'mvn clean install'\n    }\n}\n\nnode ('test') {\n    exws (extWorkspace) {\n        stage('Stage 3. Run tests on a test machine')\n        sh 'mvn test'\n    }\n}</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Note: The <code>stage()</code> steps are optional from the <em>External Workspace Manager</em> plugin perspective.</p>\n</div>\n<div class=\"sect4\">\n<h5 id=\"stage-1-allocate-workspace\"><a class=\"anchor\" href=\"#stage-1-allocate-workspace\"></a>Stage 1. Allocate workspace</h5>\n<div class=\"paragraph\">\n<p>The <code>exwsAllocate</code> step selects a disk from <em>diskpool1</em>\n(default behavior: the disk with the most available size).\nOn that disk, let&#8217;s say <em>disk1</em>, it allocates a directory.\nThe computed directory path is: <code>/physicalPathOnDisk/$JOB_NAME/$BUILD_NUMBER</code>.</p>\n</div>\n<div class=\"paragraph\">\n<p>For example, Let&#8217;s assume that the <code>$JOB_NAME</code> is <em>integration</em> and the <code>$BUILD_NUMBER</code> is <em>14</em>.\nThen, the resulting path is: <code>/jenkins-project/disk1/integration/14</code>.</p>\n</div>\n</div>\n<div class=\"sect4\">\n<h5 id=\"stage-2-build-on-the-build-server\"><a class=\"anchor\" href=\"#stage-2-build-on-the-build-server\"></a>Stage 2. Build on the build server</h5>\n<div class=\"paragraph\">\n<p>All the nodes labeled <em>linux</em> must have access to the disks defined in the disk pool.\nIn the Jenkins Node configurations we have defined the local paths that are the mounting points to each disk.</p>\n</div>\n<div class=\"paragraph\">\n<p>The <code>exws</code> step concatenates the node&#8217;s local path with the path returned by the <code>exwsAllocate</code> step.\nIn our case, the node labeled <em>linux</em> has its local path to <em>disk1</em> defined as: <code>/linux-node/disk1/</code>.\nSo, the complete workspace path is: <code>/linux-node/disk1/jenkins-project/disk1/integration/14</code>.</p>\n</div>\n</div>\n<div class=\"sect4\">\n<h5 id=\"stage-3-run-tests-on-a-test-machine\"><a class=\"anchor\" href=\"#stage-3-run-tests-on-a-test-machine\"></a>Stage 3. Run tests on a test machine</h5>\n<div class=\"paragraph\">\n<p>Further, we want to run our tests on a different node, but we want to reuse the previously created workspace.</p>\n</div>\n<div class=\"paragraph\">\n<p>In the node labeled <em>test</em> we have defined the local path to <em>disk1</em> as: <code>/test-node/disk1/</code>.\nBy applying the <code>exws</code> step, our tests will be able to run in the same workspace as the build.\nTherefore, the path is: <code>/test-node/disk1/jenkins-project/disk1/integration/14</code>.</p>\n</div>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"example-two\"><a class=\"anchor\" href=\"#example-two\"></a>Example two</h4>\n<div class=\"paragraph\">\n<p>Let&#8217;s assume that we have two Jenkins jobs, one called <em>upstream</em> and the other one called <em>downstream</em>.\nIn the <em>upstream</em> job, we clone the repository and build the project, and in the <em>downstream</em> job we run the tests.\nIn the <em>downstream</em> job we don&#8217;t want to clone and re-build the project, we need to use the same\nworkspace created in the <em>upstream</em> job.\nWe have to be able to do so without copying the workspace content from one location to another.</p>\n</div>\n<div class=\"paragraph\">\n<p>The pipeline code in the <em>upstream</em> job is the following:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight nowrap\"><code class=\"language-groovy\" data-lang=\"groovy\">stage ('Stage 1. Allocate workspace in the upstream job')\ndef extWorkspace = exwsAllocate id: 'diskpool1'\n\nnode ('linux') {\n    exws (extWorkspace) {\n        stage('Stage 2. Build in the upstream job')\n           git url: '...'\n           sh 'mvn clean install'\n    }\n}</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>And the <em>downstream</em>'s pipeline code is:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight nowrap\"><code class=\"language-groovy\" data-lang=\"groovy\">stage ('Stage 3. Allocate workspace in the downstream job')\ndef extWorkspace = exwsAllocate id: 'diskpool1', upstream: 'upstream'\n\nnode ('test') {\n    exws (extWorkspace) {\n        stage('Stage 4. Run tests in the downstream job')\n        sh 'mvn test'\n    }\n}</code></pre>\n</div>\n</div>\n<div class=\"sect4\">\n<h5 id=\"stage-1-allocate-workspace-in-the-upstream-job\"><a class=\"anchor\" href=\"#stage-1-allocate-workspace-in-the-upstream-job\"></a>Stage 1. Allocate workspace in the upstream job</h5>\n<div class=\"paragraph\">\n<p>The functionality is the same as in example one - stage 1.\nIn our case, the allocated directory on the physical disk is: <code>/jenkins-project/disk1/upstream/14</code>.</p>\n</div>\n</div>\n<div class=\"sect4\">\n<h5 id=\"stage-2-build-in-the-upstream-job\"><a class=\"anchor\" href=\"#stage-2-build-in-the-upstream-job\"></a>Stage 2. Build in the upstream job</h5>\n<div class=\"paragraph\">\n<p>Same functionality as example one - stage 2.\nThe final workspace path is: <code>/linux-node/disk1/jenkins-project/disk1/upstream/14</code>.</p>\n</div>\n</div>\n<div class=\"sect4\">\n<h5 id=\"stage-3-allocate-workspace-in-the-downstream-job\"><a class=\"anchor\" href=\"#stage-3-allocate-workspace-in-the-downstream-job\"></a>Stage 3. Allocate workspace in the downstream job</h5>\n<div class=\"paragraph\">\n<p>By passing the <em>upstream</em> parameter to the <code>exwsAllocate</code> step,\nit selects the most recent stable upstream workspace (default behavior).\nThe workspace path pattern is like this: <code>/physicalPathOnDisk/$UPSTREAM_NAME/$MOST_RECENT_STABLE_BUILD</code>.\nLet&#8217;s assume that the last stable build number is <em>12</em>, then the resulting path is:\n<code>/jenkins-project/disk1/upstream/12</code>.</p>\n</div>\n</div>\n<div class=\"sect4\">\n<h5 id=\"stage-4-run-tests-in-the-downstream-job\"><a class=\"anchor\" href=\"#stage-4-run-tests-in-the-downstream-job\"></a>Stage 4. Run tests in the downstream job</h5>\n<div class=\"paragraph\">\n<p>The <code>exws</code> step concatenates the node&#8217;s local path with the path returned by the <code>exwsAllocate</code> step in stage 3.\nIn this scenario, the complete path for running tests is: <code>/test-node/disk1/jenkins-project/disk1/upstream/12</code>.\nIt will reuse the workspace defined in the upstream job.</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"additional-details\"><a class=\"anchor\" href=\"#additional-details\"></a>Additional details</h3>\n<div class=\"paragraph\">\n<p>You may find the complete project proposal, along with the design details, features, more examples and use cases,\nimplementation ideas and milestones in the <a href=\"https://goo.gl/fq3RAe\">design document</a>.\nThe plugin repository will be available on <a href=\"https://github.com/jenkinsci/external-workspace-manager-plugin\">GitHub</a>.</p>\n</div>\n<div class=\"paragraph\">\n<p>A prototype version of the plugin should be available in late June and the releasable version in late August.\nI will be holding plugin functionality demos within the community.</p>\n</div>\n<div class=\"paragraph\">\n<p>I do appreciate any feedback.\nYou may add comments in the <a href=\"https://goo.gl/fq3RAe\">design document</a>.\nIf you are interested to have a verbal conversation, feel free to join our regular meetings on Mondays at\n<a href=\"https://www.thetimezoneconverter.com/?t=12:00%20PM&amp;tz=UTC&amp;\">12:00 PM UTC</a>\non the <a href=\"https://jenkins-ci.org/hangout\">Jenkins hangout</a>.\nI will be posting updates from time to time about the plugin status on the\n<a href=\"https://groups.google.com/forum/#!forum/jenkinsci-dev\">Jenkins developers</a> mailing list.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"links\"><a class=\"anchor\" href=\"#links\"></a>Links</h3>\n<div class=\"paragraph\">\n<p><a href=\"https://gitter.im/jenkinsci/external-workspace-manager-plugin?utm_source=share-link&amp;utm_medium=link&amp;utm_campaign=share-link\"><span class=\"image\"><img src=\"https://badges.gitter.im/jenkinsci/external-workspace-manager-plugin.svg\" alt=\"title: &quot;Gitter&quot;\"></span></a></p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://goo.gl/fq3RAe\">Design document</a></p>\n</li>\n<li>\n<p><a href=\"https://summerofcode.withgoogle.com/\">GSoC program</a></p>\n</li>\n<li>\n<p><a href=\"https://wiki.jenkins.io/display/JENKINS/Google+Summer+Of+Code+2016\">Jenkins GSoC Page</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/jenkinsci/external-workspace-manager-plugin\">Project repository</a></p>\n</li>\n</ul>\n</div>\n</div>","id":"85257451-d116-575c-b893-3c51d7386caa","title":"GSoC Project Intro: External Workspace Manager Plugin","date":"2016-05-23T00:00:00.000Z","slug":"/blog/2016/05/23/external-workspace-manager-plugin/","links":{"discourse":""},"authors":[{"avatar":null,"blog":null,"github":"alexsomai","html":"","id":"alexsomai","irc":null,"linkedin":null,"name":"Alexandru Somai","slug":"blog/author/alexsomai","twitter":"alex_somai"}]}},"pageContext":{"next":"/blog/2016/05/25/update-plugin-for-pipeline/","previous":"/blog/2016/05/18/announcing-azure-partnership/","id":"85257451-d116-575c-b893-3c51d7386caa"}},
    "staticQueryHashes": ["1271460761","3649515864"]}