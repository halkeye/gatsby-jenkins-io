{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/blog/2020/03/02/findsecbugs/",
    "result": {"data":{"blog":{"html":"<div class=\"paragraph lead\">\n<p><a href=\"https://spotbugs.github.io/\">Spotbugs</a> is a utility used in Jenkins and many other Java projects to detect common Java coding mistakes and bugs. It is integrated into the build process to improve the code before it gets merged and released. <a href=\"https://find-sec-bugs.github.io/\">Findsecbugs</a> is a plugin for Spotbugs that adds 135 vulnerability types focused on the <a href=\"https://owasp.org/www-project-top-ten/\">OWASP TOP 10</a> and the <a href=\"https://cwe.mitre.org/\">Common Weakness Enumeration (CWE)</a>. I&#8217;m working on integrating findsecbugs into our Jenkins ecosystem.</p>\n</div>\n<div class=\"sect1\">\n<h2 id=\"background\"><a class=\"anchor\" href=\"#background\"></a>Background</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Spotbugs traces its history through Findbugs, which started in 2006. As Findbugs it was widely adopted by many projects. About 2016, the Findbugs project ground to a halt. Like the mythical phoenix, the Spotbugs project rose from the ashes to keep the capabilities alive. Most things are completely compatible between the two systems.</p>\n</div>\n<div class=\"paragraph\">\n<p>Jenkins has used Findbugs and now Spotbugs for years. This is integrated as a build step into parent Maven poms, including the <a href=\"https://github.com/jenkinsci/plugin-pom/\">plugin parent pom</a> and the <a href=\"https://github.com/jenkinsci/pom\">parent pom for libraries and core components</a>. There are various properties that can be set to control the detection threshold, the effort, and findings or categories to exclude. Take a look at the effective pom for a project to see the settings.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"conundrums\"><a class=\"anchor\" href=\"#conundrums\"></a>Conundrums</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>There is a fundamental conundrum with introducing an analysis tool into a project. The best time to have done it is always in the past, particularly when the project first started. There are always difficulties in introducing it into an existing project. Putting it off for later just delays the useful results and makes later implementation more difficult. The best time to do it is now, as early as possible.</p>\n</div>\n<div class=\"paragraph\">\n<p>All analysis tools are imperfect. They report some issues that don&#8217;t actually exist. They miss some important issues. This is worse in legacy code, making the adoption more difficult. Findings have to be examined and evaluated. Some are code weaknesses but don&#8217;t indicate necessary fixes. For example, MD5 has been known for years as a weak algorithm, unsuitable for security uses. It can be used for non-security purposes, such as fingerprinting, but even there other algorithms (SHA-2) are preferred. We should replace all usages of MD5, but in some cases that&#8217;s difficult and it&#8217;s not exactly a problem.</p>\n</div>\n<div class=\"paragraph\">\n<p>Ultimately, the gain from these analysis tools isn&#8217;t so much from finding issues in existing code. The value comes more from catching new regressions that might be introduced or improving new code. This is one reason why it is valuable to add useful new analysis such as findsecbugs now, so that we can begin reaping the benefits.</p>\n</div>\n<div class=\"paragraph\">\n<p>With a security tool like findsecbugs, there is another paradox. Adding the tool makes it easier to find potential security issues. Attackers could take advantage of this information. However, security by obscurity is not a good design. Anyone can run findsecbugs now without the project integrating it. Integrating it makes it easier for legitimate developers to resolve issues and prevent future ones.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"implementation\"><a class=\"anchor\" href=\"#implementation\"></a>Implementation</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>I&#8217;ve been working on integrating findsecbugs into the Jenkins project for several months. It is working in several repos. There are several others where I have presented draft PRs to demonstrate what it will look like once it is enabled. As soon as we can disseminate the information enough, I propose to enable it in the parent poms for widespread use.</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"existing\"><a class=\"anchor\" href=\"#existing\"></a>Existing</h3>\n<div class=\"paragraph\">\n<p>I started by enabling findsecbugs in two major components where I have a high degree of familiarity, Remoting, and Jenkins. Most of the work here involves examining each finding and figuring out what to do with it. In most cases this results in using one of the suppression mechanisms to ignore the finding. In some cases, the code can be removed or improved.</p>\n</div>\n<div class=\"paragraph\">\n<p>Findsecbugs reported a significant number of false positives in Remoting for a couple of notable reasons. (See the <a href=\"https://github.com/jenkinsci/remoting/pull/361\">PR</a>.) Remoting uses Spotbugs aggressively with a Low threshold setting. This produces more results. Findsecbugs targets Java web applications. As the communication layer between agents and controller, Remoting uses some mechanisms that would be a problem on the server side but are acceptable on the agent.</p>\n</div>\n<div class=\"paragraph\">\n<p>Even without all its plugins, Jenkins is a considerable collection of code. Findsecbugs reported a smaller number of false positives for Jenkins (See the <a href=\"https://github.com/jenkinsci/jenkins/pull/4381\">PR</a>.) It runs Spotbugs at a High threshold, so it only reports issues it deems more concerning. A number of these indicate code debt, deprecated code to remove, or areas that could be improved. I created Jira tickets for many of these.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"demonstrated\"><a class=\"anchor\" href=\"#demonstrated\"></a>Demonstrated</h3>\n<div class=\"paragraph\">\n<p>I have created draft PRs to demonstrate how findsecbugs will look in several plugins. The goal is not to use these PRs directly but instead integrate findsecbugs at the parent pom level. These PRs serve as reference documentation.</p>\n</div>\n<div class=\"dlist\">\n<dl>\n<dt class=\"hdlist1\"><a href=\"https://github.com/jenkinsci/credentials-plugin/pull/137\">Credentials</a></dt>\n<dd>\n<p>This one is particularly interesting because here findsecbugs correctly detects the remains of a valid security vulnerability (<a href=\"https://jenkins.io/security/advisory/2019-05-21/\">CVE-2019-10320</a>). Currently, this code is safely used only for migration of old data. If we had run findsecbugs on this plugin a year ago, it would have detected this valid vulnerability.</p>\n</dd>\n<dt class=\"hdlist1\"><a href=\"https://github.com/jenkinsci/ssh-slaves-plugin/pull/177\">SSH Build Agents</a></dt>\n<dd>\n<p>This one is interesting because it flags MD5 as a concern. Since it is used for fingerprinting, it isn&#8217;t a valid vulnerability, but since the hash isn&#8217;t stored it is easy to improve the code here.</p>\n</dd>\n<dt class=\"hdlist1\"><a href=\"https://github.com/jenkinsci/ec2-plugin/pull/432\">EC2</a></dt>\n<dd>\n<p>In this case, findsecbugs found some valid concerns, but the code isn&#8217;t used so it can be removed. Also, MD5 is harder to remove here but should be considered technical debt and removed when possible.</p>\n</dd>\n<dt class=\"hdlist1\"><a href=\"https://github.com/jenkinsci/platformlabeler-plugin/pull/165\">Platform Labeler</a></dt>\n<dd>\n<p>Findsecbugs didn&#8217;t find any concerns here. This means adapting to it requires no work. In this demonstration, I added a fake finding to prove that it was working.</p>\n</dd>\n<dt class=\"hdlist1\"><a href=\"https://github.com/jenkinsci/file-leak-detector-plugin/pull/9\">File Leak Detector</a></dt>\n<dd>\n<p>There is one simple finding noted here. Because it is part of the configuration performed by an administrator we can ignore it.</p>\n</dd>\n<dt class=\"hdlist1\"><a href=\"https://github.com/jenkinsci/credentials-binding-plugin/pull/88\">Credentials Binding</a></dt>\n<dd>\n<p>Nothing was found here so integration requires no effort.</p>\n</dd>\n</dl>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"proposed\"><a class=\"anchor\" href=\"#proposed\"></a>Proposed</h3>\n<div class=\"paragraph\">\n<p>My proposal is to integrate findsecbugs configuration into the parent poms as soon as we can. The delay is currently mostly around sharing the information to prepare developers by blog post, email list discussion, and presentation.</p>\n</div>\n<div class=\"paragraph\">\n<p>Even before I started working on this, <a href=\"https://github.com/StefanSpieker\">StefanSpieker</a> proposed a <a href=\"https://github.com/jenkinsci/pom/pull/61\">PR</a> to integrate into the parent Jenkins pom. This will apply to Jenkins libraries and core components. Once this is integrated, I will pull out the changes I made to the Jenkins and Remoting project poms.</p>\n</div>\n<div class=\"paragraph\">\n<p>I also plan on integrating findsecbugs into the plugin and Stapler parent poms. Once it is added to the plugin parent pom all plugins will automatically perform these checks when they upgrade their parent pom version. If there are any findings, developers will need to take care of them as described in the next section.</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"what-do-you-need-to-do\"><a class=\"anchor\" href=\"#what-do-you-need-to-do\"></a>What do you need to do?</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Once developers upgrade to a parent pom version that integrates findsecbugs, they may have to deal with evaluating, fixing, or suppressing findings. The parent pom versions do not yet exist but are in process or proposed.</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"extraneous-build-message\"><a class=\"anchor\" href=\"#extraneous-build-message\"></a>Extraneous build message</h3>\n<div class=\"paragraph\">\n<p>In some cases, an extraneous message may show up in the build logs. It starts with a line like this <code>The following classes needed for analysis were missing:</code> followed by lines listing some methods by name. Ignore this message. It results from SpotBugs printing some internal, debug information that isn&#8217;t helpful here.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"examine-findings\"><a class=\"anchor\" href=\"#examine-findings\"></a>Examine findings</h3>\n<div class=\"paragraph\">\n<p>If findsecbugs reports any findings, then a developer needs to examine and determine what to do about each one.</p>\n</div>\n<div class=\"dlist\">\n<dl>\n<dt class=\"hdlist1\">Excluding issues</dt>\n<dd>\n<p>You can exclude an issue, so that it is never reported in a project. This is done by configuring an exclusion file. If you encounter the findings CRLF_INJECTION_LOGS or INFORMATION_EXPOSURE_THROUGH_AN_ERROR_MESSAGE feel free to add these to an exclusion file. These are not considered a concern in Jenkins. See the <a href=\"https://github.com/jenkinsci/jenkins/pull/4381/files#diff-a3a723b46e92f2a14061ff6b9a589d67R16\">Jenkins project exclusion file</a> for an example. You should be cautious about including other issue types here.</p>\n</dd>\n<dt class=\"hdlist1\"><em>Temporarily</em> disable findsecbugs</dt>\n<dd>\n<p>You may disable findsecbugs by adding <code>&lt;Bug category=\"SECURITY\"/&gt;</code> to the exclusion file. I strongly encourage you to only disable findsecbugs temporarily when genuinely needed.</p>\n</dd>\n<dt class=\"hdlist1\">Suppress a finding</dt>\n<dd>\n<p>After determining that a finding is not important, you can suppress it by annotating a method or a class with <code>@SuppressFBWarnings(value = “&#8230;&#8203;”, justification=”&#8230;&#8203;”)</code>. I encourage you to suppress narrowly. Never suppress at the class level when you can add it to a method. For a long method, extract the problematic part into a small method and add the suppression there. I also encourage you to always add a meaningful justification.</p>\n</dd>\n<dt class=\"hdlist1\">Improve code</dt>\n<dd>\n<p>Whenever possible improve the code such that the problematic code no longer exists. This can include removing deprecated or unused code, using improved algorithms, or improving structure or implementation. This is where the significant gains come from with SpotBugs and findsecbugs. Also, as you make changes or add new features make sure to implement them so as not to introduce new issues.</p>\n</dd>\n<dt class=\"hdlist1\">Report security vulnerabilities</dt>\n<dd>\n<p>If you encounter a finding related to a valid security vulnerability, please report it via the <a href=\"https://jenkins.io/security/reporting/\">Jenkins security reporting process</a>. This is the responsible behavior that benefits the community. Try not to discuss or call attention to the issue before it can be disclosed in a Jenkins security advisory.</p>\n</dd>\n<dt class=\"hdlist1\">Create tasks</dt>\n<dd>\n<p>If you discover an improvement area that is too large to fit into your current work or release plan, I encourage you to record a task to get it done. You can do this in Jira, like I did for several issues in Jenkins core, or in whatever task management system you use.</p>\n</dd>\n</dl>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"conclusion\"><a class=\"anchor\" href=\"#conclusion\"></a>Conclusion</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>SpotBugs has long been used in Jenkins to catch bugs and improve code quality. Findsecbugs adds valuable security-related bug definitions. As we integrate it into the existing Jenkins code base it will require analysis and suppression for legacy code. This identifies areas we can improve and enhances quality as we move forward. Please responsibly <a href=\"https://jenkins.io/security/reporting/\">report</a> any security vulnerabilites you discover.</p>\n</div>\n</div>\n</div>","id":"8a3a05f0-7335-5af6-9e0c-880d773b3f24","title":"Findsecbugs for Developers","date":"2020-03-02T00:00:00.000Z","slug":"/blog/2020/03/02/findsecbugs/","links":{"discourse":""},"authors":[{"avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#685848","images":{"fallback":{"src":"/gatsby-jenkins-io/static/f1cc92ec0a7523e21842aee0aebbb56c/19e71/jeffret-b.jpg","srcSet":"/gatsby-jenkins-io/static/f1cc92ec0a7523e21842aee0aebbb56c/77b35/jeffret-b.jpg 32w,\n/gatsby-jenkins-io/static/f1cc92ec0a7523e21842aee0aebbb56c/d4a57/jeffret-b.jpg 64w,\n/gatsby-jenkins-io/static/f1cc92ec0a7523e21842aee0aebbb56c/19e71/jeffret-b.jpg 128w,\n/gatsby-jenkins-io/static/f1cc92ec0a7523e21842aee0aebbb56c/68974/jeffret-b.jpg 256w","sizes":"(min-width: 128px) 128px, 100vw"},"sources":[{"srcSet":"/gatsby-jenkins-io/static/f1cc92ec0a7523e21842aee0aebbb56c/ef6ff/jeffret-b.webp 32w,\n/gatsby-jenkins-io/static/f1cc92ec0a7523e21842aee0aebbb56c/8257c/jeffret-b.webp 64w,\n/gatsby-jenkins-io/static/f1cc92ec0a7523e21842aee0aebbb56c/6766a/jeffret-b.webp 128w,\n/gatsby-jenkins-io/static/f1cc92ec0a7523e21842aee0aebbb56c/22bfc/jeffret-b.webp 256w","type":"image/webp","sizes":"(min-width: 128px) 128px, 100vw"}]},"width":128,"height":128}},"publicURL":"/gatsby-jenkins-io/static/f1cc92ec0a7523e21842aee0aebbb56c/jeffret-b.jpg"},"blog":null,"github":"jeffret-b","html":"<div class=\"paragraph\">\n<p>Jeff has been using Jenkins for many years.\nSince 2018 he has been contributing to Jenkins core and plugins.\nHe maintains the Remoting library and participates on the Jenkins security team.</p>\n</div>","id":"jeffret-b","irc":null,"linkedin":null,"name":"Jeff Thompson","slug":"/blog/authors/jeffret-b/","twitter":null}]}},"pageContext":{"id":"8a3a05f0-7335-5af6-9e0c-880d773b3f24"}},
    "staticQueryHashes": ["1271460761","3649515864"]}