{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/blog/2020/08/29/git-performance-improvement-phase3/",
    "result": {"data":{"blog":{"html":"<div class=\"paragraph\">\n<p>Since the beginning of the project, the core value which drove its progress was \"To enhance the user experience for running Jenkins jobs by reducing the overall execution time\".</p>\n</div>\n<div class=\"paragraph\">\n<p>To achieve this goal, we laid out a path:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Compare the two existing git implementations i.e CliGitAPIImpl and JGitAPIImpl using performance benchmarking</p>\n</li>\n<li>\n<p>Use the results to create a feature which would improve the overall performance of git plugin</p>\n</li>\n<li>\n<p>Also, fix existing user reported performance issues</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>Let&#8217;s take a journey to understand how we&#8217;ve built the new features. If you&#8217;d like to skip the journey part, you can directly go to the <a href=\"#major performance improvements\">[major performance improvements]</a> section and the <a href=\"#minor performance section\">[minor performance section]</a> to see what we&#8217;ve done!</p>\n</div>\n<div class=\"sect1\">\n<h2 id=\"journey-to-release\"><a class=\"anchor\" href=\"#journey-to-release\"></a>Journey to release</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>The project started with deciding to choose a git operation and then trying to compare the performance of that operation by using <code>command line git</code> and then with <code>JGit</code>.</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"stage-1-benchmark-results-with-git-fetch\"><a class=\"anchor\" href=\"#stage-1-benchmark-results-with-git-fetch\"></a>Stage 1: Benchmark results with git fetch</h3>\n<div class=\"paragraph\">\n<p><span class=\"image\"><img src=\"/images/post-images/2020/07-git-plugin-performance-improvement/git-fetch-results.png\" alt=\"git-fetch-results\" width=\"938\"></span></p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>The performance of git fetch (average execution time/op) is strongly correlated to the size of a repository</p>\n</li>\n<li>\n<p>There exists an inflection point on the scale of repository size after which the nature of <code>JGit</code> performance changes (it starts to degrade)</p>\n</li>\n<li>\n<p>After running multiple benchmarks, it is safe to say that for a large sized repository <code>command line git</code> would be a better choice of implementation.</p>\n</li>\n<li>\n<p>We can use this insight to implement a feature which avoids <code>JGit</code> with large repositories.</p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"stage-2-comparing-platforms\"><a class=\"anchor\" href=\"#stage-2-comparing-platforms\"></a>Stage 2: Comparing platforms</h3>\n<div class=\"paragraph\">\n<p>The project was also concerned that there might be important differences between operating systems.\nFor example, what if command line Git for Windows performed very differently than command line Git on Linux or FreeBSD?\nBenchmarks were run to compare fetch performance on several platforms.</p>\n</div>\n<div class=\"paragraph\">\n<p>Running git fetch operation for a 400 MiB sized repository on:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>AMD64 Microsoft Winders</p>\n</li>\n<li>\n<p>AMD64 FreeBSD</p>\n</li>\n<li>\n<p>IBM PowerPC 64 LE Ubuntu 18</p>\n</li>\n<li>\n<p>IBM System 390 Ubuntu 18</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>The result of running this experiment is given below:</p>\n</div>\n<div class=\"paragraph\">\n<p><span class=\"image\"><img src=\"/images/post-images/2020/07-git-plugin-performance-improvement/git-multiple-platforms.png\" alt=\"Performance on multiple platforms\"></span></p>\n</div>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-note\" title=\"Note\"></i>\n</td>\n<td class=\"content\">\nThe difference in performance between <code>git</code> and <code>JGit</code> remains constant across all platforms.\n</td>\n</tr>\n</table>\n</div>\n<div class=\"paragraph\">\n<p>Benchmark results on one platform are applicable to all platforms.</p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"stage-3-performance-of-git-fetch-and-repository-structure\"><a class=\"anchor\" href=\"#stage-3-performance-of-git-fetch-and-repository-structure\"></a>Stage 3: Performance of git fetch and repository structure</h3>\n<div class=\"paragraph\">\n<p><span class=\"image center\"><img src=\"/images/post-images/2020/07-git-plugin-performance-improvement/git-repo-diagram.png\" alt=\"git repo diagram\" width=\"420\" title=\"Relationship of repository structure with performance\"></span></p>\n</div>\n<div class=\"paragraph\">\n<p>The area of the circle enclosing each parameter signifies the strength of the positive correlation between the performance of a git fetch operation and that parameter. From the diagram:<br></p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Size of the aggregated objects is the <strong>dominant</strong> player in determining the execution time for a git fetch</p>\n</li>\n<li>\n<p>Number of branches and Number of tags play a similar role but are strongly overshadowed by size of repository</p>\n</li>\n<li>\n<p>Number of commits has a negligible effect on the performance of running git fetch</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p><strong>After running these experiments from Stage-1 to Stage-3, we developed a solution called the <code>GitToolChooser</code> which is explained in the next stage</strong></p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"stage-4-faster-checkout-with-git-tool-chooser\"><a class=\"anchor\" href=\"#stage-4-faster-checkout-with-git-tool-chooser\"></a>Stage 4: Faster checkout with Git tool chooser</h3>\n<div class=\"paragraph\">\n<p>This feature takes the responsibility of choosing the optimal implementation from the <strong>user</strong> and hands it to the <strong>plugin</strong>. It takes the decision of recommending an implementation on the basis of the size of the repository. <a href=\"/blog/2020/07/29/git-performance-improvement-phase2/\">Here is how it works</a>.</p>\n</div>\n<div class=\"paragraph\">\n<p><span class=\"image center\"><img src=\"/images/post-images/2020/07-git-plugin-performance-improvement/git-perf-improv.png\" alt=\"git perf improv\" width=\"938\" title=\"Faster checkouts with GitToolChooser\"></span></p>\n</div>\n<div class=\"paragraph\">\n<p>The image above depicts the performance enhancements we have performed over the course of the GSoC project. These improvements have enabled the checkout step to be finished <strong>within half of what it used to take</strong> earlier in some cases.</p>\n</div>\n<div class=\"paragraph\">\n<p>Let&#8217;s talk about performance improvements in two parts.</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"major-performance-improvements\"><a class=\"anchor\" href=\"#major-performance-improvements\"></a>Major performance improvements</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><span class=\"image\"><img src=\"/images/post-images/2020/07-git-plugin-performance-improvement/git-major-perf.png\" alt=\"Major performance enhancements\" width=\"400\"></span></p>\n</div>\n<div class=\"paragraph\">\n<p>Building Tensorflow (~800 MiB) using a Jenkins pipeline, there is over 50% reduction in overall time spent in completing a job!\nThe result is consistent multiple platforms.</p>\n</div>\n<div class=\"paragraph\">\n<p>The reason for such a decrease is the fact that <code>JGit</code> degrades in performance when we are talking about large sized repositories. Since the GitToolChooser is aware of this fact, it chooses to recommend <code>command line git</code> instead which saves the user some time.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"minor-performance-improvements\"><a class=\"anchor\" href=\"#minor-performance-improvements\"></a>Minor performance improvements</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p><strong>Note: Enable JGit before using the new performance features to let GitToolChooser work with more options</strong> &#8594; <a href=\"https://plugins.jenkins.io/git-client/#enabling-jgit\">Here&#8217;s how</a></p>\n</div>\n<div class=\"paragraph\">\n<p><span class=\"image center\"><img src=\"/images/post-images/2020/07-git-plugin-performance-improvement/git-minor-perf.png\" alt=\"git minor perf\" width=\"400\" title=\"Minor performance enhancements\"></span></p>\n</div>\n<div class=\"paragraph\">\n<p>Building the git plugin (~ 20 MiB) using a Jenkins pipeline, there is a drop of a <strong>second</strong> across all platforms when performance enhancement is enabled. Also, eliminating a redundant fetch reduces unnecessary load on git servers.</p>\n</div>\n<div class=\"paragraph\">\n<p>The reason for this change is the fact that <code>JGit</code> performs better than <code>command line git</code> for small sized repositories (&lt;50MiB) as an already warmed up JVM favors the native Java implementation.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"releases\"><a class=\"anchor\" href=\"#releases\"></a>Releases</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://github.com/jenkinsci/git-plugin/releases/tag/git-4.4.0\">Git Plugin 4.4.0</a></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Add GitToolChooser</p>\n</li>\n<li>\n<p>Remove redundant fetch</p>\n</li>\n</ul>\n</div>\n</li>\n<li>\n<p><a href=\"https://github.com/jenkinsci/git-client-plugin/releases/tag/git-client-3.4.0\">Git Client Plugin 3.4.0</a></p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Add support to communicate compatibility of JGit with certain additional SCM behaviors</p>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"the-road-ahead\"><a class=\"anchor\" href=\"#the-road-ahead\"></a>The road ahead</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Support from other branch source plugins</p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Plugins like the GitHub Branch Source Plugin or GitLab Branch Source Plugin need to extend an extension point provided by the git plugin to facilitate the exchange of information related to size of a remote repository hosted by the particular git provider</p>\n</li>\n</ul>\n</div>\n</li>\n<li>\n<p><a href=\"https://issues.jenkins.io/browse/JENKINS-63519\">JENKINS-63519</a>: GitToolChooser predicts the wrong implementation</p>\n</li>\n<li>\n<p>Addition of this feature to GitSCMSource</p>\n</li>\n<li>\n<p>Detection of lock related delays accessing the cache directories present on the controller</p>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>This issue was reported by the plugin maintainer Mark Waite, there is a need to reproduce the issue first and then find a possible solution.</p>\n</li>\n</ul>\n</div>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"reaching-out\"><a class=\"anchor\" href=\"#reaching-out\"></a>Reaching out</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Feel free to reach out to us for any questions or feedback on the project&#8217;s\n<a href=\"https://gitter.im/jenkinsci/git-plugin\">Gitter Channel</a> or the\n<a href=\"mailto:jenkinsci-dev@googlegroups.com\">Jenkins Developer Mailing list</a>.\nReport an issue at Jenkins <a href=\"https://issues.jenkins.io/\">Jira</a>.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"useful-links\"><a class=\"anchor\" href=\"#useful-links\"></a>Useful Links</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Phase 1 Blog: <a href=\"https://www.jenkins.io/blog/2020/07/09/git-performance-improvement-phase1/\" class=\"bare\">https://www.jenkins.io/blog/2020/07/09/git-performance-improvement-phase1/</a></p>\n</li>\n<li>\n<p>Phase 2 Blog: <a href=\"https://www.jenkins.io/blog/2020/07/29/git-performance-improvement-phase2/\" class=\"bare\">https://www.jenkins.io/blog/2020/07/29/git-performance-improvement-phase2/</a></p>\n</li>\n<li>\n<p>Project Page: <a href=\"https://www.jenkins.io/projects/gsoc/2020/projects/git-plugin-performance/\" class=\"bare\">https://www.jenkins.io/projects/gsoc/2020/projects/git-plugin-performance/</a></p>\n</li>\n</ul>\n</div>\n<div class=\"sect2\">\n<h3 id=\"demonstration\"><a class=\"anchor\" href=\"#demonstration\"></a>Demonstration</h3>\n<div class=\"videoblock\">\n<div class=\"content\">\n<iframe width=\"800\" height=\"420\" src=\"https://www.youtube.com/embed/sEqK4dAFg4s?rel=0\" frameborder=\"0\" allowfullscreen></iframe>\n</div>\n</div>\n</div>\n</div>\n</div>","id":"a6cfa2b5-a75a-5920-892a-2548994c1318","title":"Git Plugin Performance Improvement: Final Phase and Release","date":"2020-08-29T00:00:00.000Z","slug":"/blog/2020/08/29/git-performance-improvement-phase3/","links":{"discourse":""},"authors":[{"avatar":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#685848","images":{"fallback":{"src":"/gatsby-jenkins-io/static/32fa8462b37abd3e057f4b70f0558972/19e71/rishabhbudhouliya.jpg","srcSet":"/gatsby-jenkins-io/static/32fa8462b37abd3e057f4b70f0558972/77b35/rishabhbudhouliya.jpg 32w,\n/gatsby-jenkins-io/static/32fa8462b37abd3e057f4b70f0558972/d4a57/rishabhbudhouliya.jpg 64w,\n/gatsby-jenkins-io/static/32fa8462b37abd3e057f4b70f0558972/19e71/rishabhbudhouliya.jpg 128w,\n/gatsby-jenkins-io/static/32fa8462b37abd3e057f4b70f0558972/68974/rishabhbudhouliya.jpg 256w","sizes":"(min-width: 128px) 128px, 100vw"},"sources":[{"srcSet":"/gatsby-jenkins-io/static/32fa8462b37abd3e057f4b70f0558972/ef6ff/rishabhbudhouliya.webp 32w,\n/gatsby-jenkins-io/static/32fa8462b37abd3e057f4b70f0558972/8257c/rishabhbudhouliya.webp 64w,\n/gatsby-jenkins-io/static/32fa8462b37abd3e057f4b70f0558972/6766a/rishabhbudhouliya.webp 128w,\n/gatsby-jenkins-io/static/32fa8462b37abd3e057f4b70f0558972/22bfc/rishabhbudhouliya.webp 256w","type":"image/webp","sizes":"(min-width: 128px) 128px, 100vw"}]},"width":128,"height":128}},"publicURL":"/gatsby-jenkins-io/static/32fa8462b37abd3e057f4b70f0558972/rishabhbudhouliya.jpg"},"blog":null,"github":"rishabhBudhouliya","html":"<div class=\"paragraph\">\n<p>GSoC 2020 student under the Jenkins project (Git Plugin Performance Improvements).\nAspiring to be better at Software Development and participate more in the open source\ncommunity.</p>\n</div>","id":"rishabhbudhouliya","irc":null,"linkedin":null,"name":"Rishabh Budhouliya","slug":"/blog/authors/rishabhbudhouliya/","twitter":null}]}},"pageContext":{"id":"a6cfa2b5-a75a-5920-892a-2548994c1318"}},
    "staticQueryHashes": ["1271460761","3649515864"]}