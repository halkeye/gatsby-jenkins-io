{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/blog/2020/08/31/custom-distribution-service/",
    "result": {"data":{"blog":{"html":"<div class=\"paragraph\">\n<p>Hello everyone,</p>\n</div>\n<div class=\"paragraph\">\n<p>This is the final blog post for the Custom Distribution Service project during the Google Summer of Code timeline.\nI have mixed feelings since we are almost near the finish line for one of the most amazing open source programs out there.\nHowever, it is time to wrap things up for this project and achieve a state where the project can be built upon and extended further.\nThis phase has been super busy with respect to the bug fixes, testing and getting the project hosted, so let us get straight into the phase 3 updates.</p>\n</div>\n<div class=\"sect1\">\n<h2 id=\"fixes-and-code-quality-assurance\"><a class=\"anchor\" href=\"#fixes-and-code-quality-assurance\"></a>Fixes and Code quality assurance</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"set-jenkinsfile-agent-to-linux\"><a class=\"anchor\" href=\"#set-jenkinsfile-agent-to-linux\"></a>Set Jenkinsfile agent to linux</h3>\n<div class=\"paragraph\">\n<p>We realised that the build was failing on windows and that there was not really a use-case\nfor running it on windows for right now. Maybe it could be on a future roadmap. Therefore, we\ndecided to shift the testing to only linux agents with respect to running the tests on the jenkins\nserver.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Pull Request <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/116\">#116</a></p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"backend-port-error-message\"><a class=\"anchor\" href=\"#backend-port-error-message\"></a>Backend port error message</h3>\n<div class=\"paragraph\">\n<p>Spring boot has a default message on the <code>port:8080</code> and therefore we wanted to change\nit to a custom message on the backend. So the major takeaway here is that we needed to\nimplement the <code>Error Controller</code> interface and include a custom message in it.\nThis was technical debt from the last phase and was completed and merged during this phase.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Pull Request <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/92\">#92</a></p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"pmd-analysis\"><a class=\"anchor\" href=\"#pmd-analysis\"></a>PMD Analysis</h3>\n<div class=\"paragraph\">\n<p>In order to enhance the quality of the code, the PMD source code analyser was applied to the project.\nIt helped me catch tons of errors. When the initial PMD check was run and we found approximately 162 PMD errors. We realised some of them were not relevant and some of them could be fixed later.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Pull Request <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/102\">#102</a></p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"findbugs-analysis\"><a class=\"anchor\" href=\"#findbugs-analysis\"></a>Findbugs Analysis</h3>\n<div class=\"paragraph\">\n<p>Another tool to improve code quality that we included in this phase was findbugs.\nIt did catch around 5-10 bugs in my code which I immediately resolved. Most of them were\naround the <code>Closeable HTTP Request</code> and an easy fix was the <code>try with resources</code>.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Pull Request <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/118\">#118</a></p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"jacoco-code-coverage\"><a class=\"anchor\" href=\"#jacoco-code-coverage\"></a>Jacoco Code Coverage</h3>\n<div class=\"paragraph\">\n<p>We needed to make sure most of the code we write had proper coverage for all branches and\nlines. Therefore we decided to include a JaCoco Code Coverage reporter that helped us find the\nuncovered lines and areas we need to improve coverage on.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Pull Request <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/103\">#103</a></p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"remove-jcasc-generation\"><a class=\"anchor\" href=\"#remove-jcasc-generation\"></a>Remove JCasC generation</h3>\n<div class=\"paragraph\">\n<p>While developing the service we quickly realised that the generation of the war package broke if we\nincluded a <code>configuration as code</code> section but did not provide a path to the corresponding required <code>yml</code>\nfile. Therefore we took a decision to remove the <code>casc</code> section all together. Maybe it will comeback in\na future patch</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Pull Request link: <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/127\">#127</a></p>\n</li>\n<li>\n<p>Issue link: <a href=\"https://github.com/jenkinsci/custom-distribution-service/issues/65\">#65</a></p>\n</li>\n</ul>\n</div>\n<div class=\"sect3\">\n<h4 id=\"minor-fixes\"><a class=\"anchor\" href=\"#minor-fixes\"></a>Minor Fixes</h4>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Logging Fix: <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/99\">#99</a></p>\n</li>\n<li>\n<p>Docs Fix : link: <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/120\">#120</a></p>\n</li>\n<li>\n<p>Update Center Dump Fix : link: <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/125\">#125</a></p>\n</li>\n<li>\n<p>Class Path Fix: link: <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/126\">#126</a></p>\n</li>\n<li>\n<p>Release Drafter Addition: link: <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/136\">#136</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"front-end\"><a class=\"anchor\" href=\"#front-end\"></a>Front end</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"community-config-navigation-link\"><a class=\"anchor\" href=\"#community-config-navigation-link\"></a>Community Config Navigation link</h3>\n<div class=\"paragraph\">\n<p>There was no community configuration link present for navigation which was added here.\n Now it is easier to navigate to the community page from the home page itself.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Pull Request <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/100\">#100</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"docker-updates\"><a class=\"anchor\" href=\"#docker-updates\"></a>Docker updates</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"build-everything-with-docker\"><a class=\"anchor\" href=\"#build-everything-with-docker\"></a>Build everything with Docker</h3>\n<div class=\"paragraph\">\n<p>This was one of the major changes this phase with respect to making the service very easy to spin up locally, this change will greatly help community adoption since it eliminates the tools one needs to install locally. Initially the process was to run maven locally, generate all of the files and then copy all of its contents into the container. However, with this change we are going to generate all of the files inside the docker container itself. Allowing the user to just run a couple of commands to get the service up and running.</p>\n</div>\n<div class=\"paragraph\">\n<p>So some of the major changes we did with respect to the dockerfile was:</p>\n</div>\n<div class=\"paragraph\">\n<p>a) Copy all of the configuration files and <code>pom.xml</code> into the container.</p>\n</div>\n<div class=\"paragraph\">\n<p>b) Run the command <code>mvn clean package</code> inside the container which generates the jar.</p>\n</div>\n<div class=\"paragraph\">\n<p>c) Run the jar inside the container.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Pull Request <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/104\">#104</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"hosting-updates\"><a class=\"anchor\" href=\"#hosting-updates\"></a>Hosting updates</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>This process was supposed to be a future roadmap, however the infra team approved and was super helpful\nin making this process as smooth as possible. Thanks to Gavin, Tim and Oblak for making this possible.\nHere is the google group <a href=\"https://groups.google.com/g/jenkins-infra/c/v3UJfiFte8w\">dicussion</a></p>\n</div>\n<div class=\"paragraph\">\n<p>The project has now been hosted <a href=\"https://customize.jenkins.io/\">here</a> as a preview. It still needs\nsome fixes to be fully functional.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Infra Docker PR <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/131\">#131</a></p>\n</li>\n<li>\n<p>Infra Project Addition PR link: <a href=\"https://github.com/jenkins-infra/charts/pull/393\">#393</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"testing-updates\"><a class=\"anchor\" href=\"#testing-updates\"></a>Testing Updates</h2>\n<div class=\"sectionbody\">\n<div class=\"sect2\">\n<h3 id=\"unit-test-the-services\"><a class=\"anchor\" href=\"#unit-test-the-services\"></a>Unit test the services</h3>\n<div class=\"paragraph\">\n<p>With respect to community hosting and adoption, testing of the service one of the most important and major milestones for this phase was to test the majority of the code and we have completed the testing with flying colors. All of the services have been completely unit tested, which is a major accomplishment.\nFor the testing of the service we decided to go with wiremock which can be used to mock external services. Kezhi&#8217;s <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/105#issuecomment-668087069\">comment</a> helped us to understand what we needed to do since he had done something quite similar in his Github Checks API project.</p>\n</div>\n<div class=\"paragraph\">\n<p>So we basically wiremocked the update-center url and made sure we were getting\nthe accurate response with appropriate control flow logic tested.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight nowrap\"><code>wireMockRule.stubFor(get(urlPathMatching(\"/getUpdateCenter\"))\n                .willReturn(aResponse()\n                        .withStatus(200)\n                        .withHeader(\"Content-Type\", \"application/json\")\n                        .withBody(updateCenterBody)));</code></pre>\n</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Pull Request <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/105\">#105</a></p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"add-update-center-controller-tests\"><a class=\"anchor\" href=\"#add-update-center-controller-tests\"></a>Add Update Center controller tests</h3>\n<div class=\"paragraph\">\n<p>Another major testing change involved testing the controllers. For this we decided to use the <code>wiremock</code> library in java to mock the server response when the controllers were invoked.</p>\n</div>\n<div class=\"paragraph\">\n<p>For example: If I have a controller that serves in an api called <code>/api/plugin/getPluginList</code>\nwiremock can be used to stub out its response when the system is under test. So we use something like this to test it out.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight nowrap\"><code> when(updateService.downloadUpdateCenterJSON()).thenReturn(util.convertPayloadToJSON(dummyUpdateBody))</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>When the particular controller is called the underlying service is mocked and it returns a response according to the one provided by us. To find more details the PR is here.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Pull Request <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/106\">#106</a></p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"add-packager-controller-tests\"><a class=\"anchor\" href=\"#add-packager-controller-tests\"></a>Add Packager Controller Tests</h3>\n<div class=\"paragraph\">\n<p>Along with the update center controller tests another controller that needed to be tested was the\npackager controller. Also we needed to make sure that all the branches for the controllers were properly tested. Additional details can be found in the PR below.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Pull Request <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/133\">#133</a></p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"docker-compose-tests\"><a class=\"anchor\" href=\"#docker-compose-tests\"></a>Docker Compose Tests</h3>\n<div class=\"paragraph\">\n<p>One problem that we faced the entire phase was the docker containers. We regularly found out that due to\nsome changes in the codebase the docker container build sometimes broke, or even sometimes the inner api&#8217;s seemed to malfunction. In order to counteract that we decided to come up with some tests locally.\nSo what I did was basically introduce a set of bash scripts that would do the following:</p>\n</div>\n<div class=\"paragraph\">\n<p>a) Build the container using the <code>docker-compose</code> command.</p>\n</div>\n<div class=\"paragraph\">\n<p>b) Run the container.</p>\n</div>\n<div class=\"paragraph\">\n<p>c) Test the api&#8217;s using the exposed port.</p>\n</div>\n<div class=\"paragraph\">\n<p>d) Teardown the running containers.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Pull Request <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/131\">#131</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"user-documentation\"><a class=\"anchor\" href=\"#user-documentation\"></a>User Documentation</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>We also included a user docs guide so that it makes it super easy to get started with the service.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Pull Request <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/145\">#145</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"future-roadmap\"><a class=\"anchor\" href=\"#future-roadmap\"></a>Future Roadmap</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>This has been a super exciting project to work on and I can definitely see this project being built\nupon and extended in the future.</p>\n</div>\n<div class=\"paragraph\">\n<p>I would like to talk about some of the features that are left to come in and can be taken up in\na future roadmap discussion</p>\n</div>\n<div class=\"paragraph\">\n<p>a) <strong>JCasC Support</strong>:</p>\n</div>\n<div class=\"paragraph\">\n<p>Description: Support the generation of a Jenkins Configuration as Code file asking the user interactively for the plugins they select what would be the configuration they would want eg: If the user selects the slack plugin we need to ask him questions like <code>what is the slack channel? what is the token? etc</code>, and on the basis of this generate a <code>casc</code> file. This feature was initially planned to go into the service but we realised this is a project in its own capacity.</p>\n</div>\n<div class=\"paragraph\">\n<p>b) <strong>Auto Pull Request Creation</strong>:</p>\n</div>\n<div class=\"paragraph\">\n<p>Description: Allow users to create a configuration file and immediately open a pull request on github\nwithout leaving the user interface. This was originally planned using a github bot and we started the work on it. But we were in doubt if the service would be hosted or not and therefore put the development on hold.\nYou can find the pull requests here:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Github Controller <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/72\">#72</a></p>\n</li>\n<li>\n<p>Pull Request Creation Functions <a href=\"https://github.com/jenkinsci/custom-distribution-service/pull/66\">#66</a></p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>c) <strong>Synergy with Image Controller</strong></p>\n</div>\n<div class=\"paragraph\">\n<p>Description: This feature requires some planning, some of the questions we can ask are:</p>\n</div>\n<div class=\"paragraph\">\n<p>a) Can we generate the images (i.e Image Controller).\nb) Can we have the service as a multipurpose generator ?</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"statistics\"><a class=\"anchor\" href=\"#statistics\"></a>Statistics</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>This phase has been the busiest of all phases and it has involved a lot of work, more than I had\ninitially expected in the phase. Although lines\nof code added is not an indication of work done, however 800 lines of Code added is a real personal milestone for me.</p>\n</div>\n<table class=\"tableblock frame-all grid-all\" style=\"width: 25%;\">\n<colgroup>\n<col style=\"width: 83.3333%;\">\n<col style=\"width: 16.6667%;\">\n</colgroup>\n<tbody>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">Pull Requests Opened</p></td>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\">26</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">Lines of Code Added</p></td>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\">1096</p></td>\n</tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">Lines of Docs Added</p></td>\n<td class=\"tableblock halign-center valign-top\"><p class=\"tableblock\">200</p></td>\n</tr>\n</tbody>\n</table>\n<div class=\"sect2\">\n<h3 id=\"other-links\"><a class=\"anchor\" href=\"#other-links\"></a>Other links</h3>\n<div class=\"paragraph\">\n<p><a href=\"https://gitter.im/jenkinsci/jenkins-custom-distribution-service\">Gitter Channel Link</a><br>\n<a href=\"https://docs.google.com/document/d/1C7VQJ92Yhr0KRDcNVHYxn4ri7OL9IGZmgxY6UFON6-g/edit?usp=sharing\">GSoC Proposal</a><br>\n<a href=\"https://docs.google.com/document/d/1-ujWVJ2a5VYkUF6UA7m4bEpSDxmb3mJZhCbmoKO716U/edit?usp=sharing\">Design Document</a><br>\n<a href=\"https://docs.google.com/document/d/1DSCH-3wh6uV9Rm_j8PcBzq2lvQPhZ31AIwmWkEaLxvc/edit?usp=sharing\">Daily Notes</a><br></p>\n</div>\n</div>\n</div>\n</div>","id":"43eb825a-3d18-5e4f-a85a-0f03ad89902f","title":"Custom Distribution Service : Phase 3 Blogpost","date":"2020-08-31T00:00:00.000Z","slug":"/blog/2020/08/31/custom-distribution-service/","authors":[{"avatar":null,"blog":null,"github":"sladyn98","html":"<div class=\"paragraph\">\n<p>Sladyn is a Computer Science student at Mumbai University, India.\nHe is participating in Community Bridge 2019 to provide development tools to JCasC plugin in the form of IDE integrations, schema architecture improvements and configuration extension points <a href=\"https://github.com/jenkinsci/configuration-as-code-plugin\">Configuration as Code Plugin</a>.</p>\n</div>","id":"sladyn98","irc":null,"linkedin":null,"name":"Sladyn Nunes","slug":"/blog/authors/sladyn98/","twitter":"SladynN"}]}},"pageContext":{"id":"43eb825a-3d18-5e4f-a85a-0f03ad89902f"}},
    "staticQueryHashes": ["1271460761","3649515864"]}